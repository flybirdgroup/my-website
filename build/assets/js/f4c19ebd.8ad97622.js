"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3432],{3905:(t,e,a)=>{a.d(e,{Zo:()=>c,kt:()=>g});var n=a(67294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var p=n.createContext({}),s=function(t){var e=n.useContext(p),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},c=function(t){var e=s(t.components);return n.createElement(p.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},u=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,o=t.originalType,p=t.parentName,c=l(t,["components","mdxType","originalType","parentName"]),u=s(a),g=r,k=u["".concat(p,".").concat(g)]||u[g]||d[g]||o;return a?n.createElement(k,i(i({ref:e},c),{},{components:a})):n.createElement(k,i({ref:e},c))}));function g(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var p in e)hasOwnProperty.call(e,p)&&(l[p]=e[p]);l.originalType=t,l.mdxType="string"==typeof t?t:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},25558:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=a(87462),r=(a(67294),a(3905));const o={id:"dataproc1",title:"5\u5206\u949f\u5728\u8c37\u6b4c\u4e91\u4e0a\u4f7f\u7528Dataproc\u8fd0\u884cApache Spark\u96c6\u7fa4",author:"\u62db\u6653\u8d24",author_title:"AI Engineer",author_url:"https://github.com/flybirdgroup",author_image_url:"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1615738601,1434436036&fm=26&gp=0.jpg",tags:["dataproc","GCP","Spark","Hadoop"]},i="\u53bb\u5230\u63a7\u5236\u53f0,\u786e\u8ba4cloud dataproc API\u5df2\u542f\u7528",l={unversionedId:"Big_Data/dataproc1",id:"Big_Data/dataproc1",title:"5\u5206\u949f\u5728\u8c37\u6b4c\u4e91\u4e0a\u4f7f\u7528Dataproc\u8fd0\u884cApache Spark\u96c6\u7fa4",description:"png",source:"@site/docs/Big_Data/2020-4-17-dataproc\u8fd0\u884cApache Spark\u96c6\u7fa4.md",sourceDirName:"Big_Data",slug:"/Big_Data/dataproc1",permalink:"/docs/Big_Data/dataproc1",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Big_Data/2020-4-17-dataproc\u8fd0\u884cApache Spark\u96c6\u7fa4.md",tags:[{label:"dataproc",permalink:"/docs/tags/dataproc"},{label:"GCP",permalink:"/docs/tags/gcp"},{label:"Spark",permalink:"/docs/tags/spark"},{label:"Hadoop",permalink:"/docs/tags/hadoop"}],version:"current",frontMatter:{id:"dataproc1",title:"5\u5206\u949f\u5728\u8c37\u6b4c\u4e91\u4e0a\u4f7f\u7528Dataproc\u8fd0\u884cApache Spark\u96c6\u7fa4",author:"\u62db\u6653\u8d24",author_title:"AI Engineer",author_url:"https://github.com/flybirdgroup",author_image_url:"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1615738601,1434436036&fm=26&gp=0.jpg",tags:["dataproc","GCP","Spark","Hadoop"]},sidebar:"tutorialSidebar",previous:{title:"dataproc--\u8dd1pyspark(\u4ecebig query\u83b7\u53d6\u6570\u636e)",permalink:"/docs/Big_Data/dataproc3"},next:{title:"\u7528yaml\u914d\u7f6e\u6587\u4ef6\u4f20\u53c2\u6570\u7ed9pyspark,\u7136\u540e\u518ddataproc\u8fd0\u884c",permalink:"/docs/Big_Data/dataproc6"}},p={},s=[{value:"\u8fd9\u6837gcp\u5c31\u4f1a\u5e2e\u4f60\u642d\u5efacluster\u4e86",id:"\u8fd9\u6837gcp\u5c31\u4f1a\u5e2e\u4f60\u642d\u5efacluster\u4e86",level:2},{value:"\u53bbjob,\u9009\u62e9 sumbit job",id:"\u53bbjob\u9009\u62e9-sumbit-job",level:2},{value:"\u5728\u5bf9\u5e94\u5b57\u6bb5\u8f93\u5165\u5bf9\u5e94\u503c",id:"\u5728\u5bf9\u5e94\u5b57\u6bb5\u8f93\u5165\u5bf9\u5e94\u503c",level:3},{value:"\u5177\u4f53\u5982\u4e0b,\u8f93\u5165\u5b8c\u6210\u540e\u70b9\u51fbsumbit",id:"\u5177\u4f53\u5982\u4e0b\u8f93\u5165\u5b8c\u6210\u540e\u70b9\u51fbsumbit",level:3},{value:"\u6211\u4eec\u53ef\u4ee5\u70b9\u51fbjob id \u67e5\u770b\u7ed3\u679c\u548c\u65e5\u5fd7",id:"\u6211\u4eec\u53ef\u4ee5\u70b9\u51fbjob-id-\u67e5\u770b\u7ed3\u679c\u548c\u65e5\u5fd7",level:3},{value:"\u6211\u4eec\u53ef\u4ee5\u53ef\u4ee5\u66f4\u65b0worker\u6570\u91cf",id:"\u6211\u4eec\u53ef\u4ee5\u53ef\u4ee5\u66f4\u65b0worker\u6570\u91cf",level:2},{value:"\u5173\u4e8espark jar\u5305\u548cclass\u95ee\u9898",id:"\u5173\u4e8espark-jar\u5305\u548cclass\u95ee\u9898",level:2},{value:"\u53c2\u6570\u8bf4\u660e:",id:"\u53c2\u6570\u8bf4\u660e",level:2},{value:"Install PyPI packages",id:"install-pypi-packages",level:2},{value:"Install Conda packages",id:"install-conda-packages",level:2},{value:"\u5e38\u89c1\u9519\u8bef",id:"\u5e38\u89c1\u9519\u8bef",level:2},{value:"\u521b\u5efa\u96c6\u7fa4\u540e,\u4f7f\u7528jupyter, \u53bb\u5230cluster,\u7136\u540e\u53bb\u5230web interfaces,\u9009\u62e9jupyter",id:"\u521b\u5efa\u96c6\u7fa4\u540e\u4f7f\u7528jupyter-\u53bb\u5230cluster\u7136\u540e\u53bb\u5230web-interfaces\u9009\u62e9jupyter",level:2},{value:"Dataproc image version 1.3 \u6216\u8005\u4e4b\u524d\u7684\u8bdd\u9ed8\u8ba4\u662fpython2.7",id:"dataproc-image-version-13-\u6216\u8005\u4e4b\u524d\u7684\u8bdd\u9ed8\u8ba4\u662fpython27",level:2},{value:"\u5177\u4f53\u914d\u7f6ecluster\u914d\u7f6e\u7684\u8bf7\u67e5\u770b",id:"\u5177\u4f53\u914d\u7f6ecluster\u914d\u7f6e\u7684\u8bf7\u67e5\u770b",level:2}],c={toc:s};function d(t){let{components:e,...o}=t;return(0,r.kt)("wrapper",(0,n.Z)({},c,o,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u53bb\u5230\u63a7\u5236\u53f0\u786e\u8ba4cloud-dataproc-api\u5df2\u542f\u7528"},"\u53bb\u5230\u63a7\u5236\u53f0,\u786e\u8ba4cloud dataproc API\u5df2\u542f\u7528"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(62765).Z,width:"1172",height:"266"}),"\n",(0,r.kt)("img",{alt:"png",src:a(97917).Z,width:"300",height:"295"}),"\n",(0,r.kt)("img",{alt:"png",src:a(13846).Z,width:"723",height:"289"})),(0,r.kt)("h1",{id:"\u53bbdataproc-cluster-create-cluster"},"\u53bbdataproc->cluster->create cluster"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(39285).Z,width:"1182",height:"419"})),(0,r.kt)("h1",{id:"create-cluster\u540e\u5728\u4ee5\u4e0b\u5b57\u6bb5\u8f93\u5165\u5bf9\u5e94\u503c"},"create cluster\u540e\u5728\u4ee5\u4e0b\u5b57\u6bb5\u8f93\u5165\u5bf9\u5e94\u503c"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(23216).Z,width:"641",height:"150"})),(0,r.kt)("p",null,"\u5177\u4f53\u5982\u4e0b:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(81362).Z,width:"601",height:"705"})),(0,r.kt)("h1",{id:"\u4ee5\u4e0a\u63a7\u5236\u53f0\u7684\u6b65\u9aa4\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7gcloud-terminal\u4ee3\u7801\u5b9e\u73b0"},"\u4ee5\u4e0a\u63a7\u5236\u53f0\u7684\u6b65\u9aa4,\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7gcloud terminal\u4ee3\u7801\u5b9e\u73b0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"gcloud set config project project ID # \u8bbe\u7f6e\u6307\u5b9a\u9879\u76eeid\ngcloud config set dataproc/region global #\u5728dataproc\u8bbe\u7f6eregion,\u8fd9\u4e00\u6b65\u5f88\u91cd\u8981\ngcloud dataproc clusters create example-cluster\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(62765).Z,width:"1172",height:"266"})),(0,r.kt)("h2",{id:"\u8fd9\u6837gcp\u5c31\u4f1a\u5e2e\u4f60\u642d\u5efacluster\u4e86"},"\u8fd9\u6837gcp\u5c31\u4f1a\u5e2e\u4f60\u642d\u5efacluster\u4e86"),(0,r.kt)("h1",{id:"\u521b\u5efa\u96c6\u7fa4\u6210\u529f\u540e\u8fd0\u884cjob"},"\u521b\u5efa\u96c6\u7fa4\u6210\u529f\u540e,\u8fd0\u884cjob"),(0,r.kt)("h2",{id:"\u53bbjob\u9009\u62e9-sumbit-job"},"\u53bbjob,\u9009\u62e9 sumbit job"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(20196).Z,width:"554",height:"294"})),(0,r.kt)("h3",{id:"\u5728\u5bf9\u5e94\u5b57\u6bb5\u8f93\u5165\u5bf9\u5e94\u503c"},"\u5728\u5bf9\u5e94\u5b57\u6bb5\u8f93\u5165\u5bf9\u5e94\u503c"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(88166).Z,width:"644",height:"230"})),(0,r.kt)("h3",{id:"\u5177\u4f53\u5982\u4e0b\u8f93\u5165\u5b8c\u6210\u540e\u70b9\u51fbsumbit"},"\u5177\u4f53\u5982\u4e0b,\u8f93\u5165\u5b8c\u6210\u540e\u70b9\u51fbsumbit"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(98230).Z,width:"559",height:"609"})),(0,r.kt)("h3",{id:"\u6211\u4eec\u53ef\u4ee5\u70b9\u51fbjob-id-\u67e5\u770b\u7ed3\u679c\u548c\u65e5\u5fd7"},"\u6211\u4eec\u53ef\u4ee5\u70b9\u51fbjob id \u67e5\u770b\u7ed3\u679c\u548c\u65e5\u5fd7"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(54873).Z,width:"975",height:"378"})),(0,r.kt)("h1",{id:"\u4ee5\u4e0a\u6b65\u9aa4\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u7528\u4ee3\u7801\u5728gcpterminal\u4e0a\u64cd\u4f5c"},"\u4ee5\u4e0a\u6b65\u9aa4,\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u7528\u4ee3\u7801\u5728GCPterminal\u4e0a\u64cd\u4f5c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"gcloud dataproc jobs submit spark --cluster example-cluster \\\n  --class org.apache.spark.examples.SparkPi \\\n  --jars file:///usr/lib/spark/examples/jars/spark-examples.jar -- 1000\n")),(0,r.kt)("p",null,"\u6211\u4eec\u628ajob\u6253\u5305\u6210jar,\u7136\u540e\u7528submit spark \u6765\u8fd0\u884c\n\u547d\u4ee4 gcloud dataproc jobs submit spark --cluster \u96c6\u7fa4\u540d\u79f0 \\ --class \u7c7b\u540d --jars jar\u5305\u8def\u5f84 --task\u6570\u91cf"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(97917).Z,width:"300",height:"295"}),"\n",(0,r.kt)("img",{alt:"png",src:a(13846).Z,width:"723",height:"289"})),(0,r.kt)("h2",{id:"\u6211\u4eec\u53ef\u4ee5\u53ef\u4ee5\u66f4\u65b0worker\u6570\u91cf"},"\u6211\u4eec\u53ef\u4ee5\u53ef\u4ee5\u66f4\u65b0worker\u6570\u91cf"),(0,r.kt)("p",null,"gcloud dataproc clusters update \u96c6\u7fa4\u540d\u5b57 -num-workers=\u6570\u91cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"gcloud dataproc clusters update example-cluster --num-workers= 4\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(23216).Z,width:"641",height:"150"})),(0,r.kt)("h1",{id:"\u6211\u4eec\u53ef\u4ee5\u53c2\u8003\u96c6\u7fa4\u8bbe\u7f6e"},"\u6211\u4eec\u53ef\u4ee5\u53c2\u8003\u96c6\u7fa4\u8bbe\u7f6e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"gcloud dataproc clusters describe example-cluster\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(81362).Z,width:"601",height:"705"})),(0,r.kt)("h2",{id:"\u5173\u4e8espark-jar\u5305\u548cclass\u95ee\u9898"},"\u5173\u4e8espark jar\u5305\u548cclass\u95ee\u9898"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/2c7bcee7001a"},"\u53c2\u8003\u94fe\u63a51")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/u014234504/article/details/82812343"},"\u53c2\u770b\u94fe\u63a52")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://wenku.baidu.com/view/a0dd882fa8956bec0975e397.html"},"class\u7684\u5199\u6cd5")),(0,r.kt)("h1",{id:"\u7528dataproc\u521b\u5efa\u96c6\u7fa4\u548c\u8fd0\u884cspark-job-\u5b8c\u6210"},"\u7528dataproc\u521b\u5efa\u96c6\u7fa4\u548c\u8fd0\u884cspark job \u5b8c\u6210!!"),(0,r.kt)("p",null,"\u5173\u4e8e",(0,r.kt)("a",{parentName:"p",href:"https://zhuanlan.zhihu.com/p/50752866"},"spark job,stage,task"),"\u7684\u7406\u89e3\u548c\u53c2\u8003"),(0,r.kt)("h1",{id:"\u7528gcloud\u6765\u542fcluster\u547d\u4ee4"},"\u7528gcloud\u6765\u542fcluster\u547d\u4ee4"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://codelabs.developers.google.com/codelabs/spark-nlp/index.html?index=..%2F..index&_ga=2.18367290.242813027.1588130089-996489118.1587002962&_gac=1.182983892.1588923163.Cj0KCQjwhtT1BRCiARIsAGlY51KEFc2-GGnxsXVhFZsKWExLJckKepaugZrKbbr2cvW0KLPRtubd7vAaAkA2EALw_wcB#0"},"\u4e00\u4e2aNLP\u5b9e\u9a8c")),(0,r.kt)("h1",{id:"\u5728dataproc\u521b\u5efa\u96c6\u7fa4"},"\u5728dataproc\u521b\u5efa\u96c6\u7fa4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"CLUSTER_NAME=my-cluster\nZONE=us-east1-b\nBUCKET_NAME=bm_reddit\nREGION=us-east1\ngcloud beta dataproc clusters create ${CLUSTER_NAME} \\\n     --zone=${ZONE} \\\n     --metadata 'PIP_PACKAGES=google-cloud-storage' \\\n     --worker-machine-type n1-standard-1 \\\n     --num-workers 2 \\\n     --image-version 1.4-debian9 \\\n     --initialization-actions gs://dataproc-initialization-actions/spark-nlp/spark-nlp.sh,gs://dataproc-initialization-actions/python/pip-install.sh \\\n     --region=${REGION} \\\n     --optional-components=JUPYTER,ANACONDA \\\n     --enable-component-gateway \\\n     --worker-boot-disk-size=30\n")),(0,r.kt)("h2",{id:"\u53c2\u6570\u8bf4\u660e"},"\u53c2\u6570\u8bf4\u660e:"),(0,r.kt)("p",null,"metadata\u6307\u6e90\u6570\u636e,\u6bd4\u5982\u60f3\u8981\u5b89\u88c5CONDA_PACKAGE,\u6211\u4eec"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--metadata 'CONDA_PACKAGES=scipy=1.0.0 tensorflow' \\ \n")),(0,r.kt)("p",null,"\u5982\u679c\u60f3\u5b89\u88c5pip_package,\u6211\u4eec\u53ef\u4ee5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--metadata 'PIP_PACKAGES=pandas==0.23.0 scipy==1.1.0' \\ \n")),(0,r.kt)("p",null,"\u8be6\u7ec6\u53ef\u4ee5",(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/dataproc/docs/tutorials/python-configuration"},"\u53c2\u8003\u94fe\u63a5")),(0,r.kt)("h2",{id:"install-pypi-packages"},"Install PyPI packages"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--initialization-actions gs://goog-dataproc-initialization-actions-${REGION}/python/pip-install.sh\n")),(0,r.kt)("h2",{id:"install-conda-packages"},"Install Conda packages"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--initialization-actions gs://goog-dataproc-initialization-actions-${REGION}/python/conda-install.sh\n")),(0,r.kt)("p",null,"--initialization-actions\u662f\u7528\u5728\u5b89\u88c5metadata\u7684\u5305"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--initialization-actions \\ \n    gs://goog-dataproc-initialization-actions-${REGION}/conda/bootstrap-conda.sh,gs://goog-dataproc-initialization-actions-${REGION}/conda/install-conda-env.sh\n")),(0,r.kt)("p",null,"\u4e0b\u8f7d\u4ee3\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd\ngit clone https://github.com/GoogleCloudPlatform/cloud-dataproc\ncd cloud-dataproc/codelabs/spark-nlp\n")),(0,r.kt)("p",null,"\u8fd0\u884c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"gcloud dataproc jobs submit pyspark --cluster ${CLUSTER_NAME}\\\n    --properties=spark.jars.packages=JohnSnowLabs:spark-nlp:2.0.8 \\\n    --driver-log-levels root=FATAL \\\n    topic_model.py \\\n    -- ${BUCKET_NAME}\n")),(0,r.kt)("p",null,"CLUSTER_NAME=newnew\ngcloud beta dataproc clusters create ${CLUSTER_NAME} \\\n--region=global \\\n--zone=us-east1-b \\\n--worker-machine-type n1-standard-2 \\\n--num-workers 2 \\\n--image-version 1.5-debian \\\n--initialization-actions gs://dataproc-initialization-actions/python/pip-install.sh \\\n--metadata 'PIP_PACKAGES=google-cloud-storage avro-python3 dask","[dataframe]"," gcsfs fastavro' \\\n--enable-component-gateway \\\n--worker-boot-disk-size=40 \\\n--optional-components=JUPYTER,ANACONDA \\\n--enable-component-gateway \\\n--autoscaling-policy=global"),(0,r.kt)("p",null,"workerConfig:\nminInstances: 2\nmaxInstances: 100\nweight: 1\nsecondaryWorkerConfig:\nminInstances: 0\nmaxInstances: 100\nweight: 1\nbasicAlgorithm:\ncooldownPeriod: 4m\nyarnConfig:\nscaleUpFactor: 0.05\nscaleDownFactor: 1.0\nscaleUpMinWorkerFraction: 0.0\nscaleDownMinWorkerFraction: 0.0\ngracefulDecommissionTimeout: 1h"),(0,r.kt)("h2",{id:"\u5e38\u89c1\u9519\u8bef"},"\u5e38\u89c1\u9519\u8bef"),(0,r.kt)("p",null,"\u6848\u4f8b1:cpus\u7684\u9650\u989d\u95ee\u9898\nMultiple validation errors: - Insufficient 'CPUS' quota. Requested 12.0, available 7.0. - Insufficient 'CPUS_ALL_REGIONS' quota. Requested 12.0, available 11.0. - This request exceeds CPU quota. Some things to try: request fewer workers (a minimum of 2 is required), use smaller master and/or worker machine types (such as n1-standard-2)."),(0,r.kt)("p",null,"\u8fd9\u91cc\u7684insufficent 'CPUS' \u53ea\u7684\u662fmaster\u548cworker\u6240\u6709\u7684node\u7684cpus\u6570\u91cf\u603b\u548c\nInsufficient 'CPUS_ALL_REGIONS' quota\u662f\u5728\u5168\u7403\u7684cpus\u9650\u989d,\u5982\u679cregion\u9009\u62e9global, \u90a3\u4e48\u8fd9\u91cc\u9650\u989d\u5c31\u662f11(available 11), \u5982\u679cregion\u9009\u62e9\u65f6\u67d0\u4e2a\u5730\u533a,\u6bd4\u5982us-central1,\u90a3\u4e48\u6211\u8fd9\u91cc\u7684quota\u5c31\u662f7.\u4e3a\u4ec0\u4e48\u662f7\u5462,\u56e0\u4e3a\u8c37\u6b4c\u7684\u8bd5\u7528\u8d26\u53f7\u6700\u591a\u53ea\u80fd\u67098CPUs,\u6211\u8fd9\u4e2aproject\u91cc\u9762\u5df2\u7ecf\u5728\u4e00\u4e2a\u5730\u533a\u533a\u57df\u521b\u5efa\u4e86\u4e00\u4e2avm,\u8fd9\u4e2avm\u7684machining type\u662f(n1-standard-1 (1 vCPU, 3.75 GB memory)),\u6240\u4ee5\u5360\u7528\u4e86\u4e00\u4e2acpu,\u6240\u4ee5\u5730\u65b9region\u7684cpus\u53ef\u7528\u989d\u5ea6\u5c31\u662f8-1=7\n\u540c\u7406,\u5168\u7403\u7684\u8bdd\u662f12cpu,\u6211\u5df2\u7ecf\u7528\u4e861\u4e2a\u4e86,\u6240\u4ee5\u5168\u7403\u5269\u4e0b\u7684\u5c31\u662f12-1=11."),(0,r.kt)("p",null,"\u6848\u4f8b2: yarn core\u6570 \u548c yarn memory\nyarn core = worker\u7684node\u4e2a\u6570 ",(0,r.kt)("em",{parentName:"p"}," vcpu\nyarn memory =  worker\u7684node\u4e2a\u6570 ")," memoery * 0.8"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"png",src:a(46444).Z,width:"489",height:"368"})),(0,r.kt)("p",null,"google\u5bf9yarn memoery\u7684\u5b9a\u4e49:\nThe number of worker nodes times the amount of memory on each node times the fraction given to YARN (0.8)"),(0,r.kt)("p",null,"google\u5bf9yarn coreds\u7684\u5b9a\u4e49:\nthe number of worker nodes times the number of vCPUs per node"),(0,r.kt)("h2",{id:"\u521b\u5efa\u96c6\u7fa4\u540e\u4f7f\u7528jupyter-\u53bb\u5230cluster\u7136\u540e\u53bb\u5230web-interfaces\u9009\u62e9jupyter"},"\u521b\u5efa\u96c6\u7fa4\u540e,\u4f7f\u7528jupyter, \u53bb\u5230cluster,\u7136\u540e\u53bb\u5230web interfaces,\u9009\u62e9jupyter"),(0,r.kt)("p",null,"\u5982\u679c\u8fd0\u884cspark\u7684\u65f6\u5019,\u51fa\u73b0 Py4JJavaError\u9519\u8bef\n\u53ef\u4ee5\u5b89\u88c5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"conda install -c cyclus java-jdk\n")),(0,r.kt)("p",null,"\u5982\u679c\u60f3\u5b89\u88c5python3"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"!conda create -n py36 python=3.6 anaconda\n")),(0,r.kt)("h2",{id:"dataproc-image-version-13-\u6216\u8005\u4e4b\u524d\u7684\u8bdd\u9ed8\u8ba4\u662fpython27"},"Dataproc image version 1.3 \u6216\u8005\u4e4b\u524d\u7684\u8bdd\u9ed8\u8ba4\u662fpython2.7"),(0,r.kt)("p",null,"\u6240\u4ee5\u6211\u4eec\u6700\u597d\u5b89\u88c5Dataproc image version 1.4+,\u9ed8\u8ba4\u5c31\u662fpython3,\u5177\u4f53\u8be6\u7ec6\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Miniconda3 is installed on Dataproc 1.4+ clusters. The default Python interpreter is Python 3.6 for Dataproc 1.4 and Python 3.7 for Dataproc 1.5, located on the VM instance at /opt/conda/miniconda3/bin/python3.6 and /opt/conda/miniconda3/bin/python3.7, respectively. Python 2.7 is also available at /usr/bin/python2.7.\n")),(0,r.kt)("h2",{id:"\u5177\u4f53\u914d\u7f6ecluster\u914d\u7f6e\u7684\u8bf7\u67e5\u770b"},"\u5177\u4f53\u914d\u7f6ecluster\u914d\u7f6e\u7684\u8bf7\u67e5\u770b"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/dataproc/docs/tutorials/python-configuration"},"\u53c2\u8003\u94fe\u63a5")))}d.isMDXComponent=!0},62765:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/1-35398815aa4283814fbd749f04883649.png"},39285:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/10-1264ea654ee838e8c3d8ca51cf5d20bd.png"},46444:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/11-98803efe09fe9eaeddb3a5d53cb85fbe.png"},97917:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/2-06a0c51c3671688f8442baea872618a7.png"},13846:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/3-0bcc908dc4ca9b432095c615166db116.png"},23216:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/4-1df1ef80fd55f6e6bcddcff16e8c8cba.png"},81362:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/5-346a13e2b55843741f899646985d088c.png"},20196:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/6-5e26899306aef7d10d29563c48bc2c89.png"},88166:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/7-856fd59229ed0d83d47f38974377d0c5.png"},98230:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/8-eafae9c0e417f879f685e7054db3d73f.png"},54873:(t,e,a)=>{a.d(e,{Z:()=>n});const n=a.p+"assets/images/9-91c235a9c10ceebf6d0e7723556fa12e.png"}}]);