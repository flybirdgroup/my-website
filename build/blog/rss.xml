<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>My Site Blog</title>
        <link>https://your-docusaurus-test-site.com/blog</link>
        <description>My Site Blog</description>
        <lastBuildDate>Thu, 26 Aug 2021 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Welcome]]></title>
            <link>https://your-docusaurus-test-site.com/blog/welcome</link>
            <guid>welcome</guid>
            <pubDate>Thu, 26 Aug 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Docusaurus blogging features are powered by the blog plugin.]]></description>
            <content:encoded><![CDATA[<p><a href="https://docusaurus.io/docs/blog" target="_blank" rel="noopener noreferrer">Docusaurus blogging features</a> are powered by the <a href="https://docusaurus.io/docs/api/plugins/@docusaurus/plugin-content-blog" target="_blank" rel="noopener noreferrer">blog plugin</a>.</p><p>Simply add Markdown files (or folders) to the <code>blog</code> directory.</p><p>Regular blog authors can be added to <code>authors.yml</code>.</p><p>The blog post date can be extracted from filenames, such as:</p><ul><li><code>2019-05-30-welcome.md</code></li><li><code>2019-05-30-welcome/index.md</code></li></ul><p>A blog post folder can be convenient to co-locate blog post images:</p><p><img loading="lazy" alt="Docusaurus Plushie" src="/assets/images/docusaurus-plushie-banner-a60f7593abca1e3eef26a9afa244e4fb.jpeg" width="1500" height="500" class="img_ev3q"></p><p>The blog supports tags as well!</p><p><strong>And if you don't want a blog</strong>: just delete this directory, and use <code>blog: false</code> in your Docusaurus config.</p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[MDX Blog Post]]></title>
            <link>https://your-docusaurus-test-site.com/blog/mdx-blog-post</link>
            <guid>mdx-blog-post</guid>
            <pubDate>Sun, 01 Aug 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Blog posts support Docusaurus Markdown features, such as MDX.]]></description>
            <content:encoded><![CDATA[<p>Blog posts support <a href="https://docusaurus.io/docs/markdown-features" target="_blank" rel="noopener noreferrer">Docusaurus Markdown features</a>, such as <a href="https://mdxjs.com/" target="_blank" rel="noopener noreferrer">MDX</a>.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Use the power of React to create interactive blog posts.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'button clicked!'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Click</span><span class="token plain"> me</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">button</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><button>Click me!</button></div></div>]]></content:encoded>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[通过Composer使用Airflow运行一个workflow]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/6/12/Airflow_Dataproc</link>
            <guid>/2020/6/12/Airflow_Dataproc</guid>
            <pubDate>Fri, 12 Jun 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[创建Composer by setting up Composer environment >> create a workflow py file >>  创建Dataproc >> Runs Hadoop job on Dataproc >> deletes Dataproc cluster]]></description>
            <content:encoded><![CDATA[<p>创建Composer by setting up Composer environment &gt;&gt; create a workflow py file &gt;&gt;  创建Dataproc &gt;&gt; Runs Hadoop job on Dataproc &gt;&gt; deletes Dataproc cluster</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-create-enviroment-and-set-up-the-enviroment">step1 Create Enviroment and set up the Enviroment<a class="hash-link" href="#step1-create-enviroment-and-set-up-the-enviroment" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Name: highcpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Location: us-central1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone: us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Machine type: n1-highcpu-4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Python version 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/1-1-149d085e217c11f6353902734df52744.png" width="906" height="210" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/k-1-1df16c2dad1b5b699b15bcbb38da4ffd.png" width="1355" height="421" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/k-2-65b44c7e075ec0e2b4fabf5bb1542d9b.png" width="1356" height="393" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-创建gcs-bucket">step2 创建GCS bucket<a class="hash-link" href="#step2-创建gcs-bucket" title="Direct link to heading">​</a></h2><p>要记住bucket名字, 因为这个是放DAG file的</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-了解核心概念">step3 了解核心概念<a class="hash-link" href="#step3-了解核心概念" title="Direct link to heading">​</a></h2><p>Airflow是一个以编程方式编写，安排和监视工作流的平台。
使用Airflow将工作流编写为任务的有向无环图（DAG）, 就是单向的</p><p>DAG: 有向无环图是您要运行的所有任务的集合，以反映其关系和依赖性的方式进行组织。</p><p>Operator: 就是对单一任务的描述</p><p>Task: 操作员的参数化实例；DAG中的一个节点</p><p>Task Instance: 任务的特定运行；其特征是：DAG，任务和时间点。它具有指示性状态：运行，成功，失败，跳过</p><p><a href="https://airflow.apache.org/docs/stable/concepts.html#" target="_blank" rel="noopener noreferrer">更多概念可以查看链接</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-设定一个workflow-工作流">step4: 设定一个workflow 工作流<a class="hash-link" href="#step4-设定一个workflow-工作流" title="Direct link to heading">​</a></h2><ol><li>Composer workflows是由DAGs组成的. DAGs 就是被定义好的标准python文件, 这些文件都是放在Airflow的DAG_FOLDER中.</li><li>Airflow会动态地执行python文件的代码来构建DAGs对象</li><li>您可以根据需要拥有任意数量的DAG，每个DAG描述任意数量的任务。通常，每个DAG应对应一个逻辑工作流程workflow。</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">"""Example Airflow DAG that creates a Cloud Dataproc cluster, runs the Hadoop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wordcount example, and deletes the cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This DAG relies on three Airflow variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://airflow.apache.org/concepts.html#variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这里是在airflow web interface的admin&gt;&gt;varibale设置的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* gcp_project - Google Cloud Project to use for the Cloud Dataproc cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* gce_zone - Google Compute Engine zone where Cloud Dataproc cluster should be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* gcs_bucket - Google Cloud Storage bucket to use for result of Hadoop job.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  See https://cloud.google.com/storage/docs/creating-buckets for creating a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bucket.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from airflow import models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from airflow.contrib.operators import dataproc_operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from airflow.utils import trigger_rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Output file for Cloud Dataproc job. 输出文件地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 输出的地址是通过gcs+文件名字(wordcount) + 时间 + '/'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output_file = os.path.join(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    models.Variable.get('gcs_bucket'), 'wordcount',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime.datetime.now().strftime('%Y%m%d-%H%M%S')) + os.sep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Path to Hadoop wordcount example available on every Dataproc cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORDCOUNT_JAR = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'file:///usr/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Arguments to pass to Cloud Dataproc job.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wordcount_args = ['wordcount', 'gs://pub/shakespeare/rose.txt', output_file]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yesterday = datetime.datetime.combine(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime.datetime.today() - datetime.timedelta(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime.datetime.min.time())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_dag_args = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Setting start date as yesterday starts the DAG immediately when it is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # detected in the Cloud Storage bucket.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'start_date': yesterday,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # To email on failure or retry set 'email' arg to your email and enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # emailing here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'email_on_failure': False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'email_on_retry': False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # If a task fails, retry it once after waiting at least 5 minutes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'retries': 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'retry_delay': datetime.timedelta(minutes=5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'project_id': models.Variable.get('gcp_project')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># [START composer_hadoop_schedule]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with models.DAG(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'composer_hadoop_tutorial',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Continue to run DAG once per day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schedule_interval=datetime.timedelta(days=1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_args=default_dag_args) as dag:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # [END composer_hadoop_schedule]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Create a Cloud Dataproc cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_dataproc_cluster = dataproc_operator.DataprocClusterCreateOperator(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task_id='create_dataproc_cluster',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Give the cluster a unique name by appending the date scheduled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # See https://airflow.apache.org/code.html#default-variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cluster_name='composer-hadoop-tutorial-cluster-{{ ds_nodash }}',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_workers=2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zone=models.Variable.get('gce_zone'),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        master_machine_type='n1-standard-1',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        worker_machine_type='n1-standard-1')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Run the Hadoop wordcount example installed on the Cloud Dataproc cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # master node.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run_dataproc_hadoop = dataproc_operator.DataProcHadoopOperator(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task_id='run_dataproc_hadoop',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        main_jar=WORDCOUNT_JAR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cluster_name='composer-hadoop-tutorial-cluster-{{ ds_nodash }}',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        arguments=wordcount_args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Delete Cloud Dataproc cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete_dataproc_cluster = dataproc_operator.DataprocClusterDeleteOperator(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task_id='delete_dataproc_cluster',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cluster_name='composer-hadoop-tutorial-cluster-{{ ds_nodash }}',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Setting trigger_rule to ALL_DONE causes the cluster to be deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # even if the Dataproc job fails.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        trigger_rule=trigger_rule.TriggerRule.ALL_DONE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # [START composer_hadoop_steps]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Define DAG dependencies.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_dataproc_cluster &gt;&gt; run_dataproc_hadoop &gt;&gt; delete_dataproc_cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # [END composer_hadoop_steps]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为了协调这三个工作流程任务dag导入了以下运算符">为了协调这三个工作流程任务，DAG导入了以下运算符：<a class="hash-link" href="#为了协调这三个工作流程任务dag导入了以下运算符" title="Direct link to heading">​</a></h2><p>DataprocClusterCreateOperator：创建一个Cloud Dataproc集群。
DataProcHadoopOperator：提交Hadoop wordcount作业并将结果写入Cloud Storage存储桶。
DataprocClusterDeleteOperator：删除群集以避免产生持续的Compute Engine费用。</p><p>任务按顺序运行，您可以在文件的此部分中看到</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Define DAG dependencies.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create_dataproc_cluster &gt;&gt; run_dataproc_hadoop &gt;&gt; delete_dataproc_cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>DAG的名称为hadoop_tutorial，并且DAG每天运行一次。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">with models.DAG(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'composer_hadoop_tutorial',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Continue to run DAG once per day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        schedule_interval=datetime.timedelta(days=1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_args=default_dag_args) as dag:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于start_date传递给default_dag_args的设置为yesterday，因此Cloud Composer安排工作流在DAG上传后立即开始。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step5-设置airflow变量">step5 设置airflow变量<a class="hash-link" href="#step5-设置airflow变量" title="Direct link to heading">​</a></h2><ol><li>去airflow web interface </li></ol><p><img loading="lazy" alt="png" src="/assets/images/1-982189e233202b9c999e894ae433a0ff.png" width="904" height="361" class="img_ev3q"></p><ol start="2"><li>创建以下Aireflow变量gcp_project，gcs_bucket以及gce_zone：
<img loading="lazy" alt="png" src="/assets/images/2-895f294b60ea7ec57e0c2a62d250d9ee.png" width="1447" height="468" class="img_ev3q"></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step6-将dag上载到云存储">step6 将DAG上载到云存储<a class="hash-link" href="#step6-将dag上载到云存储" title="Direct link to heading">​</a></h2><p>在Cloud Shell中，将hadoop_tutorial.py复制并保存在本地虚拟机上</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/GoogleCloudPlatform/python-docs-samples</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>转到python-docs-samples目录：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd python-docs-samples/composer/workflows</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在，将hadoop_tutorial.py文件的副本上载到Cloud Storage存储桶，该存储桶在创建环境时会自动创建。您可以通过转到Composer &gt; 环境进行检查。单击您先前创建的环境，这将带您进入所创建环境的描述。查找DAGs folder，复制要替换的值，DAGs_folder_path并在以下命令中上传文件：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gsutil cp hadoop_tutorial.py DAGs_folder_path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-79af8188f8a9caee4012fda84d8ffdf1.png" width="1434" height="130" class="img_ev3q"></p><p>探索DAG运行
当您将DAG文件上传到dagsCloud Storage中的文件夹时，Cloud Composer会解析该文件。如果未找到错误，则工作流的名称将显示在DAG列表中，并且该工作流已排队等待立即运行。</p><p>确保您在Airflow Web界面的DAG选项卡上。此过程需要几分钟才能完成。刷新浏览器以确保您正在查看最新信息。
<img loading="lazy" alt="png" src="/assets/images/4-012a742252a1ce95a5bf11ea4a0f8c78.png" width="1515" height="653" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/5-29c28f30cff4ea1bc97a36866ef1ca96.png" width="1522" height="677" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/6-8ee15c66f86754e752b2e994e5cee3de.png" width="1500" height="693" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step7-重新运行工作流程">step7 重新运行工作流程<a class="hash-link" href="#step7-重新运行工作流程" title="Direct link to heading">​</a></h2><ol><li>单击create_dataproc_cluster图形。</li><li>单击清除以重置三个任务。</li><li>然后单击确定进行确认。请注意，create_dataproc_cluster周围的颜色已更改，状态为“正在运行”。
<img loading="lazy" alt="png" src="/assets/images/7-e08ab972a79b667b43452eb478b85c89.png" width="1760" height="686" class="img_ev3q"></li></ol><p>我们可以看到dataproc具体的运行情况
<img loading="lazy" alt="png" src="/assets/images/d-1-14c5486fac198be75aabef250292078e.png" width="1272" height="466" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/d-2-1d920d6ccabf6fd51b6d7b92887b72a3.png" width="1455" height="387" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/d-3-b546b609f41110f8b9745a5be427745c.png" width="920" height="933" class="img_ev3q"></p><p>job完成后,GSC的情况
<img loading="lazy" alt="png" src="/assets/images/gs-1-3109a2f4058bb96f715e82e0f0856587.png" width="1677" height="470" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/gs-2-4d1898af5d8043a8ca9358be2bdbc0c3.png" width="1111" height="574" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/gs-3-9ec8f034caa23d67c5a9994af0c70c21.png" width="718" height="188" class="img_ev3q"></p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[云上快速搭建WordPress网站]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/6/12/快速搭建wordpress网站</link>
            <guid>/2020/6/12/快速搭建wordpress网站</guid>
            <pubDate>Fri, 12 Jun 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[我们将会在这台服务器上搭建和部署LAMP环境，然后安装WordPress网站，最后向大家展示如何在WordPress网站使用微博挂件和网站统计平台]]></description>
            <content:encoded><![CDATA[<p>我们将会在这台服务器上搭建和部署LAMP环境，然后安装WordPress网站，最后向大家展示如何在WordPress网站使用微博挂件和网站统计平台</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-login-the-vm-instance">step1 Login the vm instance<a class="hash-link" href="#step1-login-the-vm-instance" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-d75e3744cd7cf9d91b09c97629a5536c.png" width="592" height="230" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step21-搭建开发环境">step2.1 搭建开发环境<a class="hash-link" href="#step21-搭建开发环境" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install httpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install httpd-manual mod_ssl mod_perl mod_auth_mysql #安装 apache 的扩展文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service httpd start #启动 apache http 服务。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig httpd on 设置开机自动启动 apache http 服务。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step22-校验">step2.2 校验<a class="hash-link" href="#step22-校验" title="Direct link to heading">​</a></h2><p>去公网ip查看</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step23-下载和安装mysql数据库">step2.3: 下载和安装MySQL数据库<a class="hash-link" href="#step23-下载和安装mysql数据库" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install mysql mysql-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service mysqld start #启动服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql_secure_installation #修改 MySQL 数据库 root 用户的密码，并提高 MySQL 数据库的安全性。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 输入以下命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -p123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show databases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create database wordpress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show databases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chkconfig mysqld on #设置开机自动启动MySQL服务</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/2-9110a7771d095d0ea87992588e0cd744.png" width="286" height="172" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step24-安装php语言环境">step2.4: 安装PHP语言环境<a class="hash-link" href="#step24-安装php语言环境" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install php php-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install gd php-gd gd-devel php-xml php-common php-mbstring php-ldap php-pear php-xmlrpc php-imap #安装 php 常用扩展包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service httpd restart #重启服务,这步很重要,必须重启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "&lt;?php phpinfo(); ?&gt;" &gt; /var/www/html/phpinfo.php #执行此命令，创建一个 php 页面，测试 PHP 环境</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step25-在浏览器测试php页面">step2.5 在浏览器测试php页面<a class="hash-link" href="#step25-在浏览器测试php页面" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">弹性ip/phpinfo.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-ca93b61657465436875d2d26be0e8476.png" width="962" height="712" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-安装部署wordpress">step3 安装部署wordpress<a class="hash-link" href="#step3-安装部署wordpress" title="Direct link to heading">​</a></h2><p>下载中文版WordPress安装包，请点击链接 <a href="https://cn.wordpress.org/%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%98%AFWordPress%E4%B8%AD%E6%96%87%E5%AE%98%E7%BD%91%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%89%BE%E5%88%B0%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%E5%B9%B6%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%EF%BC%9B" target="_blank" rel="noopener noreferrer">https://cn.wordpress.org/，这个是WordPress中文官网，可以找到最新的版本并下载安装；</a> 下载完成后,解压</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tar -xzf wordpress-4.7.4-zh_CN.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备份-wordpress-配置文件并将原有的示例配置文件样本保留">备份 WordPress 配置文件，并将原有的示例配置文件样本保留。<a class="hash-link" href="#备份-wordpress-配置文件并将原有的示例配置文件样本保留" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd wordpress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp wp-config-sample.php wp-config.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="进入-wp-configphp-的编辑页面">进入 wp-config.php 的编辑页面：<a class="hash-link" href="#进入-wp-configphp-的编辑页面" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim wp-config.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="按键盘-i-进入编辑状态修改配置文件的数据库信息修改-db_name-的参数值-database_name_here-为之前创建的数据库-wordpress">按键盘 i ，进入编辑状态，修改配置文件的数据库信息：修改 DB_NAME 的参数值 database_name_here 为之前创建的数据库 wordpress：<a class="hash-link" href="#按键盘-i-进入编辑状态修改配置文件的数据库信息修改-db_name-的参数值-database_name_here-为之前创建的数据库-wordpress" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">define('DB_NAME', 'wordpress');</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改-db_user-的参数值-username_here-为-root-">修改 DB_USER 的参数值 username_here 为 root :<a class="hash-link" href="#修改-db_user-的参数值-username_here-为-root-" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">define('DB_USER', 'root');</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改-db_password-的参数值-password_here-为-123-">修改 DB_PASSWORD 的参数值 password_here 为 123 :<a class="hash-link" href="#修改-db_password-的参数值-password_here-为-123-" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改完毕后点击-esc-退出编辑状态然后输入-wq-保存修改信息并退出配置文件">修改完毕后，点击 esc ，退出编辑状态，然后输入 :wq ，保存修改信息并退出配置文件<a class="hash-link" href="#修改完毕后点击-esc-退出编辑状态然后输入-wq-保存修改信息并退出配置文件" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="在-apache-的根目录-varwwwhtml-下创建一个-wp-blog-文件夹">在 Apache 的根目录 /var/www/html 下，创建一个 wp-blog 文件夹。<a class="hash-link" href="#在-apache-的根目录-varwwwhtml-下创建一个-wp-blog-文件夹" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /var/www/html/wp-blog</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="然后将-wordpress-迁移到这个新建文件夹中">然后，将 wordpress 迁移到这个新建文件夹中。<a class="hash-link" href="#然后将-wordpress-迁移到这个新建文件夹中" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mv * /var/www/html/wp-blog/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="完成如上配置后返回浏览器并访问-httpxxxxxxxxxwp-blogwp-admininstallphp-其中-xxxxxxxxx-为-ecs-实例的-弹性ip-填写如下信息完成后点击页面底部的-安装wordpress-开始安装-wordpress-">完成如上配置后，返回浏览器，并访问 <a href="http://xxx.xxx.xx.x/wp-blog/wp-admin/install.php" target="_blank" rel="noopener noreferrer">http://xxx.xxx.xx.x/wp-blog/wp-admin/install.php</a> ，其中 xxx.xxx.xx.x 为 ECS 实例的 弹性IP ，填写如下信息，完成后，点击页面底部的 安装WordPress ，开始安装 WordPress 。<a class="hash-link" href="#完成如上配置后返回浏览器并访问-httpxxxxxxxxxwp-blogwp-admininstallphp-其中-xxxxxxxxx-为-ecs-实例的-弹性ip-填写如下信息完成后点击页面底部的-安装wordpress-开始安装-wordpress-" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/4-a7504fd8a6b3d271ff7bd5cc44ade76d.png" width="802" height="808" class="img_ev3q"></p><p>获得密码: MsLE1ppUhzV!95xOyq</p><p><img loading="lazy" alt="png" src="/assets/images/5-6634557a2b4578dcfb46619f352bdd20.png" width="550" height="466" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/6-08832958c9e26cd758ef33a35d65a8b9.png" width="1436" height="792" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-使用cnzz帮你成为合格站长">step4 使用CNZZ帮你成为合格“站长”<a class="hash-link" href="#step4-使用cnzz帮你成为合格站长" title="Direct link to heading">​</a></h2><ol><li><p>本小节介绍主要：借助 CNZZ  平台观察 WordPress 网站一天有多少 IP 访问，那些 IP 都是从哪个页面进入到自己网站的等内容。</p></li><li><p>点击链接 <a href="https://web.umeng.com/main.php?c=user&amp;a=login" target="_blank" rel="noopener noreferrer">https://web.umeng.com/main.php?c=user&amp;a=login</a> 进行注册、登录。</p></li></ol><p>登录网址(<a href="https://workbench.umeng.com/" target="_blank" rel="noopener noreferrer">https://workbench.umeng.com/</a>)</p><ol start="3"><li>登录 CNZZ 数据统计专家网站后，填写以下信息，完成后点击 确认添加站点 。
<a href="https://web.umeng.com/main.php?c=site&amp;a=add" target="_blank" rel="noopener noreferrer">https://web.umeng.com/main.php?c=site&amp;a=add</a></li></ol><p><img loading="lazy" alt="png" src="/assets/images/7-309befabe11df64380fbcc0437df6ac4.png" width="818" height="718" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/8-955effc7a27adb1edd2a50dc01d69492.png" width="1206" height="683" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/9-b7a4a259a29ca5c2851ffe2446140d8a.png" width="590" height="521" class="img_ev3q"></p><ol start="4"><li><p>切换回 WordPress 网站的主页面，点击 外观 ，并选择子菜单下的 小工具
<img loading="lazy" alt="png" src="/assets/images/10-4fba44d06d7b72e146256bb509f96c9b.png" width="349" height="505" class="img_ev3q"> </p></li><li><p>嵌入代码
<img loading="lazy" alt="png" src="/assets/images/11-58f56e7b48dcc2f65fad27cc0fab995c.png" width="293" height="585" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/12-a0af51cb8cb739a2265ae7edd32bc4d2.png" width="594" height="701" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/13-c99c545a331dfe4c171216818ec0857a.png" width="1136" height="609" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/14-fbbd302cfc87df146d44b8699c32574d.png" width="744" height="316" class="img_ev3q">  </p></li><li><p>删除统计
<img loading="lazy" alt="png" src="/assets/images/15-1819e78253d6ca7a00b6af3d62f9b7f0.png" width="1212" height="444" class="img_ev3q"></p></li></ol>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[使用GKE(Google Kubernetes Engine)部署容器化应用 谷歌云快速入门(三)]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/5/1/Kubernetes</link>
            <guid>/2020/5/1/Kubernetes</guid>
            <pubDate>Fri, 01 May 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[link to 谷歌云快速入门(二) 存储文件然后共享]]></description>
            <content:encoded><![CDATA[<p>link to <a href="/blog/2020/5/1/GoogleCloudStorage">谷歌云快速入门(二) 存储文件然后共享</a></p><p>link to <a href="/blog/2020/5/1/TensorFlow">谷歌云快速入门(四) 训练TensorFlow模型</a></p><p>link to <a href="/blog/2020/5/1/docker">Container Registry 快速入门快速入门</a></p><p>link to <a href="/blog/2020/5/1/dockerhub">docker知识1</a></p><p>link to <a href="/blog/2020/5/1/dockerhub_2">docker知识2</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-选择项目启动kubernetes-engine页面">step 1 选择项目,启动Kubernetes Engine页面<a class="hash-link" href="#step-1-选择项目启动kubernetes-engine页面" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1_create_project-55dd9b54a6a102dab852ad63142196d9.png" width="1434" height="794" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/2_create_API-ac280bfc0678da78b88b650538d84d56.png" width="1444" height="797" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/3_Kubernetes-5026b745ed73287ff4697a4f4eb44698.png" width="985" height="383" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/4_activate_API-f0040991cc8bd42a879a7f718ceed27e.png" width="947" height="654" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/5_kubernetes-53aa4a9752413611829df4e075d4cfa6.png" width="1436" height="699" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-配置gcloud工具的默认设置">step 2 配置gcloud工具的默认设置<a class="hash-link" href="#step-2-配置gcloud工具的默认设置" title="Direct link to heading">​</a></h2><p>如需设置默认项目，请在 Cloud Shell 中运行以下命令：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config </span><span class="token builtin">set</span><span class="token plain"> project project</span><span class="token operator" style="color:#393A34">-</span><span class="token builtin">id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如需设置默认计算地区，请运行以下命令：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config </span><span class="token builtin">set</span><span class="token plain"> compute</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">zone compute</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">zone</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/2-d0c0d201ec53c310cf2eab1c020af2fb.png" width="691" height="64" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-创建gke集群">step3 创建GKE集群<a class="hash-link" href="#step3-创建gke集群" title="Direct link to heading">​</a></h2><p>一个集群包含至少一台群主实例机器和多台工作器机器,这些工作机器称为"节点".节点是运行Kubernetes进程的Compute Engine虚拟机实例,如下图
<img loading="lazy" alt="png" src="/assets/images/10_cluster-1fc6244631014a9f0d5a45febb47ae9e.png" width="995" height="769" class="img_ev3q"></p><p>如需创建集群，请运行以下命令, 其中，cluster-name 是集群选择的名称。：</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create cluster</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="获取用于该集群的身份验证凭据">获取用于该集群的身份验证凭据<a class="hash-link" href="#获取用于该集群的身份验证凭据" title="Direct link to heading">​</a></h4><p>创建集群后,需要获取身份验证凭据以便与该集群交互,命令为:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters get</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">credentials cluster</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此命令将 kubectl 配置为使用您创建的集群。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step4-创建deployment">step4 创建Deployment<a class="hash-link" href="#step4-创建deployment" title="Direct link to heading">​</a></h3><p>如果需要在集群中运行应用,需要运行一下命令:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment abc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">gcr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">clean</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">mountain</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">272313</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">flybirdgroup</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">classifier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个Kubernetes命令kubectl create deployment 会创建名为 abc-server 的 Deployment. 这个Deployment的Pod在其容器中运行hello-app映像</p><p>在此命令中:
--image 指定了要部署的容器镜像. 这个命令会从Container Registry(私有容器映像注册表)拉取gcr.io/clean-mountain-272313/flybirdgroup/classifier:latest</p><p>如何创建镜像和上传到私有容器镜像注册表</p><p>link to <a href="/blog/2020/5/1/docker">Container Registry 快速入门快速入门</a></p><p>link to <a href="/blog/2020/5/1/dockerhub">docker知识1</a></p><p>link to <a href="/blog/2020/5/1/dockerhub_2">docker知识2</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-公开deployment">step 5 公开deployment<a class="hash-link" href="#step-5-公开deployment" title="Direct link to heading">​</a></h3><p>部署应用后,需要将其公开到互联网,以便用户访问该应用.我们可以通过创建Service来公开应用,这是一种Kubernetes资源,可以将应用公开给外部流量.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deployment abc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token builtin">type</span><span class="token plain"> LoadBalancer \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">port </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">port </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">这里请注意</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">如果是flask应用</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">port 选择</span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="检查和查看应用">检查和查看应用<a class="hash-link" href="#检查和查看应用" title="Direct link to heading">​</a></h4><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">查看正在运行的pod</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-90db448eeb35e4af3272d1206a05d20a.png" width="984" height="285" class="img_ev3q">
如果status 是 Running 和 Ready的状态是1/1, 就可以进行下一步</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用-kubectl-get-service-检查-abc-server-service">使用 kubectl get service 检查 abc-server Service：<a class="hash-link" href="#使用-kubectl-get-service-检查-abc-server-service" title="Direct link to heading">​</a></h4><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get service abc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">server </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过这个命令可以得到external-ip,复制service的外部ip地址,替换external-ip</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">external</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ip</span><span class="token operator" style="color:#393A34">/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样就想GKE(google Kebernetes Engine部署了一个容器化web应用)</p><p><img loading="lazy" alt="png" src="/assets/images/7-d47f84af6d0b07a1cd6fffc824d0e5f8.png" width="696" height="429" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/8-b10b3b1225e0ee82e352d7671e31b606.png" width="1199" height="423" class="img_ev3q"></p><h1>查看service</h1><p>可以查看kubernetes的所有service</p><div class="language-kubernetes codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kubernetes codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get service # </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这些service非常重要,因为pod之间的相连就是通过这些service的</p><h1>删除pod</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod jenkins2-8698b5449c-grbdm(pod的名字)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们会发现pod没有被删除,这时候我们要输入一下命令</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete deployment 名字name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>就完全删除了</p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[linux高级用法]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/30/linux命令</link>
            <guid>/2020/4/30/linux命令</guid>
            <pubDate>Thu, 30 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[linux一些好玩的命令比如循环,重定向]]></description>
            <content:encoded><![CDATA[<p>linux一些好玩的命令比如循环,重定向</p><h1>循环</h1><div class="language-linux codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-linux codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for i in {1..50}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>重定向 |, &lt;&lt;, &gt;&gt;, &gt;, &gt;&gt;是a,累积写入, &gt;是w,覆盖写入</h1><p>就是如果一开始没有这个文件,执行&gt;&gt;和&gt;是一样的,但是如果再执行一次,执行&gt;后,文件内容一样,但是&gt;&gt;就有两次原来的内容,</p><div class="language-linxus codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-linxus codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; b.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">haha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lala</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mama</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gege</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jiejie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; b.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">haha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lala</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mama</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gege</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jiejie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以我们这里可以用循环来</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for i in {1..50}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; b.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">field_$i,decimal,"12,49"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for i in {1..50}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; b.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">field_$i,decimal,"12,49"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>linux</category>
            <category>command line</category>
            <category>cat</category>
            <category>&lt;&lt;EOF</category>
            <category>loop</category>
        </item>
        <item>
            <title><![CDATA[python读取bigquery]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/30/python读取Biggquery</link>
            <guid>/2020/4/30/python读取Biggquery</guid>
            <pubDate>Thu, 30 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[安装客户端]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装客户端">安装客户端<a class="hash-link" href="#安装客户端" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade google-cloud-bigquery[bqstorage,pandas]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="导入工具包创建客户端对象">导入工具包,创建客户端对象<a class="hash-link" href="#导入工具包创建客户端对象" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from google.cloud import bigquery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client = bigquery.Client()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行查询">运行查询<a class="hash-link" href="#运行查询" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">query_job = client.query("""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CONCAT(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'https://stackoverflow.com/questions/',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CAST(id as STRING)) as url,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      view_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FROM `bigquery-public-data.stackoverflow.posts_questions`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WHERE tags like '%google-bigquery%'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ORDER BY view_count DESC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LIMIT 10""")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results = query_job.result()  # Waits for job to complete.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="转成dataframe">转成dataframe<a class="hash-link" href="#转成dataframe" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df = results.to_dataframe()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="显示查询结果">显示查询结果<a class="hash-link" href="#显示查询结果" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df.iloc[:,:5] #显示dataframe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>linux</category>
            <category>command line</category>
            <category>cat</category>
            <category>&lt;&lt;EOF</category>
            <category>loop</category>
        </item>
        <item>
            <title><![CDATA[设立Jenkins在GKE上]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/30/创建jenkins在GKE</link>
            <guid>/2020/4/30/创建jenkins在GKE</guid>
            <pubDate>Thu, 30 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[设置zone和下载代码]]></description>
            <content:encoded><![CDATA[<p>设置zone和下载代码</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set compute/zone us-east1-d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/GoogleCloudPlatform/continuous-deployment-on-kubernetes.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd continuous-deployment-on-kubernetes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建GKE集群</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create jenkins-cd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--num-nodes 2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--machine-type n1-standard-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--scopes "https://www.googleapis.com/auth/projecthosting,cloud-platform"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查询cluster是否运行</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>获取凭证去连接你的GKE</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters get-credentials jenkins-cd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>确认是否能连接到集群</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl clusters-info</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装Helm</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://storage.googleapis.com/kubernetes-helm/helm-v2.9.1-linux-amd64.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解压</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tar zxfv helm-v2.9.1-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp linux-amd64/helm .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>添加自己作为云的管理者🙆给jenkins权限到集群</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create clusterrolebinding cluster-admin-binding --clusterrole=cluster-admin --user=$(gcloud config get-value account)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>给Tiller集群管理者权限</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create serviceaccount tiller --namespace kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create clusterrolebinding tiller-admin-binding --</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole=cluster-admin --serviceaccount=kube-system:tiller</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>初始化helm,这样可以保证Helm(Tiller)服务端是正确安装到集群上</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./helm init --service-account=tiller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./helm repo update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>确认helm是否安装成功,应该看到出现在服务端和客户端是v2.9.1</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./helm version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用Helm CLI命令去部署设置</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./helm install -n cd stable/jenkins -f jenkins/values.yaml --version 0.16.6 --wait</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>确认jenkins pod运行</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectil get pods</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>运行命令去设置jenkins UI界面</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export POD_NAME=$(kubectl get pods -l "component=cd-jenkins-master" -o jsonpath="{.items[0].metadata.name}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward $POD_NAME 8080:8080 &gt;&gt; /dev/null &amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试Jenkins Service是否创建正确</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>连接到Jenkins-Jenkins会自动创建密码,获取它,运行一下命令:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">printf $(kubectl get secret cd-jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我这边出现的密码是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">JrK3zwoGFI</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后去gcloud shell 的Web Preview上选择Preview on Port 8080,
<img loading="lazy" alt="png" src="/assets/images/1-84d1804afa5d1ae7e58c373914671f8d.png" width="1513" height="680" class="img_ev3q">
然后输入</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">username: admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password: JrK3zwoGFI</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/2-f8a26dc932241c3d37acd1d5a1780e2a.png" width="1223" height="566" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="删除命令">删除命令:<a class="hash-link" href="#删除命令" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete deployment 名字name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#删除pod后,删除clusters</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>gcloud containers clusters delete name</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">![png](../img/Jenkins/3.png)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>Jenkins</category>
            <category>GKE</category>
        </item>
        <item>
            <title><![CDATA[Bigquery常用命令]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/29/bq_常用命令</link>
            <guid>/2020/4/29/bq_常用命令</guid>
            <pubDate>Wed, 29 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[查看数据集的schema 使用bq show 数据集]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看数据集的schema-使用bq-show-数据集">查看数据集的schema 使用bq show 数据集<a class="hash-link" href="#查看数据集的schema-使用bq-show-数据集" title="Direct link to heading">​</a></h2><h1>增 bq mk, bk load <a href="https://cloud.google.com/bigquery/docs/loading-data-local#cli_1" target="_blank" rel="noopener noreferrer">具体可以参考</a></h1><div class="language-bq codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bq codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq mk babaynames 创建新的数据集,在自己项目中命名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### 创建表格 bq load datasetID tableID data_file Schema</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq load 数据集ID.表格ID(如果空就自己创建一个)  数据文件(比如txt) schema类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq load datasetID.tableid your_file name:string,gender:string,count:integer(your schema)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq load --source_format=AVRO fakedatas.customer "gs://zz_bucket/avro/cust.avro" (avro文件)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>还可以改用 --autodetect 标志，而无需提供架构定义。</p><h1>删 bq rm -r</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="删除数据集-bq-rm">删除数据集 bq rm<a class="hash-link" href="#删除数据集-bq-rm" title="Direct link to heading">​</a></h2><p>bq rm -r 数据集id</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq rm -r babynames</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>显示 bq ls, bq show</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="检测表格是否创建成功或者更新成功">检测表格是否创建成功或者更新成功<a class="hash-link" href="#检测表格是否创建成功或者更新成功" title="Direct link to heading">​</a></h3><p>创建后,可以通过bq ls 数据集id 查看是否创建成功
也可以通过bq show 数据集id.tableid 查看schema</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq ls 显示所有dataset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq ls babaynames 显示datasetid的所有table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq show datasetid 显示dataset的ACL(权限) 比如可以看到 谁是owners,writers,readers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq show babynames.names2010 显示table的schema类型,多少文本数,字段</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查 bq query --use_legacy_sql=false 'select * from dataset.table'</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## 运行sql语句命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">总体格式就是 bq query --use_legacy_sql=false 'select 字段 耦合字段(比如count(*)) from datasetid.tableid where 条件 order by 字段 (做排序ASC,DESC) Limit 数字(限制条数)'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">注意的地方是 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### use_legacy_sql=false 表示使用标准sql语句</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### 条件的时候可以使用双引号做区分""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq query "select name,count from babynames.names2010 where gender = 'F' Order by count desc limit 5"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq query --use_legacy_sql=false 'SELECT word,SUM(word_count) AS count FROM `bigquery-public-data`.samples.shakespeare WHERE word LIKE "%raisin%" GROUP BY word'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">第二个例子是选择从bq公共集中选择samples这个dataset,然后从这个dataset的shakespeare表中选择word字段, 执行条件是 word字段必须等于"huzzah"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq query --use_legacy_sql=false 'SELECT word FROM `bigquery-public-data`.samples.shakespeare WHERE word = "huzzah"'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行帮助命令">运行帮助命令<a class="hash-link" href="#运行帮助命令" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq help query</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载数据到项目中">下载数据到项目中<a class="hash-link" href="#下载数据到项目中" title="Direct link to heading">​</a></h3><p>使用wget 数据源连接(比如zip,txt,csv等)</p><div class="language-wget codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-wget codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget http://www.ssa.gov/OACT/babynames/names.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解压缩zip文件到项目中">解压缩zip文件到项目中<a class="hash-link" href="#解压缩zip文件到项目中" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">unzip names.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>gcp</category>
            <category>command line</category>
            <category>github</category>
        </item>
        <item>
            <title><![CDATA[GCS 读写 by python]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/29/_GCS读写by python</link>
            <guid>/2020/4/29/_GCS读写by python</guid>
            <pubDate>Wed, 29 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[我们可以使用谷歌的Python客户端API将文件上传到谷歌云存储。]]></description>
            <content:encoded><![CDATA[<p>我们可以使用谷歌的Python客户端API将文件上传到谷歌云存储。</p><h1>方法一:</h1><p>首先，如下安装api客户端。</p><blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade google-api-python-client </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，启用api身份验证以获取应用程序默认凭据。</p></blockquote><blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud beta auth application-default login </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以下是使用应用程序默认凭据将本地文件上传到Google云存储的示例代码。</p></blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from googleapiclient import discovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from oauth2client.client import GoogleCredentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">credentials = GoogleCredentials.get_application_default()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service = discovery.build('storage', 'v1', credentials=credentials)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filename = './account_id_schema_new.csv'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bucket = 'bq-pandas-bucket'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">body = {'name': 'dest_file_name.csv'}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">req = service.objects().insert(bucket=bucket, body=body, media_body=filename)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esp = req.execute()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>方法二--仅仅需要安装两个包</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install dask[dataframe] --upgrade --user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install gcsfs --user</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="例子">例子<a class="hash-link" href="#例子" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-87148375fa5c2cd8daf00b46ea34788b.png" width="1111" height="363" class="img_ev3q"></p><p>原来无论用pandavro或者pandas都是读取不了GCS的文件的</p><p>但是安装包后,就可以读取GCS文件了
<img loading="lazy" alt="png" src="/assets/images/2-76c7be6c3fd57735e3ade8bef42fccee.png" width="664" height="590" class="img_ev3q"></p><p>然后写入gcs,就想平时那样,直接to_csv就可以了
<img loading="lazy" alt="png" src="/assets/images/3-c5631af155f84a51db475704385e9c91.png" width="1117" height="198" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import dask.bag as db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b = db.read_avro('gs://zz_mm_bucket/account_id_schema_new.avro')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df = b.to_dataframe()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>terraform</category>
            <category>gcp</category>
            <category>compute engine</category>
            <category>vm</category>
        </item>
        <item>
            <title><![CDATA[gsutil常用命令]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/29/_gsutil常用命令</link>
            <guid>/2020/4/29/_gsutil常用命令</guid>
            <pubDate>Wed, 29 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[gsutil命令快速入门]]></description>
            <content:encoded><![CDATA[<p><a href="https://cloud.google.com/storage/docs/quickstart-gsutil" target="_blank" rel="noopener noreferrer">gsutil命令快速入门</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mb </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil mb -l us-east1 gs://my-awesome-bucket/ #创建bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp 复制下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil cp Desktop/kitten.png gs://my-awesome-bucket 复制文件到bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil cp gs://my-awesome-bucket/kitten.png Desktop/kitten2.png 从bucket上下载文件到本地</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil cp gs://my-awesome-bucket/kitten.png gs://my-awesome-bucket/just-a-folder/kitten3.png 复制bucket里的文件到bucket里面的文件夹中</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls 列举</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil ls gs://my-awesome-bucket 列举bucket内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil ls -l gs://my-awesome-bucket/kitten.png 列举bucket文件的详细信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">acl account credential limit 权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil acl ch -u AllUsers:R gs://my-awesome-bucket/kitten.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">使用 gsutil acl ch 命令向所有用户授予存储在存储分区中的对象的读取权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil acl ch -d AllUsers gs://my-awesome-bucket/kitten.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">使用 gsutil acl ch 命令向所有用户移除存储在存储分区中的对象的读取权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iam -向某人授予和移除您的存储分区的访问权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil iam ch user:jane@gmail.com:objectCreator,objectViewer gs://my-awesome-bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil iam ch -d user:jane@gmail.com:objectCreator,objectViewer gs://my-awesome-bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm 清除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil rm gs://my-awesome-bucket/kitten.png 删除文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil rm -r gs://my-awesome-bucket 清除bucket</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>terraform</category>
            <category>gcp</category>
            <category>compute engine</category>
            <category>vm</category>
        </item>
        <item>
            <title><![CDATA[使用terraform基本语法和创建vm]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/27/_terraform</link>
            <guid>/2020/4/27/_terraform</guid>
            <pubDate>Mon, 27 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[我觉得terraform的基本语法就是字典对象式语法.]]></description>
            <content:encoded><![CDATA[<p>我觉得terraform的基本语法就是字典对象式语法.</p><p>总体结构就是 </p><ol><li><p>instance.tf 用来创作资源的文件,比如vm instance,storage bucket,bigquery等</p></li><li><p>variables.tf 参数变量文件,用来写那些变量的,变量的格式为 variable "project" {} 就是: variable + 名字 + {}</p></li><li><p>terraform.tfvars 用来写变量具体等于什么的, 比如 project = "terraform-45110831"</p></li><li><p>output.tf 在创建实例后,打印输出我们觉得重要的参数, 具体格式 output 名字 {value = "${变量}"} 如output "ip" {value = "${google_compute_address.vm_static_ip.address}"} 口诀: 2美元1file4引号,简称"214"!!</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其中详细的用法我们可以去官网9步教程学习非常简单但是很多坑但是走完坑后感觉就基本上手了">其中详细的用法我们可以去<a href="https://learn.hashicorp.com/terraform/gcp/change" target="_blank" rel="noopener noreferrer">官网9步教程学习</a>,非常简单,但是很多坑,但是走完坑后,感觉就基本上手了<a class="hash-link" href="#其中详细的用法我们可以去官网9步教程学习非常简单但是很多坑但是走完坑后感觉就基本上手了" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="其中5个点需要注意的是">其中5个点需要注意的是:<a class="hash-link" href="#其中5个点需要注意的是" title="Direct link to heading">​</a></h2><ol><li><p>变量的写法 "${var.project}"</p></li><li><p>如果变量是个文件的话: "${file("${var.jupyter_sh}")}"  ${file("${var.jupyter.sh}")} 也就是 "${file("${变量}")}"</p></li><li><p>还有就是字典属性都是用.来引用</p></li><li><p>tag的使用,因为tag属性的添加对于vm instance尤其重要</p></li><li><p>使用meta_startup_script脚本,可以在创建vm instance后通过脚本运行程序,非常有用</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用vs-code连接远程服务器">使用vs code连接远程服务器<a class="hash-link" href="#使用vs-code连接远程服务器" title="Direct link to heading">​</a></h2><p>在vs code 界面 按fn+F1, </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">F1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i ~/.ssh/id_rsa flybird@34.73.166.222 (连接远程服务器)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>连接成功后,我们就可以在服务器准备创建vm instance了</p><h1>使用terraform创建VM</h1><p>使用terraform可以很快的,可复制性的配置一个vm机器</p><h1>1 首先我们要安装terraform,安装的具体教程请看<a href="https://learn.hashicorp.com/terraform/gcp/install" target="_blank" rel="noopener noreferrer">terraform安装</a></h1><p>大致步骤是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">下载 terraform_0.12.24_linux_amd64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unzip terraform_0.12.24_linux_amd64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo snap install terraform 安装terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform 确认terraform是否安装成功</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>terraform安装好后,我们去GCP&gt;&gt;APIs$Services&gt;&gt;Credentials创建service account,下载json文件,保存好
terraform创建教程我们可以去<a href="https://learn.hashicorp.com/terraform/gcp/change" target="_blank" rel="noopener noreferrer">terraform入门教程</a>看到</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-我们这里会创建一个instancetf文件">2 我们这里会创建一个instance.tf文件<a class="hash-link" href="#2-我们这里会创建一个instancetf文件" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">provider "google" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  credentials = "terraform-45110831-450974fa2608.json"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project = "terraform-45110831"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region  = "us-central1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zone    = "us-central1-a"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource "google_compute_network" "vpc_network" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name = "terraform-network"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource "google_compute_instance" "default" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project      = "terraform-45110831"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name         = "terraform"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  machine_type = "n1-standard-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zone         = "us-central1-a"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  boot_disk {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initialize_params {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image = "debian-cloud/debian-9"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network = "default"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>resource 后面跟两个字段,第一个是resource type字段和resource name, 这里的resource type是google_compute_instance, name是 terraform, google_compute_instance 会自动告诉terraform这个是谷歌的provider</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-写好配置后我们输入一下命令">3 写好配置后,我们输入一下命令<a class="hash-link" href="#3-写好配置后我们输入一下命令" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个命令或初始化很多后续会被用到的命令的本地设置和数据
google provider plugin 会被下载和安装</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-初始化后我们可以查看整体计划查看设置是否符合我们的要求输入这个命令的时候gcp不会部署vm">4 初始化后,我们可以查看整体计划,查看设置是否符合我们的要求,输入这个命令的时候,GCP不会部署vm<a class="hash-link" href="#4-初始化后我们可以查看整体计划查看设置是否符合我们的要求输入这个命令的时候gcp不会部署vm" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-觉得没有问题我们就可以应用了">5 觉得没有问题,我们就可以应用了<a class="hash-link" href="#5-觉得没有问题我们就可以应用了" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个命令就会执行之前plan的东西</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">An execution plan has been generated and is shown below.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resource actions are indicated with the following symbols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Terraform will perform the following actions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # google_compute_instance.default will be created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  + resource "google_compute_instance" "default" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + can_ip_forward       = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + cpu_platform         = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + deletion_protection  = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + guest_accelerator    = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + id                   = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + instance_id          = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + label_fingerprint    = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + machine_type         = "n1-standard-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + metadata_fingerprint = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + name                 = "terraform"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + project              = "qwiklabs-gcp-42390cc9da8a4c4b"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + self_link            = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + tags_fingerprint     = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + zone                 = "us-central1-a"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + boot_disk {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + auto_delete                = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + device_name                = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + disk_encryption_key_sha256 = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + kms_key_self_link          = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + source                     = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + initialize_params {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + image  = "debian-cloud/debian-9"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + labels = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + size   = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + type   = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + network_interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + address            = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + name               = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + network            = "default"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + network_ip         = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + subnetwork         = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + subnetwork_project = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + access_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + assigned_nat_ip = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + nat_ip          = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + network_tier    = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      + scheduling {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + automatic_restart   = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + on_host_maintenance = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + preemptible         = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          + node_affinities {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + key      = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + operator = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              + values   = (known after apply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Plan: 1 to add, 0 to change, 0 to destroy.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Do you want to perform these actions?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Terraform will perform the actions described above.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Only 'yes' will be accepted to approve.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Enter a value:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们看到 +, 这意味Terraform会创建这个资源,我们能看到很多属性,如果有的value是显示computed,这意味着这value会等到resource创建后才知道</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-显示vm-的配置">6 显示vm 的配置<a class="hash-link" href="#6-显示vm-的配置" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="71-我们可以使用terraform去修改resources">7.1 我们可以使用terraform去修改resources<a class="hash-link" href="#71-我们可以使用terraform去修改resources" title="Direct link to heading">​</a></h2><p>比如我们可以在 resource google_compute_instance 上添加tags</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板-如果tags上添加http-serverhttps-server后firewalls防火墙就allow-http-traffic和-https-traffic了">敲黑板!!! 如果tags上添加"http-server","https-server"后,Firewalls防火墙就allow http traffic和 https traffic了<a class="hash-link" href="#敲黑板-如果tags上添加http-serverhttps-server后firewalls防火墙就allow-http-traffic和-https-traffic了" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resource "google_compute_instance" "default" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project      = "terraform-45110831"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name         = "terraform"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  machine_type = "n1-standard-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zone         = "us-central1-a"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags         = ["web", "dev","http-server","https-server"]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在终端输入terraform init, terraform plan后,就会出现</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Terraform will perform the following actions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ~ google_compute_instance.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags.#:         "0" =&gt; "2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags.292811013: "" =&gt; "dev"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tags.365508689: "" =&gt; "web"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>terraform apply 就会对resource进行修改</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="72-也支持破坏性修改比如更换磁盘镜像比如从debian-9映像更改为使用google的container-optimized-os">7.2 也支持破坏性修改,比如更换磁盘镜像,比如从Debian 9映像更改为使用Google的Container-Optimized OS<a class="hash-link" href="#72-也支持破坏性修改比如更换磁盘镜像比如从debian-9映像更改为使用google的container-optimized-os" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">boot_disk {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initialize_params {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image = "cos-cloud/cos-stable"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>terrform init&gt; terrform plan &gt;terrform apply后
我们可以看到internal IP 和 external ip改变了,然后我们登陆进vm instance后,我们之前的所以资料都没有了</p><h1> 所以如果进行destructive change前,一定要注意 </h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-terraform-destroy">8 terraform destroy<a class="hash-link" href="#8-terraform-destroy" title="Direct link to heading">​</a></h2><p>输入命令后:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">An execution plan has been generated and is shown below.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resource actions are indicated with the following symbols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - destroy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Terraform will perform the following actions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - google_compute_instance.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - google_compute_network.vpc_network</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>terraform destroy命令销毁资源,该命令类型于terraform apply,terraform确定必须销毁物件的顺序,如果还有资源,GCP将不允许删除VPC网络,因此Terraform会等到实例被销毁后再销毁网络,terraform执行操作的时候,terraform将建一个依赖关系图已确定销毁顺序.在具有多个资源的更复杂的情况下,Terraform将在安全的情况下并行执行操作.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gcp也可以删除">GCP也可以删除<a class="hash-link" href="#gcp也可以删除" title="Direct link to heading">​</a></h2><p>我们可以去GCP shell中输入一下命令</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute instances delete instance名字</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们还可以使resource与resource之间相互依赖,使用depends_on = <!-- -->[""]<!-- -->
比如我可以现在创建一个storage bucket, 我们可以设置在创建storage bucket前一定要创建 vm先</p><p>resource "google</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resource "google_compute_instance" "default" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project      = "terraform-45110831"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name         = "terraform"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  machine_type = "n1-standard-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zone         = "us-central1-a"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags         = ["web", "dev"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource "google_storage_bucket" "example_bucket" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on = ["google_compute_instance.default"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-可以在本终端输入命令provisioners">9 可以在本终端输入命令<a href="https://www.terraform.io/docs/provisioners/index.html" target="_blank" rel="noopener noreferrer">Provisioners</a><a class="hash-link" href="#9-可以在本终端输入命令provisioners" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resource "google_compute_instance" "vm_instance" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name         = "terraform-instance"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  machine_type = "f1-micro"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags         = ["web", "dev"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  provisioner "local-exec" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command = "echo ${google_compute_instance.vm_instance.name}:  ${google_compute_instance.vm_instance.network_interface.0.access_config.0.nat_ip} &gt;&gt; ip_address.txt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="每个vm实例可以具有多个网络接口因此我们的network-interface0就是引用第一个每个网络接口也具有多个access_config快我们选择acess_config0指定引用第一个">每个vm实例可以具有多个网络接口,因此我们的network interface.0就是引用第一个,每个网络接口也具有多个access_config快,我们选择acess_config.0指定引用第一个<a class="hash-link" href="#每个vm实例可以具有多个网络接口因此我们的network-interface0就是引用第一个每个网络接口也具有多个access_config快我们选择acess_config0指定引用第一个" title="Direct link to heading">​</a></h2><h1>terraform的核心在于变量,我个人感觉就像是javascript的字典对象,所以属性都用.来引用, 另外变量的表示方法为美元符号$ + {变量} 就是 ${google_compute_instance.vm_instance}</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="但是你发现ip_addresstxt在terraform-apply后没有创建成功">但是你发现ip_address.txt在terraform apply后没有创建成功<a class="hash-link" href="#但是你发现ip_addresstxt在terraform-apply后没有创建成功" title="Direct link to heading">​</a></h2><p>因为预配器provisioner只是在创建资源时运行,但是添加provisioner不会强制销毁和重新创建该资源,所以我们要用terraform taint告诉terraform,需要重新创建实例</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform taint google_compute_instance.vm_instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat ip_address.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以看到txt文件内容了</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="101-创建vm-instance成功后我们需要添加sshkey然后我们可以连接external-ip通过以下命令">10.1 创建vm instance成功后,我们需要添加sshkey,然后我们可以连接external ip,通过以下命令:<a class="hash-link" href="#101-创建vm-instance成功后我们需要添加sshkey然后我们可以连接external-ip通过以下命令" title="Direct link to heading">​</a></h2><div class="language-linux codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-linux codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen 产生id-rsa.pub, 复制其内容,在vm的meta data上粘贴好</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh username@external_ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="102-如果出现permisson-dennied可以直接在vm机上把ssh-key删掉然后在本地重新创建ssh-key然后复制粘贴到-meta-data上">10.2 如果出现permisson dennied,可以直接在vm机上把ssh key删掉,然后在本地重新创建ssh key,然后复制粘贴到 meta data上<a class="hash-link" href="#102-如果出现permisson-dennied可以直接在vm机上把ssh-key删掉然后在本地重新创建ssh-key然后复制粘贴到-meta-data上" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-起始脚本metadata_startup_script">11 起始脚本metadata_startup_script<a class="hash-link" href="#11-起始脚本metadata_startup_script" title="Direct link to heading">​</a></h2><p>我们在创建resouce google_compute_instance 的时候,我们可以添加一个metadata_startup_script属性,这个是用来运行在创建的vm虚拟机上的,比如我们可以通过这个脚本创建<a href="/blog/2020/4/27/jupyterhub_GCP">jupyter和python的工具(请看案例)</a>等,脚本是在root目录运行,</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如果我们想在home目录运行请cd-home用户名">如果我们想在home目录运行,请cd home/用户名<a class="hash-link" href="#如果我们想在home目录运行请cd-home用户名" title="Direct link to heading">​</a></h3><div class="language-linux codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-linux codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">metadata_startup_script = "${file("${var.jupyter_sh}")}" </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>terraform</category>
            <category>gcp</category>
            <category>compute engine</category>
            <category>vm</category>
        </item>
        <item>
            <title><![CDATA[关于nginx和port知识总结]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/26/关于nginx和port知识总结</link>
            <guid>/2020/4/26/关于nginx和port知识总结</guid>
            <pubDate>Sun, 26 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[port是service服务的端口]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="port是service服务的端口">port是service服务的端口<a class="hash-link" href="#port是service服务的端口" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="targetport是pod也就是容器的端口">targetport是pod也就是容器的端口<a class="hash-link" href="#targetport是pod也就是容器的端口" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nodeport是容器所在宿主机的端口通过service暴露给宿主机而port去没有">nodeport是容器所在宿主机的端口(通过service暴露给宿主机,而port去没有)<a class="hash-link" href="#nodeport是容器所在宿主机的端口通过service暴露给宿主机而port去没有" title="Direct link to heading">​</a></h2><p>port的主要作用是clusters集群里面的一个pod访问其他pod的时候,需要端口port,比如集群里面nginx需要访问mysql,那么久需要mysql的target port,</p><div class="language-mysql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mysql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: mysql-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - port: 33306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    targetPort: 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   name: mysql-pod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>比如nginx通过访问service的33306端口,service根据selector中的name,将请求转发到mysql-pod这个pod的3306端口
通过POST创建 service</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "kind": "Service",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "apiVersion": "v1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "metadata": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "name": "my-service"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "spec": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "selector": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "app": "MyApp"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "ports": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "name": "http",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "protocol": "TCP",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "port": 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "targetPort": 9376</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "name": "https",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "protocol": "TCP",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "port": 443,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "targetPort": 9377</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对于每个运行的pod,kubernete将其添加给现有的service的全局变量, 比如叫做"redis-master"的service,对外映射6379端口,
service要想被pod使用,必须先比pod建立
所以总体流程就pod之间都是通过service来相互访问,所以先service的port,然后service通过selector找到name,再把请求发送到name对应的target port</p><h1><a href="https://www.cnblogs.com/mq0036/p/9794540.html" target="_blank" rel="noopener noreferrer">Nginx基础知识</a></h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nginx能做的事情">nginx能做的事情:<a class="hash-link" href="#nginx能做的事情" title="Direct link to heading">​</a></h2><p>1 <a href="https://www.jianshu.com/p/ae76c223c6ef" target="_blank" rel="noopener noreferrer">正向,方向代理</a>
2 负载均衡
3 http服务器-动静分离</p><p><img loading="lazy" alt="png" src="/assets/images/nginx-32166c5e820aba1ead89f0718446fc2e.png" width="522" height="660" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="正向代理是nginx-proxy给client代理然后对接server获取内容">正向代理是nginx proxy给client代理,然后对接Server,获取内容<a class="hash-link" href="#正向代理是nginx-proxy给client代理然后对接server获取内容" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="方向代理是proxy给server做代理clients访问proxy获取内容">方向代理是proxy给Server做代理,clients访问proxy获取内容<a class="hash-link" href="#方向代理是proxy给server做代理clients访问proxy获取内容" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nginx的负载均衡有一下几个策略">nginx的负载均衡有一下几个策略:<a class="hash-link" href="#nginx的负载均衡有一下几个策略" title="Direct link to heading">​</a></h3><p>1 RR- 按照请求时间顺序分配到不同的后端服务器,后端服务器挂掉,就自动剔除
2 权重- 给不同服务器赋予权重,权重大的,就承当更多访问
3 ip_hash- 因为客户登录信息保存在session中,如果跳转到另外一台服务器的时候,需要重新登录,所以ip_hash的方法让一个客户只访问一台服务器
4 fair(第三方)- 按后端服务器的响应时间来分配请求,响应越短,就越先分配
5 url_hash- 就是设定方向url连接是访问那台服务器,后端服务器为缓存时比较有效</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="动静分离">动静分离<a class="hash-link" href="#动静分离" title="Direct link to heading">​</a></h3><p>nginx本身就是一台服务器,所以可以保存一些静态资源,也就是我们可以把动态网站里的动态网页按照一定规则把不变的资源和经常变的资源区分开来,动静</p>]]></content:encoded>
            <category>nginx</category>
            <category>port</category>
            <category>target</category>
            <category>load-balance</category>
        </item>
        <item>
            <title><![CDATA[读取avro文件的schema]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/21/python读取avro的schema</link>
            <guid>/2020/4/21/python读取avro的schema</guid>
            <pubDate>Tue, 21 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[首先安装包]]></description>
            <content:encoded><![CDATA[<p>首先安装包</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install avro-python3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在py文件倒入包</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from avro.datafile import DataFileReader, DataFileWriter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import avro.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reader = avro.datafile.DataFileReader(open('./account_id_schema_new.avro',"rb"),avro.io.DatumReader())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">schema = reader.meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(schema)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>显示的效果如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{'avro.schema': b'{"fields": [{"type": ["null", "string"], "name": "ACNO"}, {"type": ["null", "double"], "name": "FIELD_1"}, {"type": ["null", "double"], "name": "FIELD_2"}, {"type": ["null", "double"], "name": "FIELD_3"}], "type": "record", "name": "Root"}',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 'avro.codec': b'null'}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>avro</category>
            <category>bigquery</category>
        </item>
        <item>
            <title><![CDATA[把avro文件放到bigquery]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/21/把avro文件放到bigquery</link>
            <guid>/2020/4/21/把avro文件放到bigquery</guid>
            <pubDate>Tue, 21 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[去到控制台,确认storage和bigquery API已启用]]></description>
            <content:encoded><![CDATA[<p>去到控制台,确认storage和bigquery API已启用
打开gcs
设置project id</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set project project_id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在storage上创建bucket</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gsutil mb gs://bucket_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil ls #查看创建是否成功</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">上传文件夹或者文件到storage bucket, 如果storage bucket没有这个文件名,就会创建一个</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gsutil cp -r faker_demo/data gs://z_bucket/sub_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil ls gs://z_bucket/sub_file/* 参看所有文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil rm gs://z_bucket/sub_file/.DS_Store #删除文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>去big query 创建dataset</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq mk fake_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq ls #查看命令</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建biq query 表格 csv, 或者avro,注意--source_format 要大写AVRO,CSV, 如果csv类型的schema可以用--autodetect,</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq load --source_format=AVRO fake_data.account_id_schema "gs://z_bucket/sub_file/avro_output/accountID.avro"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq load --source_format=CSV fake_data.account_id_schema  "gs://z_bucket/sub_file/input/account_id_schema.csv" </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bq load --autodetect --source_format=CSV fake_data.account_id_schema "gs://z_bucket/sub_file/output/accountID.csv"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看字段</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq show fake_data.account_id_schema</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查询</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq query "select * from fake_data.account_id_schema limit 5"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>avro</category>
            <category>bigquery</category>
        </item>
        <item>
            <title><![CDATA[用yaml配置文件传参数给pyspark,然后再dataproc运行]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/18/dataproc+spark+yaml</link>
            <guid>/2020/4/18/dataproc+spark+yaml</guid>
            <pubDate>Sat, 18 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[首先我们要学Yaml语法:]]></description>
            <content:encoded><![CDATA[<p>首先我们要学Yaml语法:
具体yaml语法可以参考<a href="/blog/2020/4/18/yaml1">yaml语法详情</a></p><p>整体思路</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备yaml文件和pyspark">准备yaml文件和pyspark<a class="hash-link" href="#准备yaml文件和pyspark" title="Direct link to heading">​</a></h2><ol><li>导入工具包</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pyspark.sql import SparkSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys,yaml,datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import pathlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import google.cloud.storage as gcs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>我们写了一个Yaml文件作为config文件</li><li>我们在我们的pyspark文件读取yaml文件,这里要注意的是,因为本地和GCS会有不同,本地是可以直接读取的,但是如果yaml文件在GCS,yaml文件就是object,是不可改写的,所以我们不能直接open(yaml文件,"r")</li><li>我们需要在pyspark文件上创建gcs客户端,然后创建设置一个本地文件路径,然后通过客户端读取yaml文件内容并且下载到本地,然后再通过本地使用with open方法读取yaml文件内容</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">client = gcs.Client()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#set target file to write to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target = pathlib.Path("local_file.yaml")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config_file = sys.argv[1] +"config.yaml"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#set file to download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FULL_FILE_PATH = config_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#open filestream with write permissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with target.open(mode="wb") as downloaded_file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #download and write file locally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client.download_blob_to_file(FULL_FILE_PATH, downloaded_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config_file="local_file.yaml"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>读取后,我们就可以操作一下代码</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for job in config["jobs"]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print("Creating source views...")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for source in job["sources"]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if source.get("table") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print("Creating view %s from table %s..." % (source["view"], source["table"]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df = spark.table(source["table"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.show(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print('table now')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print("Creating view %s from object %s..." % (source["view"], source["object"]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df = spark.read.format(source['object'][source['object'].rfind('.')+1:]).option("header","true").load(source['object'])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.show(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if source.get("columns") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # columns listed, select given columns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df = df.select(source["columns"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.show(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if source.get('Fillna') is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(source['Fillna']["fields"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print('hah',type(source['Fillna']))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df = df.fillna({source['Fillna']["fields"]:source['Fillna']["num"]})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.show(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if source.get("filters") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.filter(source["filters"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if source.get("union") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df_union = spark.sql("select * from %s"%(source['union']))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.union(df_union)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.show(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if source.get("join") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cur = df.select(source['Key'])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pre = spark.sql("select * from %s"%(source['right']))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df = cur.join(pre,[source['Key']],source['how'])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            df.show(5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        df.createOrReplaceTempView(source["view"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print("Performing SQL Transformations...")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if job.get("transforms") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for transform in job["transforms"]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spark.sql(transform["sql"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(df.count())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if job.get("targets") is not None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print("Writing out final object to %s..." % (job["targets"]["target_location"]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start = datetime.datetime.now()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final_df = spark.table(job["targets"]["final_object"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final_df.write.mode(job["targets"]["mode"]).format(job["targets"]["format"]).save(job["targets"]["target_location"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finish = datetime.datetime.now()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print("Finished writing out target object...")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="这端代码的逻辑就是循环config里面的jobsjobs里面包括读取文件或者tablefillnauniontransoform等etl作业">这端代码的逻辑就是循环config里面的jobs,jobs里面包括读取文件或者table,fillna,union,transoform等etl作业<a class="hash-link" href="#这端代码的逻辑就是循环config里面的jobsjobs里面包括读取文件或者tablefillnauniontransoform等etl作业" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备启动dataproc代码">准备启动dataproc代码<a class="hash-link" href="#准备启动dataproc代码" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER_NAME=newnew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud beta dataproc clusters create ${CLUSTER_NAME} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=global \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-b \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --worker-machine-type n1-standard-1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-workers 2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-version 1.4-debian \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --initialization-actions gs://dataproc-initialization-actions/python/pip-install.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --metadata 'PIP_PACKAGES=google-cloud-storage PyYAML pathlib avro-python3 dask[dataframe] gcsfs fastavro' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-component-gateway \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --worker-boot-disk-size=40 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --optional-components=ANACONDA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-component-gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUCKET_NAME=zz_michael</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set dataproc/region global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark dyyaml.py --cluster newnew \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--jars=https://repo1.maven.org/maven2/org/apache/spark/spark-avro_2.11/2.4.4/spark-avro_2.11-2.4.4.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- gs://${BUCKET_NAME}/yaml/ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="job完成后需要删除dataproc-clusters">job完成后需要删除dataproc clusters<a class="hash-link" href="#job完成后需要删除dataproc-clusters" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER_NAME=newnew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc clusters delete $CLUSTER_NAME</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[yaml语法学习]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/18/yaml语法学习</link>
            <guid>/2020/4/18/yaml语法学习</guid>
            <pubDate>Sat, 18 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[首先我们要学Yaml语法:]]></description>
            <content:encoded><![CDATA[<p>首先我们要学Yaml语法:
具体yaml语法可以参考<a href="/blog/2020/4/18/[yaml1](https://learn-the-web.algonquindesign.ca/topics/yaml/)">yaml语法详情</a></p><h1>yaml语法的核心我觉得也是字典语言</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="缩减空格">缩减空格:<a class="hash-link" href="#缩减空格" title="Direct link to heading">​</a></h2><p>YAML对此非常严格:仅缩进2个空格</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结构化数据-言外之意就是字典对象">结构化数据-言外之意就是字典对象<a class="hash-link" href="#结构化数据-言外之意就是字典对象" title="Direct link to heading">​</a></h2><p>两个主要结构:</p><ol><li><code>对象 类似javascript的对象 或者html &lt;dl&gt;</code></li><li><code>数组 类似javascript的数组 类似html&lt;ul&gt;</code></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="读取yaml文件">读取yaml文件<a class="hash-link" href="#读取yaml文件" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config_file  = './test.yaml'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with open(config_file, 'r') as stream:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config = yaml.load(stream.read(),Loader=yaml.FullLoader)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="对象">对象<a class="hash-link" href="#对象" title="Direct link to heading">​</a></h3><p>YAML中的对象以单词/术语开头,后跟冒号和空格</p><p>对象包含对象</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dimensions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  width: 3 metres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  height: 8 metres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  length: 12 metres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weight: 4 tonnes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以dimension<!-- -->['width']<!-- -->获取wdith数值</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for key,values in config['dimensions']:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(key,values)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数组">数组<a class="hash-link" href="#数组" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">likes_to_eat:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Other dinosaurs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Meat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - More meat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Not plants</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for key,values in enumerate(config['likes_to_eat']):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(key,values)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据包含对象">数据包含对象<a class="hash-link" href="#数据包含对象" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Person:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: T. rex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      period: Late Cretaceous Period</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: Stegosaurus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      period: Late Jurassic Period</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: Velociraptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      period: Cretaceous Period</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>"-"可以看出列表[],然后如果里面有对象,就是列表嵌套对象的意思</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="以上就是yaml最基本的用法">以上就是yaml最基本的用法<a class="hash-link" href="#以上就是yaml最基本的用法" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="文字区块">文字区块<a class="hash-link" href="#文字区块" title="Direct link to heading">​</a></h3><p>如果您的YAML中有超大文本块，则可以使用竖线（|）或大于符号（&gt;）的方式将文本分开，并允许更多格式。
大于号使您可以在多行上编写文本，因为当您解析YAML时，这些行将折叠为一行。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">desc: &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tyrannosaurus (/tɨˌrænəˈsɔrəs/ or /taɪˌrænəˈsɔrəs/ ("tyrant lizard", from the Ancient Greek tyrannos (τύραννος), "tyrant", and sauros (σαῦρος), "lizard"[1])) is a genus of coelurosaurian theropod dinosaur.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  The species Tyrannosaurus rex (rex meaning "king" in Latin), commonly abbreviated to T. rex, is one of the most well-represented of the large theropods.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="验证">验证<a class="hash-link" href="#验证" title="Direct link to heading">​</a></h2><p>我们可以去yaml语法验证网站验证(<a href="http://www.yamllint.com/" target="_blank" rel="noopener noreferrer">http://www.yamllint.com/</a>)</p><p>我的一个实例:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">jobs: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: "read_file and conbine as one dataframe5"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sources: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fillna: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fields: NUM_OF_MTHS_PD_30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          num: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: "read Curr_RD file"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        object: "gs://zz_michael/yaml/Curr_RD.avro"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: Curr_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fillna: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fields: NUM_OF_MTHS_PD_30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          num: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: "read Prev_RD file"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        object: "gs://zz_michael/yaml/Prev_RD.avro"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: Prev_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: "left join"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Key: ARNG_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        how: left_outer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        join: left_outer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        left: Curr_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        right: Prev_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table: Curr_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: df5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: "filter Df5 df"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sources: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: "filter df5"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filters: "NUM_OF_MTHS_PD_30 &gt;=1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table: df5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: df6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transforms: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sql: "CREATE OR REPLACE TEMPORARY VIEW df7 as select * from df5 where NUM_OF_MTHS_PD_30 is null or NUM_OF_MTHS_PD_30 &lt;1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: fillna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sources: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Fillna: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fields: NUM_OF_MTHS_PD_30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          num: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: fillna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table: df7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: df8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: union</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sources: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: union</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table: df6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        union: df8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: df9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: write to avro file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sources: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JobDescription: "left join"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Key: ARNG_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        how: left_outer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        join: left_outer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        left: Curr_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        right: df9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        table: Curr_RD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view: df10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    targets: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      final_object: df10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      format: csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mode: overwrite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      target_location: "gs://zz_michael/yaml/output"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transforms: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sql: "CREATE OR REPLACE TEMPORARY VIEW df10 as select * from df10"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: haha</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="解析上面yaml文件">解析上面YAML文件<a class="hash-link" href="#解析上面yaml文件" title="Direct link to heading">​</a></h2><ol><li>我们可以看到Jobs是对象 jobs(object)</li><li>从'-'可以看出,Jobs对象嵌套列表 类似 [i for i in config<!-- -->["jobs"]<!-- -->],所以我们这里可以遍历jobs</li><li>列表里面嵌套对象: <!-- -->[{"name":"","sources":""},{"name":"","sources":"","transforms":""},{"name":"","sources":""},{"name":"","sources":""},{"name":"","sources":"","transforms":"",'targets':""}]</li><li>我们看到source也是有嵌套的,也是嵌套对象<!-- -->[{},{}]</li><li>Fillna对象里面也是有嵌套对象</li></ol>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[dataproc--dataproc+GCS+Bigquery+Pyspark]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/17/dataproc+GCS+Bigquery+pyspark</link>
            <guid>/2020/4/17/dataproc+GCS+Bigquery+pyspark</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[流程很简单]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="流程很简单">流程很简单<a class="hash-link" href="#流程很简单" title="Direct link to heading">​</a></h2><p>首先我们从GCS那里读取avro数据,然后我们读取avro数据变成dask.Dataframe,然后对dask.Dataframe操作,再转成pandas Dataframe,然后变成Spark Dataframe,最后通过Spark 与 bigquery 的connector对接起来,写入big query</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装刚才的思路写pythonpy">安装刚才的思路写python.py<a class="hash-link" href="#安装刚才的思路写pythonpy" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import dask.bag as db # 导入工具包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def run():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b = db.read_avro('gs://zz_mm_bucket/account_id_schema_new.avro') #从GCS读取avro文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df = b.to_dataframe() # 转成Dataframe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df_values = df.compute().values.tolist() #转成pandas的dataframe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df_columns = list(df.columns)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import pandas as pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from pyspark.sql import SparkSession #spark初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spark = SparkSession.builder.appName("DataFrame").getOrCreate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bucket = "haha_mm_bucket" #设置bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spark.conf.set('temporaryGcsBucket', bucket) #给spark初始化设置bucket零时存放数据的gcs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spark_df = spark.createDataFrame(df_values, df_columns) 把dataframe转成spark的dataframe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spark_df.show(10) #对spark的dataframe进行操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spark_df.write.format('bigquery').option('table','query-11:newdata.newdata').save() # 写入bigquery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == '__main__':</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="去到终端输入命令提交spark-job">去到终端输入命令,提交spark job<a class="hash-link" href="#去到终端输入命令提交spark-job" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark wordcount.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster cluster-name \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region cluster-region (example: "us-central1") \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>主要格式: gcloud dataproc jobs submit pyspark python.py(python文件) \
--cluster cluster-name \
--region cluster-region(比如:us-central1,一定要对应dataproc集群的region)
--jars 与biguqery连接的包
注意这里的jars:
If you are using Dataproc image 1.5, add the following parameter:
--jars=gs://spark-lib/bigquery/spark-bigquery-latest_2.12.jar
If you are using Dataproc image 1.4 or below, add the following parameter:
--jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set dataproc/region us-central1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUCKET_NAME=haha_mm_bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input=new.avro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark wordcount3.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cluster cluster-662b \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- gs://${BUCKET_NAME}/${input} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--packages com.databricks:spark-avro_2.11:4.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[dataproc参数化跑spark和读写avro文件]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/17/dataproc参数化跑spark和读写avro</link>
            <guid>/2020/4/17/dataproc参数化跑spark和读写avro</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[1. spark 初始化,因为要读取成dataframe或者sql形式,导入SparkSession]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-spark-初始化因为要读取成dataframe或者sql形式导入sparksession">1. spark 初始化,因为要读取成dataframe或者sql形式,导入SparkSession<a class="hash-link" href="#1-spark-初始化因为要读取成dataframe或者sql形式导入sparksession" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from pyspark.sql import SparkSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建spark对象">2. 创建spark对象<a class="hash-link" href="#2-创建spark对象" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark = SparkSession \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .builder \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .master('yarn') \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .appName('gcs-sparkdataframe-sql-avro') \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .getOrCreate()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数判断和参数设置">参数判断和参数设置<a class="hash-link" href="#参数判断和参数设置" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if len(sys.argv) != 4:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  raise Exception("Exactly 3 arguments are required: &lt;inputUri&gt; &lt;table1&gt;&lt;table2&gt;")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inputUri=sys.argv[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table1=sys.argv[2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table2=sys.argv[3]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-读取avro文件">4 读取avro文件<a class="hash-link" href="#4-读取avro文件" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df = spark.read.format('avro').load(inputUri)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-注册视图实行查询语句">5 注册视图,实行查询语句<a class="hash-link" href="#5-注册视图实行查询语句" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df1 = spark.sql("select ACNO,%s from bigtable" % (",".join(df.columns[1:round(len(df.columns) / 2)])))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2 = spark.sql("select ACNO,%s from bigtable" % (",".join(df.columns[round(len(df.columns) / 2):])))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df1.show(10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2.show(10)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-处理好的dataframe对象写成avro文件-注意用sql处理过后的还是dataframe对象">6 处理好的dataframe对象写成avro文件 (注意,用sql处理过后的还是dataframe对象)<a class="hash-link" href="#6-处理好的dataframe对象写成avro文件-注意用sql处理过后的还是dataframe对象" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df1.write.format('avro').save(table1,'avro')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2.write.format('avro').save(table2,'avro')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-去到终端输入命令创建dataproc集群然后提交spark-job">7 去到终端输入命令,创建dataproc集群,然后提交spark job<a class="hash-link" href="#7-去到终端输入命令创建dataproc集群然后提交spark-job" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER_NAME=newnew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud beta dataproc clusters create ${CLUSTER_NAME} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=global \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-b \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --worker-machine-type n1-standard-1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-workers 2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-version 1.4-debian \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --initialization-actions gs://dataproc-initialization-actions/python/pip-install.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --metadata 'PIP_PACKAGES=google-cloud-storage avro-python3 dask[dataframe] gcsfs fastavro' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-component-gateway \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --worker-boot-disk-size=40 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --optional-components=ANACONDA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-component-gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUCKET_NAME=zz_mm_bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set dataproc/region global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark avrosqlargs.py --cluster newnew \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--jars=https://repo1.maven.org/maven2/org/apache/spark/spark-avro_2.11/2.4.4/spark-avro_2.11-2.4.4.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- gs://${BUCKET_NAME}/input/gs://zz_mm_bucket/input/ gs://${BUCKET_NAME}/output/table1 gs://${BUCKET_NAME}/output/table2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="这里注意的是gcloud-dataproc-jobs-sumbit的参数格式是-pysparkpy文件-files">这里注意的是gcloud dataproc jobs sumbit的参数格式是 pyspark.py文件, files<a class="hash-link" href="#这里注意的是gcloud-dataproc-jobs-sumbit的参数格式是-pysparkpy文件-files" title="Direct link to heading">​</a></h2><p>所以例子中我们的参数总共有4个
1 avrosqlargs.py</p><p>2 gs://${BUCKET_NAME}/input/gs://zz_mm_bucket/input/</p><p>3 gs://${BUCKET_NAME}/output/table1 </p><p>4 gs://${BUCKET_NAME}/output/table2</p><p>jars和cluster都不算为参数</p><p>还有就是files的是文件夹形式而不能是文件形式,所以读入文件夹后,可以根据需要读取你需要的文件,比如sys.argv+'文件名'</p><p>所以整体可以改成:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"""BigQuery I/O PySpark example."""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pyspark.sql import SparkSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark = SparkSession \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .builder \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .master('yarn') \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .appName('gcs-sparkdataframe-sql-avro') \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .getOrCreate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># get spark datafrom from avro file in GCS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if len(sys.argv) != 4:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  raise Exception("Exactly 3 arguments are required: &lt;inputUri&gt; &lt;table1&gt;&lt;table2&gt;")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inputUri=sys.argv[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table1=sys.argv[2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table2=sys.argv[3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file = inputUri+'account_id_schema_new.avro'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df = spark.read.format('avro').load(file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#create temp table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df.createOrReplaceTempView('bigtable')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># split temp table into 2 spark dataframes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df1 = spark.sql("select ACNO,%s from bigtable" % (",".join(df.columns[1:round(len(df.columns) / 2)])))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2 = spark.sql("select ACNO,%s from bigtable" % (",".join(df.columns[round(len(df.columns) / 2):])))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df1.show(10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2.show(10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Saving the dataframes into avro files and dump avro files into GCS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df1.write.mode("overwrite").format('avro').save(table1,'avro')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2.write.mode("overwrite").format('avro').save(table2,'avro')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于生成文件因为spark是基于hadoop的所以文件也会分布式存储所以我们可以看到">关于生成文件,因为spark是基于hadoop的,所以文件也会分布式存储,所以我们可以看到<a class="hash-link" href="#关于生成文件因为spark是基于hadoop的所以文件也会分布式存储所以我们可以看到" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df = spark.read.format('avro').load(sys.argv[3])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一般是分区是会根据你的电脑的cpu核数自动分配我的电脑是core-i5也就是四核的所以默认是4">一般是分区是会根据你的电脑的cpu核数自动分配,我的电脑是core i5,也就是四核的,所以默认是4<a class="hash-link" href="#一般是分区是会根据你的电脑的cpu核数自动分配我的电脑是core-i5也就是四核的所以默认是4" title="Direct link to heading">​</a></h2><p>我们可以重分区:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df.repartition(10) # 就是分10区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df.rdd.getNumPartitions() #查看分区数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df.coalesce(1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[dataproc自动伸缩和运行spark job]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/17/dataproc自动伸缩和运行sparkjob</link>
            <guid>/2020/4/17/dataproc自动伸缩和运行sparkjob</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[我们运用数据分析的时候,通常都是脏数据,我们需要清洗才能被使用.]]></description>
            <content:encoded><![CDATA[<p>我们运用数据分析的时候,通常都是脏数据,我们需要清洗才能被使用.
我们可以加载Big query的数据放到Dataproc中,通过spark集群来etl有用的数据,然后把一些processed data比如zipped csv file放到google gloud storage上
<img loading="lazy" alt="png" src="/assets/images/1-55e33296e4f2ef96c6e6bbe046cf4542.png" width="784" height="562" class="img_ev3q"></p><h1>准备阶段</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="去到控制台确认cloud-dataproc-api已启用">去到控制台,确认cloud dataproc API已启用<a class="hash-link" href="#去到控制台确认cloud-dataproc-api已启用" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-35398815aa4283814fbd749f04883649.png" width="1172" height="266" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/2-06a0c51c3671688f8442baea872618a7.png" width="300" height="295" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/3-0bcc908dc4ca9b432095c615166db116.png" width="723" height="289" class="img_ev3q"></p><h1>我们会使用命令去dataproc创建集群</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="首先我们创建一个yaml文件对集群做自动伸缩的定义">首先我们创建一个yaml文件,对集群做自动伸缩的定义<a class="hash-link" href="#首先我们创建一个yaml文件对集群做自动伸缩的定义" title="Direct link to heading">​</a></h2><p><a href="https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/autoscaling#autoscaling_and_spark_structured_streaming" target="_blank" rel="noopener noreferrer">关于spark自动伸缩原理</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">workerConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  minInstances: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maxInstances: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weight: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondaryWorkerConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  minInstances: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maxInstances: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weight: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basicAlgorithm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cooldownPeriod: 4m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  yarnConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scaleUpFactor: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scaleDownFactor: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scaleUpMinWorkerFraction: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    scaleDownMinWorkerFraction: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gracefulDecommissionTimeout: 1h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后我们可以先创建自动伸缩政策</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud beta dataproc autoscaling-policies import policy-name --source policy-file.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://cloud.google.com/sdk/gcloud/reference/beta/dataproc/autoscaling-policies" target="_blank" rel="noopener noreferrer">具体的command命令</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建集群">创建集群<a class="hash-link" href="#创建集群" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER_NAME=newnew</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud beta dataproc clusters create ${CLUSTER_NAME} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=global \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-b \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --worker-machine-type n1-standard-1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-workers 2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-version 1.4-debian \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --initialization-actions gs://dataproc-initialization-actions/python/pip-install.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --metadata 'PIP_PACKAGES=google-cloud-storage avro-python3 dask[dataframe] gcsfs fastavro' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-component-gateway \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --worker-boot-disk-size=40 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --optional-components=JUPYTER,ANACONDA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-component-gateway \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --autoscaling-policy=global</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建成功后dataprocmenu上查看同时我们需要创建一个gcs这样我们处理好的数据就可以存在在gcs上了">创建成功后,Dataprocmenu上查看,同时我们需要创建一个GCS,这样我们处理好的数据就可以存在在GCS上了<a class="hash-link" href="#创建成功后dataprocmenu上查看同时我们需要创建一个gcs这样我们处理好的数据就可以存在在gcs上了" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BUCKET_NAME=&lt;bucket_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil mb gs://${BUCKET_NAME}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="我们可以去bigquery的public-data找数据查看表的数据结构">我们可以去bigquery的public data找数据,查看表的数据结构<a class="hash-link" href="#我们可以去bigquery的public-data找数据查看表的数据结构" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/2-2cf82512f80503b47a8197b92d152736.png" width="1441" height="785" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行-pyspark-job">运行 pyspark job<a class="hash-link" href="#运行-pyspark-job" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/GoogleCloudPlatform/cloud-dataproc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/cloud-dataproc/codelabs/spark-bigquery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark --cluster ${CLUSTER_NAME} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --jars gs://spark-lib/bigquery/spark-bigquery-latest_2.12.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --driver-log-levels root=FATAL \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    counts_by_subreddit.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们需要提供集群名字,提供jars的参数,这个jar包能够允许我们通过saprk-bigquery-connector连接到我们的job,
driver-log-levels root=FATAL能够抑制日志输出除了错误信息,因为spark logs.
<img loading="lazy" alt="png" src="/assets/images/3-143e26ff06ec76980cbefec15a9201c6.png" width="1401" height="496" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/4-3b5088f2186d8b988196d98b93775164.png" width="1440" height="625" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/5-e4344d4588c2bef70207f81a5eef4081.png" width="1439" height="547" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="我们查看dataproc和spark">我们查看Dataproc和spark<a class="hash-link" href="#我们查看dataproc和spark" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/6-7d9f1b52d0a9b18fac51b23a315b2039.png" width="1101" height="260" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/7-bca36e0599e43b8efe108ee87ffd8420.png" width="1438" height="768" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/8-c953ef69843d79881611d063196842d1.png" width="1440" height="521" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/9-a3c783bd9fc9965f35ee8a9d6f4ef641.png" width="1439" height="768" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="我们跑一个任务加载数据到memory提取必须要的信息然后输出到gcs里面我们这里是提取titlebody和timestamp-created然后我们把这些data转成csv文件存入gcs里面">我们跑一个任务,加载数据到memory,提取必须要的信息,然后输出到GCS里面.我们这里是提取title,body和timestamp created,然后我们把这些data转成csv文件,存入gcs里面<a class="hash-link" href="#我们跑一个任务加载数据到memory提取必须要的信息然后输出到gcs里面我们这里是提取titlebody和timestamp-created然后我们把这些data转成csv文件存入gcs里面" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/cloud-dataproc/codelabs/spark-bigquery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bash backfill.sh ${CLUSTER_NAME} ${BUCKET_NAME}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gsutil ls gs://${BUCKET_NAME}/reddit_posts/*/*/food.csv.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(类似的实验可以参考)(<a href="https://codelabs.developers.google.com/codelabs/pyspark-bigquery/index.html?index=..%2F..index#1" target="_blank" rel="noopener noreferrer">https://codelabs.developers.google.com/codelabs/pyspark-bigquery/index.html?index=..%2F..index#1</a>)</p>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[dataproc--跑pyspark(从big query获取数据)]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/17/dataproc跑pyspark</link>
            <guid>/2020/4/17/dataproc跑pyspark</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[流程很简单]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="流程很简单">流程很简单<a class="hash-link" href="#流程很简单" title="Direct link to heading">​</a></h2><p>我们要用spark读取从bigquery读取table,然后我们对这个table做一个简单的处理,再分成两dataframe对象,然后把两个对象写入bigquery</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-spark-初始化因为要读取成dataframe或者sql形式导入sparksession">1. spark 初始化,因为要读取成dataframe或者sql形式,导入SparkSession<a class="hash-link" href="#1-spark-初始化因为要读取成dataframe或者sql形式导入sparksession" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pyspark.sql import SparkSession</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建spark对象">2. 创建spark对象<a class="hash-link" href="#2-创建spark对象" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark = SparkSession.builder.master('yarn').appName('your app name').getOrCreate()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-我们通过connector连接一个google-storage-bucket-给bigquery输出数据临时用">3 我们通过connector连接一个google storage bucket 给Bigquery输出数据临时用<a class="hash-link" href="#3-我们通过connector连接一个google-storage-bucket-给bigquery输出数据临时用" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bucket = "haha_mm_bucket"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark.conf.set('temporaryGcsBucket',bucket)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-配置好tmp-bucket我们可以开始读取数据并且把数据框注册为视图">4 配置好tmp bucket,我们可以开始读取数据,并且把数据框注册为视图<a class="hash-link" href="#4-配置好tmp-bucket我们可以开始读取数据并且把数据框注册为视图" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df = spark.read.format('bigquery').option('table','datasetid:tableid').load()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df.createTempView("temp table name(比如words)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">也可以是df.createOrReplaceTempView('words') 这样就可以覆盖原来同样名字的临时视图</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-开始使用sql语句">5 开始使用sql语句<a class="hash-link" href="#5-开始使用sql语句" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lefttable = spark.sql("SELECT ACNO, FIELD_1, FIELD_2 FROM words")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">righttable = spark.sql("SELECT ACNO, FIELD_3, FIELD_4 FROM words")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lefttable.show()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lefttable.printSchema()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">righttable.show()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">righttable.printSchema()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-处理好的dataframe对象写入bigquery-注意用sql处理过后的还是dataframe对象">6 处理好的dataframe对象写入bigquery (注意,用sql处理过后的还是dataframe对象)<a class="hash-link" href="#6-处理好的dataframe对象写入bigquery-注意用sql处理过后的还是dataframe对象" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lefttable.write.format('bigquery').option('table','query-11:newdata.lefttable').save()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">righttable.write.format('bigquery').option('table','query-11:newdata.righttable').save()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-去到终端输入命令提交spark-job">7 去到终端输入命令,提交spark job<a class="hash-link" href="#7-去到终端输入命令提交spark-job" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark wordcount.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster cluster-name \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region cluster-region (example: "us-central1") \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>主要格式: gcloud dataproc jobs submit pyspark python.py(python文件) \
--cluster cluster-name \
--region cluster-region(比如:us-central1,一定要对应dataproc集群的region)
--jars 与biguqery连接的包
注意这里的jars:
If you are using Dataproc image 1.5, add the following parameter:
--jars=gs://spark-lib/bigquery/spark-bigquery-latest_2.12.jar
If you are using Dataproc image 1.4 or below, add the following parameter:
--jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set dataproc/region us-central1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUCKET_NAME=haha_mm_bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input=new.avro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark wordcount3.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--cluster cluster-662b \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- gs://${BUCKET_NAME}/${input} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--jars=gs://spark-lib/bigquery/spark-bigquery-latest.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--packages com.databricks:spark-avro_2.11:4.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[5分钟在谷歌云上使用Dataproc运行Apache Spark集群]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/17/dataproc运行Apache Spark集群</link>
            <guid>/2020/4/17/dataproc运行Apache Spark集群</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[png]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" alt="png" src="/assets/images/1-35398815aa4283814fbd749f04883649.png" width="1172" height="266" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/2-06a0c51c3671688f8442baea872618a7.png" width="300" height="295" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/3-0bcc908dc4ca9b432095c615166db116.png" width="723" height="289" class="img_ev3q"></p><h1>去dataproc-&gt;cluster-&gt;create cluster</h1><p><img loading="lazy" alt="png" src="/assets/images/10-1264ea654ee838e8c3d8ca51cf5d20bd.png" width="1182" height="419" class="img_ev3q"></p><h1>create cluster后在以下字段输入对应值</h1><p><img loading="lazy" alt="png" src="/assets/images/4-1df1ef80fd55f6e6bcddcff16e8c8cba.png" width="641" height="150" class="img_ev3q"></p><p>具体如下:</p><p><img loading="lazy" alt="png" src="/assets/images/5-346a13e2b55843741f899646985d088c.png" width="601" height="705" class="img_ev3q"></p><h1>以上控制台的步骤,可以直接通过gcloud terminal代码实现</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud set config project project ID # 设置指定项目id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set dataproc/region global #在dataproc设置region,这一步很重要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc clusters create example-cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/1-35398815aa4283814fbd749f04883649.png" width="1172" height="266" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="这样gcp就会帮你搭建cluster了">这样gcp就会帮你搭建cluster了<a class="hash-link" href="#这样gcp就会帮你搭建cluster了" title="Direct link to heading">​</a></h2><h1>创建集群成功后,运行job</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="去job选择-sumbit-job">去job,选择 sumbit job<a class="hash-link" href="#去job选择-sumbit-job" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/6-5e26899306aef7d10d29563c48bc2c89.png" width="554" height="294" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="在对应字段输入对应值">在对应字段输入对应值<a class="hash-link" href="#在对应字段输入对应值" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/7-856fd59229ed0d83d47f38974377d0c5.png" width="644" height="230" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="具体如下输入完成后点击sumbit">具体如下,输入完成后点击sumbit<a class="hash-link" href="#具体如下输入完成后点击sumbit" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/8-eafae9c0e417f879f685e7054db3d73f.png" width="559" height="609" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="我们可以点击job-id-查看结果和日志">我们可以点击job id 查看结果和日志<a class="hash-link" href="#我们可以点击job-id-查看结果和日志" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/9-91c235a9c10ceebf6d0e7723556fa12e.png" width="975" height="378" class="img_ev3q"></p><h1>以上步骤,我们同样可以用代码在GCPterminal上操作</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit spark --cluster example-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --class org.apache.spark.examples.SparkPi \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --jars file:///usr/lib/spark/examples/jars/spark-examples.jar -- 1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们把job打包成jar,然后用submit spark 来运行
命令 gcloud dataproc jobs submit spark --cluster 集群名称 \ --class 类名 --jars jar包路径 --task数量</p><p><img loading="lazy" alt="png" src="/assets/images/2-06a0c51c3671688f8442baea872618a7.png" width="300" height="295" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/3-0bcc908dc4ca9b432095c615166db116.png" width="723" height="289" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="我们可以可以更新worker数量">我们可以可以更新worker数量<a class="hash-link" href="#我们可以可以更新worker数量" title="Direct link to heading">​</a></h2><p>gcloud dataproc clusters update 集群名字 -num-workers=数量</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc clusters update example-cluster --num-workers= 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/4-1df1ef80fd55f6e6bcddcff16e8c8cba.png" width="641" height="150" class="img_ev3q"></p><h1>我们可以参考集群设置</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc clusters describe example-cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/5-346a13e2b55843741f899646985d088c.png" width="601" height="705" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于spark-jar包和class问题">关于spark jar包和class问题<a class="hash-link" href="#关于spark-jar包和class问题" title="Direct link to heading">​</a></h2><p><a href="https://www.jianshu.com/p/2c7bcee7001a" target="_blank" rel="noopener noreferrer">参考链接1</a></p><p><a href="https://blog.csdn.net/u014234504/article/details/82812343" target="_blank" rel="noopener noreferrer">参看链接2</a></p><p><a href="https://wenku.baidu.com/view/a0dd882fa8956bec0975e397.html" target="_blank" rel="noopener noreferrer">class的写法</a></p><h1>用dataproc创建集群和运行spark job 完成!!</h1><p>关于<a href="https://zhuanlan.zhihu.com/p/50752866" target="_blank" rel="noopener noreferrer">spark job,stage,task</a>的理解和参考</p><h1>用gcloud来启cluster命令</h1><p><a href="https://codelabs.developers.google.com/codelabs/spark-nlp/index.html?index=..%2F..index&amp;_ga=2.18367290.242813027.1588130089-996489118.1587002962&amp;_gac=1.182983892.1588923163.Cj0KCQjwhtT1BRCiARIsAGlY51KEFc2-GGnxsXVhFZsKWExLJckKepaugZrKbbr2cvW0KLPRtubd7vAaAkA2EALw_wcB#0" target="_blank" rel="noopener noreferrer">一个NLP实验</a></p><h1>在dataproc创建集群</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER_NAME=my-cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZONE=us-east1-b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUCKET_NAME=bm_reddit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REGION=us-east1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud beta dataproc clusters create ${CLUSTER_NAME} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --zone=${ZONE} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --metadata 'PIP_PACKAGES=google-cloud-storage' \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --worker-machine-type n1-standard-1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --num-workers 2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --image-version 1.4-debian9 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --initialization-actions gs://dataproc-initialization-actions/spark-nlp/spark-nlp.sh,gs://dataproc-initialization-actions/python/pip-install.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --region=${REGION} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --optional-components=JUPYTER,ANACONDA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --enable-component-gateway \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --worker-boot-disk-size=30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参数说明">参数说明:<a class="hash-link" href="#参数说明" title="Direct link to heading">​</a></h2><p>metadata指源数据,比如想要安装CONDA_PACKAGE,我们</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--metadata 'CONDA_PACKAGES=scipy=1.0.0 tensorflow' \ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果想安装pip_package,我们可以</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--metadata 'PIP_PACKAGES=pandas==0.23.0 scipy==1.1.0' \ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>详细可以<a href="https://cloud.google.com/dataproc/docs/tutorials/python-configuration" target="_blank" rel="noopener noreferrer">参考链接</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-pypi-packages">Install PyPI packages<a class="hash-link" href="#install-pypi-packages" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--initialization-actions gs://goog-dataproc-initialization-actions-${REGION}/python/pip-install.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-conda-packages">Install Conda packages<a class="hash-link" href="#install-conda-packages" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--initialization-actions gs://goog-dataproc-initialization-actions-${REGION}/python/conda-install.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>--initialization-actions是用在安装metadata的包</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--initialization-actions \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gs://goog-dataproc-initialization-actions-${REGION}/conda/bootstrap-conda.sh,gs://goog-dataproc-initialization-actions-${REGION}/conda/install-conda-env.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下载代码</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/GoogleCloudPlatform/cloud-dataproc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd cloud-dataproc/codelabs/spark-nlp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>运行</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataproc jobs submit pyspark --cluster ${CLUSTER_NAME}\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --properties=spark.jars.packages=JohnSnowLabs:spark-nlp:2.0.8 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --driver-log-levels root=FATAL \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic_model.py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- ${BUCKET_NAME}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CLUSTER_NAME=newnew
gcloud beta dataproc clusters create ${CLUSTER_NAME} \
--region=global \
--zone=us-east1-b \
--worker-machine-type n1-standard-2 \
--num-workers 2 \
--image-version 1.5-debian \
--initialization-actions gs://dataproc-initialization-actions/python/pip-install.sh \
--metadata 'PIP_PACKAGES=google-cloud-storage avro-python3 dask<!-- -->[dataframe]<!-- --> gcsfs fastavro' \
--enable-component-gateway \
--worker-boot-disk-size=40 \
--optional-components=JUPYTER,ANACONDA \
--enable-component-gateway \
--autoscaling-policy=global</p><p>workerConfig:
minInstances: 2
maxInstances: 100
weight: 1
secondaryWorkerConfig:
minInstances: 0
maxInstances: 100
weight: 1
basicAlgorithm:
cooldownPeriod: 4m
yarnConfig:
scaleUpFactor: 0.05
scaleDownFactor: 1.0
scaleUpMinWorkerFraction: 0.0
scaleDownMinWorkerFraction: 0.0
gracefulDecommissionTimeout: 1h</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见错误">常见错误<a class="hash-link" href="#常见错误" title="Direct link to heading">​</a></h2><p>案例1:cpus的限额问题
Multiple validation errors: - Insufficient 'CPUS' quota. Requested 12.0, available 7.0. - Insufficient 'CPUS_ALL_REGIONS' quota. Requested 12.0, available 11.0. - This request exceeds CPU quota. Some things to try: request fewer workers (a minimum of 2 is required), use smaller master and/or worker machine types (such as n1-standard-2).</p><p>这里的insufficent 'CPUS' 只的是master和worker所有的node的cpus数量总和
Insufficient 'CPUS_ALL_REGIONS' quota是在全球的cpus限额,如果region选择global, 那么这里限额就是11(available 11), 如果region选择时某个地区,比如us-central1,那么我这里的quota就是7.为什么是7呢,因为谷歌的试用账号最多只能有8CPUs,我这个project里面已经在一个地区区域创建了一个vm,这个vm的machining type是(n1-standard-1 (1 vCPU, 3.75 GB memory)),所以占用了一个cpu,所以地方region的cpus可用额度就是8-1=7
同理,全球的话是12cpu,我已经用了1个了,所以全球剩下的就是12-1=11.</p><p>案例2: yarn core数 和 yarn memory
yarn core = worker的node个数 <em> vcpu
yarn memory =  worker的node个数 </em> memoery * 0.8</p><p><img loading="lazy" alt="png" src="/assets/images/11-98803efe09fe9eaeddb3a5d53cb85fbe.png" width="489" height="368" class="img_ev3q"></p><p>google对yarn memoery的定义:
The number of worker nodes times the amount of memory on each node times the fraction given to YARN (0.8)</p><p>google对yarn coreds的定义:
the number of worker nodes times the number of vCPUs per node</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建集群后使用jupyter-去到cluster然后去到web-interfaces选择jupyter">创建集群后,使用jupyter, 去到cluster,然后去到web interfaces,选择jupyter<a class="hash-link" href="#创建集群后使用jupyter-去到cluster然后去到web-interfaces选择jupyter" title="Direct link to heading">​</a></h2><p>如果运行spark的时候,出现 Py4JJavaError错误
可以安装</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">conda install -c cyclus java-jdk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果想安装python3</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">!conda create -n py36 python=3.6 anaconda</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dataproc-image-version-13-或者之前的话默认是python27">Dataproc image version 1.3 或者之前的话默认是python2.7<a class="hash-link" href="#dataproc-image-version-13-或者之前的话默认是python27" title="Direct link to heading">​</a></h2><p>所以我们最好安装Dataproc image version 1.4+,默认就是python3,具体详细如下</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Miniconda3 is installed on Dataproc 1.4+ clusters. The default Python interpreter is Python 3.6 for Dataproc 1.4 and Python 3.7 for Dataproc 1.5, located on the VM instance at /opt/conda/miniconda3/bin/python3.6 and /opt/conda/miniconda3/bin/python3.7, respectively. Python 2.7 is also available at /usr/bin/python2.7.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="具体配置cluster配置的请查看">具体配置cluster配置的请查看<a class="hash-link" href="#具体配置cluster配置的请查看" title="Direct link to heading">​</a></h2><p><a href="https://cloud.google.com/dataproc/docs/tutorials/python-configuration" target="_blank" rel="noopener noreferrer">参考链接</a></p>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[google script + excel+ google drive]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/16/bq_脚本制作presentation</link>
            <guid>/2020/4/16/bq_脚本制作presentation</guid>
            <pubDate>Thu, 16 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[我们的目标是创建一个脚本可以读取数据,导出成表格形式而且制作出图标,最后做成一个ppt幻灯演示,看起来是不是很牛,这些动作只需要写个脚本就能完成啦]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="我们的目标是创建一个脚本可以读取数据导出成表格形式而且制作出图标最后做成一个ppt幻灯演示看起来是不是很牛这些动作只需要写个脚本就能完成啦">我们的目标是创建一个脚本可以读取数据,导出成表格形式而且制作出图标,最后做成一个ppt幻灯演示,看起来是不是很牛,这些动作只需要写个脚本就能完成啦<a class="hash-link" href="#我们的目标是创建一个脚本可以读取数据导出成表格形式而且制作出图标最后做成一个ppt幻灯演示看起来是不是很牛这些动作只需要写个脚本就能完成啦" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="请看演示">请看演示<a class="hash-link" href="#请看演示" title="Direct link to heading">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="我们进入scriptgooglecom点击getting-started然后再点击apps-script">我们进入script.google.com,点击getting started,然后再点击Apps script<a class="hash-link" href="#我们进入scriptgooglecom点击getting-started然后再点击apps-script" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="png" src="/assets/images/1-3de8bac85ea3179e0d55f739c0c8ff84.png" width="943" height="582" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="我们进入scripts中我们可以改名成slides-demo">我们进入scripts中,我们可以改名成slides demo<a class="hash-link" href="#我们进入scripts中我们可以改名成slides-demo" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="png" src="/assets/images/2-839fef555be928e3a965b091389d165d.png" width="561" height="257" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="然后我们去到控制台查看big-query-api-是否已经启动">然后我们去到控制台查看big query api 是否已经启动<a class="hash-link" href="#然后我们去到控制台查看big-query-api-是否已经启动" title="Direct link to heading">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="确认后我们点击resources的advanced-google-services">确认后,我们点击Resources的advanced google services<a class="hash-link" href="#确认后我们点击resources的advanced-google-services" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="png" src="/assets/images/3-59a5eac6bc32dd343176df86f72f9ab7.png" width="505" height="228" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="我们开启bigquery-api服务">我们开启BigQuery API服务<a class="hash-link" href="#我们开启bigquery-api服务" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="png" src="/assets/images/4-4e6315500ba3e9bbf9056fda05f7e814.png" width="688" height="410" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="修改代码文件名字改成bs-sheets-slidesgs">修改代码文件名字,改成bs-sheets-slides.gs<a class="hash-link" href="#修改代码文件名字改成bs-sheets-slidesgs" title="Direct link to heading">​</a></h4><p>这里用得是javascript来写
<img loading="lazy" alt="png" src="/assets/images/5-8a493ce52f05a8ec5d96866db4653d93.png" width="966" height="524" class="img_ev3q">
具体代码如下</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Copyright 2018 Google LLC</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Licensed under the Apache License, Version 2.0 (the "License");</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * you may not use this file except in compliance with the License.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * You may obtain a copy of the License at apache.org/licenses/LICENSE-2.0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Unless required by applicable law or agreed to in writing, software</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * distributed under the License is distributed on an "AS IS" BASIS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * See the License for the specific language governing permissions and</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * limitations under the License.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Filename for data results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">QUERY_NAME</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Most common words in all of Shakespeare's works"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Replace this value with your Google Cloud API project ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'&lt;YOUR_PROJECT_ID&gt;'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token known-class-name class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Project ID is required in setup'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Runs a BigQuery query; puts results into Sheet. You must enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * the BigQuery advanced service before you can run this code.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://developers.google.com/apps-script/advanced/bigquery#run_query</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://github.com/gsuitedevs/apps-script-samples/blob/master/advanced/bigquery.gs</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Spreadsheet} Returns a spreadsheet with BigQuery results</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://developers.google.com/apps-script/reference/spreadsheet/spreadsheet</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Replace sample with your own BigQuery query.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'SELECT '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'LOWER(word) AS word, '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'SUM(word_count) AS count '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'FROM [bigquery-public-data:samples.shakespeare] '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'GROUP BY word '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'ORDER BY count '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'DESC LIMIT 10'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> queryResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">BigQuery</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Jobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> jobId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jobReference</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jobId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Wait for BQ job completion (with exponential backoff).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> sleepTimeMs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jobComplete</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Utilities</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sleepTimeMs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleepTimeMs </span><span class="token operator" style="color:#393A34">*=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">BigQuery</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Jobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getQueryResults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get all results from BigQuery.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rows</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pageToken</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">BigQuery</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Jobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getQueryResults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">pageToken</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pageToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Return null if no data returned.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'No rows returned.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Create the new results spreadsheet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> spreadsheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">SpreadsheetApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">QUERY_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> sheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getActiveSheet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Add headers to Sheet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fields</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">field</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> field</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toUpperCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Append the results.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cols</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> cols</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cols</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Start storing data in row 2, col 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_ROW</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// skip header row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_COL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">START_ROW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_COL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Results spreadsheet created: %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该查询通过查看莎士比亚的作品（属于 BigQuery的公共数据集），得出他所有作品中出现次数最多的前10个单词，并按流行程度从高到低排序。试想一下，手动执行此操作会有多大的乐趣，您应该对BigQuery的有用性有所了解。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="点击runquery运行期间可能需要需要授权认证">点击runQuery运行,期间可能需要需要授权认证<a class="hash-link" href="#点击runquery运行期间可能需要需要授权认证" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/6-7e7ad9b357805c24a638d9f8a7ccc18c.png" width="662" height="231" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/7-73f496b41ce257668a6afb388af88c93.png" width="469" height="169" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="成功运行后我们可以去drivegooglecom中找到excel表格的url链接点击most-common-words那块条框">成功运行后,我们可以去drive.google.com中找到excel表格的url链接,点击Most common words那块条框<a class="hash-link" href="#成功运行后我们可以去drivegooglecom中找到excel表格的url链接点击most-common-words那块条框" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/8-d2e6b1f1f858a2949b6e830a7d23f765.png" width="1085" height="558" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="点击进入后我们可以看到bigquery的公共集查询的数据现在用表格形式出现了">点击进入后,我们可以看到bigquery的公共集查询的数据现在用表格形式出现了<a class="hash-link" href="#点击进入后我们可以看到bigquery的公共集查询的数据现在用表格形式出现了" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/9-4fdf4155fda4356f26098b7b54245697.png" width="837" height="431" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="我们可以去big-query-用sql语句操作一遍得到的数据也很excel表格一样">我们可以去big query 用sql语句操作一遍,得到的数据也很excel表格一样<a class="hash-link" href="#我们可以去big-query-用sql语句操作一遍得到的数据也很excel表格一样" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/10-eb0bcc70bc757b7f57dd71831ece8ef4.png" width="1426" height="796" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下一步我们要通过数据创建图表">下一步,我们要通过数据创建图表📈<a class="hash-link" href="#下一步我们要通过数据创建图表" title="Direct link to heading">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1-到目前为止我们编写了一个查询莎士比亚的应用程序进行了排序然后将结构显示在表格中我们现在要createcolumnchart功能在最后一行代码之后bq-sheets-slidesgsrunquery">1 到目前为止,我们编写了一个查询莎士比亚的应用程序,进行了排序,然后将结构显示在表格中,我们现在要createColumnChart()功能,{在最后一行代码之后}bq-sheets-slides.gsrunQuery()<a class="hash-link" href="#1-到目前为止我们编写了一个查询莎士比亚的应用程序进行了排序然后将结构显示在表格中我们现在要createcolumnchart功能在最后一行代码之后bq-sheets-slidesgsrunquery" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Uses spreadsheet data to create columnar chart.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param {Spreadsheet} Spreadsheet containing results data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @returns {EmbeddedChart} visualizing the results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see http://developers.google.com/apps-script/reference/spreadsheet/embedded-chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createColumnChart(spreadsheet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Retrieve the populated (first and only) Sheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var sheet = spreadsheet.getSheets()[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Data range in Sheet is from cell A2 to B11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_CELL = 'A2';  // skip header row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var END_CELL = 'B11';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Place chart on Sheet starting on cell E5.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_ROW = 5;      // row 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_COL = 5;      // col E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var OFFSET = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create &amp; place chart on the Sheet using above params.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var chart = sheet.newChart()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .setChartType(Charts.ChartType.COLUMN)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .addRange(sheet.getRange(START_CELL + ':' + END_CELL))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .setPosition(START_ROW, START_COL, OFFSET, OFFSET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet.insertChart(chart);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-返回电子表格在上面的代码中-createcolumnchart函数需要电子表格对象因此调整应用程序以返回spreadsheet对象以便可以将其传递给createcolumnchart所以我们在runquery函数最后一行添加一下代码">2 返回电子表格:在上面的代码中, createColumnChart()函数需要电子表格对象,因此调整应用程序以返回spreadsheet对象,以便可以将其传递给createColumnChart().所以我们在runQuery()函数最后一行添加一下代码<a class="hash-link" href="#2-返回电子表格在上面的代码中-createcolumnchart函数需要电子表格对象因此调整应用程序以返回spreadsheet对象以便可以将其传递给createcolumnchart所以我们在runquery函数最后一行添加一下代码" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Logger.log('Results spreadsheet created: %s', spreadsheet.getUrl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Return the spreadsheet object for later use.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return spreadsheet;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-执行createbigquerypresentation功能我们把bigquery和chart-creation-功能分开是不错的注意我们可以创建一个createbigquerypresentation功能去驱动app调用两者和调用createcolumnchart函数">3 执行createBigQueryPresentation()功能,我们把BigQuery和chart-creation 功能分开是不错的注意.我们可以创建一个createBigQueryPresentation()功能去驱动app,调用两者和调用createColumnChart()函数<a class="hash-link" href="#3-执行createbigquerypresentation功能我们把bigquery和chart-creation-功能分开是不错的注意我们可以创建一个createbigquerypresentation功能去驱动app调用两者和调用createcolumnchart函数" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Runs a BigQuery query, adds data and a chart in a Sheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createBigQueryPresentation() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var spreadsheet = runQuery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  createColumnChart(spreadsheet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们把这块代码放到以下代码下面</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Filename for data results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var QUERY_NAME = "Most common words in all of Shakespeare's works";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Replace this value with your Google Cloud API project ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var PROJECT_ID = 'project-id-4323960745859879834';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!PROJECT_ID) throw Error('Project ID is required in setup');</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为了使得代码可以复用性我们有两步要做">为了使得代码可以复用性,我们有两步要做<a class="hash-link" href="#为了使得代码可以复用性我们有两步要做" title="Direct link to heading">​</a></h3><p>1: 返回spreadsheet对象
2: 创建一个驱动函数
同时如果一个同事需要复用runQuery()函数,但是不想要连接登录呢
我们可以代码修改一下,具体如下:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Runs a BigQuery query, adds data and a chart in a Sheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createBigQueryPresentation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> spreadsheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Results spreadsheet created: %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">createColumnChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spreadsheet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="具体呈现如下">具体呈现如下:<a class="hash-link" href="#具体呈现如下" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="png" src="/assets/images/11-720cfc6dbc334e7e865656ac727a7cb5.png" width="575" height="226" class="img_ev3q"></p><p>整段代码具体如下:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Copyright 2018 Google LLC</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Licensed under the Apache License, Version 2.0 (the "License");</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * you may not use this file except in compliance with the License.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * You may obtain a copy of the License at apache.org/licenses/LICENSE-2.0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Unless required by applicable law or agreed to in writing, software</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * distributed under the License is distributed on an "AS IS" BASIS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * See the License for the specific language governing permissions and</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * limitations under the License.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Filename for data results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">QUERY_NAME</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Most common words in all of Shakespeare's works"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Replace this value with your Google Cloud API project ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'qwiklabs-gcp-5c0cf6ad321746e4'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token known-class-name class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Project ID is required in setup'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Runs a BigQuery query, adds data and a chart in a Sheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createBigQueryPresentation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> spreadsheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Results spreadsheet created: %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">createColumnChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spreadsheet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Runs a BigQuery query; puts results into Sheet. You must enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * the BigQuery advanced service before you can run this code.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://developers.google.com/apps-script/advanced/bigquery#run_query</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://github.com/gsuitedevs/apps-script-samples/blob/master/advanced/bigquery.gs</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Spreadsheet} Returns a spreadsheet with BigQuery results</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://developers.google.com/apps-script/reference/spreadsheet/spreadsheet</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Replace sample with your own BigQuery query.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> request </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'SELECT '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'LOWER(word) AS word, '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'SUM(word_count) AS count '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'FROM [bigquery-public-data:samples.shakespeare] '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'GROUP BY word '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'ORDER BY count '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'DESC LIMIT 10'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> queryResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">BigQuery</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Jobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> jobId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jobReference</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jobId</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Wait for BQ job completion (with exponential backoff).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> sleepTimeMs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jobComplete</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Utilities</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sleepTimeMs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleepTimeMs </span><span class="token operator" style="color:#393A34">*=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">BigQuery</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Jobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getQueryResults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get all results from BigQuery.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rows</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pageToken</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">BigQuery</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Jobs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getQueryResults</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PROJECT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">pageToken</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">pageToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Return null if no data returned.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'No rows returned.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Create the new results spreadsheet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> spreadsheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">SpreadsheetApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">QUERY_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> sheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getActiveSheet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Add headers to Sheet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queryResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fields</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">field</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> field</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toUpperCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Append the results.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cols</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> cols</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cols</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">v</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Start storing data in row 2, col 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_ROW</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// skip header row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_COL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">START_ROW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_COL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setValues</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Results spreadsheet created: %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Return the spreadsheet object for later use.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Uses spreadsheet data to create columnar chart.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {Spreadsheet} Spreadsheet containing results data</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {EmbeddedChart} visualizing the results</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @see http://developers.google.com/apps-script/reference/spreadsheet/embedded-chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createColumnChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">spreadsheet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Retrieve the populated (first and only) Sheet.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> sheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getSheets</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Data range in Sheet is from cell A2 to B11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_CELL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'A2'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// skip header row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">END_CELL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'B11'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Place chart on Sheet starting on cell E5.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_ROW</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// row 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_COL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// col E</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OFFSET</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Create &amp; place chart on the Sheet using above params.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chart </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">newChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setChartType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Charts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">ChartType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">COLUMN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">START_CELL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">':'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">END_CELL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setPosition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">START_ROW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">START_COL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OFFSET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OFFSET</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insertChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chart</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后我们通过选run-createBigQueryPresentation()函数,我们去到google drive去看我们表格,图片</p><p>最后一部分,我们将创建一个新的google ppt,然后再标题幻灯片上填充标题和副标题,然后添加2张新slide,一个用于数据单元格,另外一个用于图表</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-创建幻灯片">1 创建幻灯片<a class="hash-link" href="#1-创建幻灯片" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Create presentation with spreadsheet data &amp; chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {Spreadsheet} Spreadsheet with results data</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {EmbeddedChart} Sheets chart to embed on slide</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns {Presentation} Slide deck with results</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createSlidePresentation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">spreadsheet</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> chart</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Create the new presentation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> deck </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">SlidesApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">QUERY_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Populate the title slide.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> subtitle</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> deck</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getSlides</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getPageElements</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">asShape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">QUERY_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subtitle</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">asShape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'via GCP and G Suite APIs:\n'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'Google Apps Script, BigQuery, Sheets, Slides'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-添加数据表-我们通过createslidepresentation把单元格数据从google表格导入我们的新ppt中">2 添加数据表: 我们通过createSlidePresentation()把单元格数据从google表格导入我们的新ppt中<a class="hash-link" href="#2-添加数据表-我们通过createslidepresentation把单元格数据从google表格导入我们的新ppt中" title="Direct link to heading">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // Data range to copy is from cell A1 to B11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_CELL = 'A1';  // include header row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var END_CELL = 'B11';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Add the table slide and insert an empty table on it of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the dimensions of the data range; fails if Sheet empty.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var tableSlide = deck.appendSlide(SlidesApp.PredefinedLayout.BLANK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var sheetValues = spreadsheet.getSheets()[0].getRange(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      START_CELL + ':' + END_CELL).getValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var table = tableSlide.insertTable(sheetValues.length, sheetValues[0].length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Populate the table with spreadsheet data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (var i = 0; i &lt; sheetValues.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (var j = 0; j &lt; sheetValues[0].length; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      table.getCell(i, j).getText().setText(String(sheetValues[i][j]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-导入图表在createslidepresentation函数中再创建一张ppt从电子表格中导入图表返回presentation对象deck">3 导入图表,在createSlidePresentation()函数中再创建一张ppt,从电子表格中导入图表,返回Presentation对象deck<a class="hash-link" href="#3-导入图表在createslidepresentation函数中再创建一张ppt从电子表格中导入图表返回presentation对象deck" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Add a chart slide and insert the chart on it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chartSlide </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> deck</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendSlide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">SlidesApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">PredefinedLayout</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">BLANK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  chartSlide</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insertSheetsChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chart</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Return the presentation object for later use.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> deck</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-返回图-我们需要让createcolumnchart返回对象所以我们在尾端接收createcolumnchart">4 返回图: 我们需要让createColumnChart()返回对象,所以我们在尾端接收createColumnChart():<a class="hash-link" href="#4-返回图-我们需要让createcolumnchart返回对象所以我们在尾端接收createcolumnchart" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Return chart object for later use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> chart</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="更新createbigquerypresentation因为createcolumnchart返回了图表所以我们要把这个图表保存到变量然后把电子表格和图表都传递给createslidepresentation函数">更新createBigQueryPresentation(),因为createColumnChart()返回了图表,所以我们要把这个图表保存到变量,然后把电子表格和图表都传递给createSlidePresentation()函数<a class="hash-link" href="#更新createbigquerypresentation因为createcolumnchart返回了图表所以我们要把这个图表保存到变量然后把电子表格和图表都传递给createslidepresentation函数" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Runs a BigQuery query, adds data and a chart in a Sheet,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * and adds the data and chart to a new slide presentation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createBigQueryPresentation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> spreadsheet </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Results spreadsheet created: %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spreadsheet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> chart </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createColumnChart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spreadsheet</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> deck </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createSlidePresentation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spreadsheet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chart</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">Logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Results slide deck created: %s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> deck</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后的版本如下:</p><div class="language-javescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javescript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Filename for data results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var QUERY_NAME = "Most common words in all of Shakespeare's works";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Replace this value with your Google Cloud API project ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var PROJECT_ID = '&lt;YOUR_PROJECT_ID&gt;';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!PROJECT_ID) throw Error('Project ID is required in setup');</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Runs a BigQuery query; puts results into Sheet. You must enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * the BigQuery advanced service before you can run this code.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see http://developers.google.com/apps-script/advanced/bigquery#run_query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see http://github.com/gsuitedevs/apps-script-samples/blob/master/advanced/bigquery.gs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @returns {Spreadsheet} Returns a spreadsheet with BigQuery results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see http://developers.google.com/apps-script/reference/spreadsheet/spreadsheet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function runQuery() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Replace sample with your own BigQuery query.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var request = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SELECT ' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'LOWER(word) AS word, ' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'SUM(word_count) AS count ' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'FROM [bigquery-public-data:samples.shakespeare] ' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'GROUP BY word ' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'ORDER BY count ' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'DESC LIMIT 10'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var queryResults = BigQuery.Jobs.query(request, PROJECT_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var jobId = queryResults.jobReference.jobId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Wait for BQ job completion (with exponential backoff).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var sleepTimeMs = 500;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (!queryResults.jobComplete) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Utilities.sleep(sleepTimeMs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleepTimeMs *= 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryResults = BigQuery.Jobs.getQueryResults(PROJECT_ID, jobId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Get all results from BigQuery.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var rows = queryResults.rows;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (queryResults.pageToken) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryResults = BigQuery.Jobs.getQueryResults(PROJECT_ID, jobId, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pageToken: queryResults.pageToken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows = rows.concat(queryResults.rows);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Return null if no data returned.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rows) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Logger.log('No rows returned.');</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create the new results spreadsheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var spreadsheet = SpreadsheetApp.create(QUERY_NAME);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var sheet = spreadsheet.getActiveSheet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Add headers to Sheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var headers = queryResults.schema.fields.map(function(field) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return field.name.toUpperCase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet.appendRow(headers);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Append the results.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var data = new Array(rows.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (var i = 0; i &lt; rows.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var cols = rows[i].f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data[i] = new Array(cols.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (var j = 0; j &lt; cols.length; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data[i][j] = cols[j].v;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Start storing data in row 2, col 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_ROW = 2;      // skip header row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_COL = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet.getRange(START_ROW, START_COL, rows.length, headers.length).setValues(data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Return the spreadsheet object for later use.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return spreadsheet;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Uses spreadsheet data to create columnar chart.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param {Spreadsheet} Spreadsheet containing results data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @returns {EmbeddedChart} visualizing the results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see http://developers.google.com/apps-script/reference/spreadsheet/embedded-chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createColumnChart(spreadsheet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Retrieve the populated (first and only) Sheet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var sheet = spreadsheet.getSheets()[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Data range in Sheet is from cell A2 to B11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_CELL = 'A2';  // skip header row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var END_CELL = 'B11';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Place chart on Sheet starting on cell E5.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_ROW = 5;      // row 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_COL = 5;      // col E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var OFFSET = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create &amp; place chart on the Sheet using above params.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var chart = sheet.newChart()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .setChartType(Charts.ChartType.COLUMN)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .addRange(sheet.getRange(START_CELL + ':' + END_CELL))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .setPosition(START_ROW, START_COL, OFFSET, OFFSET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sheet.insertChart(chart);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Return the chart object for later use.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return chart;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Create presentation with spreadsheet data &amp; chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param {Spreadsheet} Spreadsheet with results data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param {EmbeddedChart} Sheets chart to embed on slide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @returns {Presentation} Returns a slide deck with results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see http://developers.google.com/apps-script/reference/slides/presentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createSlidePresentation(spreadsheet, chart) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create the new presentation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var deck = SlidesApp.create(QUERY_NAME);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Populate the title slide.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var [title, subtitle] = deck.getSlides()[0].getPageElements();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title.asShape().getText().setText(QUERY_NAME);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subtitle.asShape().getText().setText('via GCP and G Suite APIs:\n' +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'Google Apps Script, BigQuery, Sheets, Slides');</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Data range to copy is from cell A1 to B11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var START_CELL = 'A1';  // include header row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var END_CELL = 'B11';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Add the table slide and insert an empty table on it of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // the dimensions of the data range; fails if Sheet empty.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var tableSlide = deck.appendSlide(SlidesApp.PredefinedLayout.BLANK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var sheetValues = spreadsheet.getSheets()[0].getRange(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      START_CELL + ':' + END_CELL).getValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var table = tableSlide.insertTable(sheetValues.length, sheetValues[0].length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Populate the table with spreadsheet data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (var i = 0; i &lt; sheetValues.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (var j = 0; j &lt; sheetValues[0].length; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      table.getCell(i, j).getText().setText(String(sheetValues[i][j]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Add a chart slide and insert the chart on it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var chartSlide = deck.appendSlide(SlidesApp.PredefinedLayout.BLANK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  chartSlide.insertSheetsChart(chart);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Return the presentation object for later use.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return deck;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Runs a BigQuery query, adds data and a chart in a Sheet,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * and adds the data and chart to a new slide presentation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createBigQueryPresentation() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var spreadsheet = runQuery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Logger.log('Results spreadsheet created: %s', spreadsheet.getUrl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var chart = createColumnChart(spreadsheet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var deck = createSlidePresentation(spreadsheet, chart);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Logger.log('Results slide deck created: %s', deck.getUrl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="执行后我们就会看到以下效果">执行后,我们就会看到以下效果:<a class="hash-link" href="#执行后我们就会看到以下效果" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/12-664c1b6a26705febd8b7bd9d68b81f59.png" width="1106" height="630" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/13-b6cd49270997a8fe9a3ccec4cc499c5b.png" width="887" height="306" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/14-fdadb41767af7328876bb98fc6461a32.png" width="449" height="170" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/15-b576a07f3be852541730b6f059f991dd.png" width="1094" height="607" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/16-75ecc42bb641877198cbbf09c9cb28ab.png" width="1624" height="861" class="img_ev3q"></p><h1>是不是超酷呢??</h1>]]></content:encoded>
            <category>script</category>
            <category>excel</category>
            <category>google</category>
        </item>
        <item>
            <title><![CDATA[Bigquery中sql语句常用命令]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/15/bq_sql常用短语</link>
            <guid>/2020/4/15/bq_sql常用短语</guid>
            <pubDate>Wed, 15 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[连接数据库]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="连接数据库">连接数据库<a class="hash-link" href="#连接数据库" title="Direct link to heading">​</a></h2><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud </span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">connect</span><span class="token plain">  qwiklabs</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">demo </span><span class="token comment" style="color:#999988;font-style:italic">--user=root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="合并两个表格union">合并两个表格union<a class="hash-link" href="#合并两个表格union" title="Direct link to heading">​</a></h2><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> start_station_name </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> top_stations</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> london1 </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> num</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">UNION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> end_station_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> london2 </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> num</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> top_stations </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>参考 <a href="https://blog.csdn.net/qq_41359051/article/details/98469387#UNION_157" target="_blank" rel="noopener noreferrer">Uninon和join的区别</a></p><p><a href="https://www.cnblogs.com/CraryPrimitiveMan/p/3665154.html" target="_blank" rel="noopener noreferrer">UNION</a>中间的关键字通过将“ london2”数据与“ london1”同化来组合这些查询的输出。由于将“ london1”与“ london2”结合在一起，因此列名优先为“ top_stations”和“ num”。</p><p>ORDER BY 将按照“ top_stations”列值的字母顺序和降序对最终的联合表进行排序。
<img loading="lazy" alt="png" src="/assets/images/bq_mysql-30d73aa8731e88db6eea151b3013bf6d.png" width="558" height="667" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加数据--insert-into-表-字段字段-values-值值">添加数据  insert into 表 (字段,字段) values (值,值);<a class="hash-link" href="#添加数据--insert-into-表-字段字段-values-值值" title="Direct link to heading">​</a></h2><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> london1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_station_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"test destination"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行查询命令">运行查询命令<a class="hash-link" href="#运行查询命令" title="Direct link to heading">​</a></h2><p>bq query --use_legacy_sql=false 'select 字段 from 表格 where 条件'
注意的地方是 </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use_legacy_sqlfalse-表示使用标准sql语句">use_legacy_sql=false 表示使用标准sql语句<a class="hash-link" href="#use_legacy_sqlfalse-表示使用标准sql语句" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="条件的时候可以使用双引号做区分">条件的时候可以使用双引号做区分""<a class="hash-link" href="#条件的时候可以使用双引号做区分" title="Direct link to heading">​</a></h3><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-inghts.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">What's wrong with the previous query to view 1000 items? check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There is a typo in the dataset name check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We have not specified any columns in the SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There is a typo in the table name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We are using legacy SQL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>what about this updated query?</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">data</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">to</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">insights:ecommerce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rev_transactions</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">''</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">we are </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> legacy </span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">what about this query that uses standard </span><span class="token keyword" style="color:#00009f">SQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token identifier">#standardSQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token identifier">SELECT FROM </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token keyword" style="color:#00009f">data</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">to</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">insights</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ecommerce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rev_transactions</span><span class="token punctuation" style="color:#393A34">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>no columns defined in select</p><p>what about now?</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fullVisitorId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>without aggregations,limits or sorting, this query is not insightful</p><p>what about now?</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> fullVisitorId hits_page_pageTitle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>it can be excuated.</p><p>what about now?</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fullVisitorId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hits_page_pageTitle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>this returns result, but visitors maybe counted twice.</p><p>what about this? an aggregation function, count(), was added.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> visitor_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hits_page_pageTitle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>没去重,the count()function does not de-deduplicate the same fullvisitorid
it is missing a group by clause</p><p>in this next query, group by and distinct statements were added</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> visitor_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hits_page_pageTitle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> hits_page_pageTitle</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>we can add filter 'where' to filter results</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> visitor_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hits_page_pageTitle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> hits_page_pageTitle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Checkout Confirmation"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> hits_page_pageTitle</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>List the cities with the most transactions with your ecommerce site</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">geoNetwork_city</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totals_transactions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> totals_transactions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> distinct_visitors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> geoNetwork_city</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> distinct_visitors </span><span class="token keyword" style="color:#00009f">Desc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>whats wrong with the following query?</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">geoNetwork_city</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totals_transactions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> total_products_ordered</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> distinct_visitors</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totals_transactions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> avg_products_ordered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> avg_products_ordered </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> geoNetwork_city</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> avg_products_ordered </span><span class="token keyword" style="color:#00009f">DESC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>we cannot filter aggregated fields in the 'where' clause ( use 'Having' instead) 不可以用where来聚合函数的字段,要用having
we cannot filter on aliased fields within the 'where' clause
where过滤句中不能使用别名</p><p>possible solution</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> geoNetwork_city</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totals_transactions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> total_products_ordered</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">distinct</span><span class="token plain"> fullvisitorID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> distinct_visitors</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totals_transactions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">distinct</span><span class="token plain"> fullVisitorId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">As</span><span class="token plain"> avg_products_ordered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> geoNetwork_city</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Having</span><span class="token plain"> avg_products_ordered </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> avg_products_ordered</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hits_product_v2ProductName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> number_of_products</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hits_product_v2ProductCategory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> hits_product_v2ProductName </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> hits_product_v2ProductCategory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> number_of_products </span><span class="token keyword" style="color:#00009f">DESC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里的问题是count()函数里面的字段没有做distinct,有可能导致重复
The count() function is not the distinct number of products in each category</p><p>possible solution</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#standardSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> hits_product_v2ProductName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> number_of_products</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hits_product_v2ProductCategory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">data-to-insights.ecommerce.rev_transactions</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> hits_product_v2ProductName </span><span class="token operator" style="color:#393A34">IS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> hits_product_v2ProductCategory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> number_of_products </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>gcp</category>
            <category>command line</category>
            <category>github</category>
        </item>
        <item>
            <title><![CDATA[谷歌常用命令]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/15/gcp_常用命令</link>
            <guid>/2020/4/15/gcp_常用命令</guid>
            <pubDate>Wed, 15 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[列出活动账号名称]]></description>
            <content:encoded><![CDATA[<p>列出活动账号名称</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth </span><span class="token builtin">list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>列出项目id</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config list project</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>设置项目id </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set project project ID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>列举所有项目</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查询有哪些可以开启的api,并且开启</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable bigquery.googleapis.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>gcp</category>
            <category>command line</category>
            <category>github</category>
        </item>
        <item>
            <title><![CDATA[dataflow简单入门-apache beam 基本概念]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/dataflow-apache beam基本概念</link>
            <guid>/2020/4/11/dataflow-apache beam基本概念</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[1 Pipeline 管道]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-pipeline-管道">1 Pipeline 管道<a class="hash-link" href="#1-pipeline-管道" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-pcollection">2 Pcollection<a class="hash-link" href="#2-pcollection" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-ptransform">3 Ptransform<a class="hash-link" href="#3-ptransform" title="Direct link to heading">​</a></h2><p>总体流程就是 设置pipeline &gt;&gt; read data &gt;&gt; pcollection &gt;&gt; ptransform &gt;&gt; pcollection </p><p>其中ptransform有ParDo和耦合函数功能</p><p>ParDo()里面只能接收的是DoFn类或集成DoFn类的对象的函数,ParDo操作的是每一行的数据,就好像dataframe里面的一行</p><h1>敲黑板时间!!</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="读取csv和txt文件pipeline读取得每一行为字符串也就是属于pandas里面的seris-也就是只有一列如果要分开几列我们就要split字符串然后做成keyvalue字典格式">读取Csv和txt文件,Pipeline读取得每一行为字符串,也就是,属于pandas里面的seris, 也就是只有一列,如果要分开几列,我们就要split字符串,然后做成key:value字典格式.<a class="hash-link" href="#读取csv和txt文件pipeline读取得每一行为字符串也就是属于pandas里面的seris-也就是只有一列如果要分开几列我们就要split字符串然后做成keyvalue字典格式" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="读取avro文件时候pipeline读取的每一行为字典也就是pandas里面的一行dataframe如果要取值我们需要element列名就可以取到">读取avro文件时候,Pipeline读取的每一行为字典{},也就是pandas里面的一行dataframe,如果要取值,我们需要element<!-- -->[列名]<!-- -->就可以取到<a class="hash-link" href="#读取avro文件时候pipeline读取的每一行为字典也就是pandas里面的一行dataframe如果要取值我们需要element列名就可以取到" title="Direct link to heading">​</a></h2><p>聚合函数操作后,就会返回一个整体的新的Pcollection
记住字典格式要做聚合函数要变成列表或者元组</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="groupbykey--对象是一个pcollection首先选择要做聚合的key和值然后tranform一个pcollection格式为turple里面为keyvalue最后通过管道--beamgroupbykey">Groupbykey--对象是一个Pcollection,首先选择要做聚合的key和值,然后tranform一个pcollection格式为turple,里面为(key,value),最后通过管道 | beam.GroupByKey()<a class="hash-link" href="#groupbykey--对象是一个pcollection首先选择要做聚合的key和值然后tranform一个pcollection格式为turple里面为keyvalue最后通过管道--beamgroupbykey" title="Direct link to heading">​</a></h2><p>就会生成按key分类, 以下这样的效果,具体说明<a href="https://beam.apache.org/documentation/programming-guide/#core-beam-transforms" target="_blank" rel="noopener noreferrer">例子</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat, 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dog, 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and, 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jump, 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tree, 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat, 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dog, 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and, 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat, 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and, 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>变成</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat, [1,5,9]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dog, [5,2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and, [1,2,6]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jump, [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tree, [2]               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>##CoGroupKey--操作对象Pcollection,把两个Pcollection通过key连接起来,
比如Pcollection1:  是宠物名字和年龄
'''
"Amy", 9</p><p>"Tom", 3</p><p>"Shierly", 3</p><p>"Miccle", 4</p><p>"Dockey", 4</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Pcollection2: 是宠物名字和主人名字</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>"Amy", "michael"</p><p>"Tom", "Tommy"</p><p>"Shierly", "Darren"</p><p>"Miccle", "Cherry"</p><p>"Dockey", "Dick"</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>age_list = [("Amy", 9),</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   ("Tom", 3),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ("Shierly", 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ("Miccle", 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ("Dockey", 4])]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Owner_list = [("Amy", "michael"),</p><p>("Tom", "Tommy"),</p><p>("Shierly", "Darren"),</p><p>("Miccle", "Cherry"),</p><p>("Dockey", "Dick")]</p><p>然后我们开始创建两个Pcollections</p><p>age = P |"create age" &gt;&gt; beam.Create(age_list)
owner = P | "create owner" &gt;&gt; beam.Create(owner_list)</p><p>我们用CoGroupbyKey的时候,是使用key,value的字典格式作为输入</p><p>格式为 results = {"Pcollection1名字":Pcollection1, "Pcollection2名字":Pcollection2} | beam.CoGroupByKey()</p><p>得到的效果是 <!-- -->[(Key1,{"Pcollection1名字":Pcollection1, "Pcollection2名字":Pcollection2}), (Key2,{"Pcollection1名字":Pcollection1, "Pcollection2名字":Pcollection2}),(Key3,{"Pcollection1名字":Pcollection1, "Pcollection2名字":Pcollection2})]</p><p>呈现效果是:
<!-- -->["Tom" , {'age':3, "owner":"Tommy"}
"Shierly" ,{'age':3,"owner":"Darren"}
"Amy",{'age':9,"owner":"michael"}
...
]</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结cogroupbykey就是把两个pcollection通过共同的key连接起来然后用元组keyvalue显示出来values是一个字典格式包含pcollection名字value_list">总结CoGroupByKey就是把两个Pcollection通过共同的Key连接起来,然后用元组(key,value)显示出来,values是一个字典格式,包含Pcollection名字:value_list<a class="hash-link" href="#总结cogroupbykey就是把两个pcollection通过共同的key连接起来然后用元组keyvalue显示出来values是一个字典格式包含pcollection名字value_list" title="Direct link to heading">​</a></h2><h1>一句话表示:</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cogroupbykey就是元组key包含字典pcollection与定义的value">COGroupByKey就是元组key包含字典pcollection与定义的value<a class="hash-link" href="#cogroupbykey就是元组key包含字典pcollection与定义的value" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="groubbykey就是元组key包含value_list">GroubByKey就是元组key包含value_list<a class="hash-link" href="#groubbykey就是元组key包含value_list" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="combineperkeybeamcombinersmeancombinefn">CombinePerKey(beam.combiners.MeanCombineFn)<a class="hash-link" href="#combineperkeybeamcombinersmeancombinefn" title="Direct link to heading">​</a></h2><p>就是把groupbykey 再对每个key的value做加权平均</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="flatten-把多个pcollection-变成一个-pcollection">Flatten 把多个PCollection 变成一个 PCollection,<a class="hash-link" href="#flatten-把多个pcollection-变成一个-pcollection" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="说白了就是把多个列表的值放到一个列表">说白了就是把多个列表的值放到一个列表<a class="hash-link" href="#说白了就是把多个列表的值放到一个列表" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Flatten takes a tuple of PCollection objects.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Returns a single PCollection that contains all of the elements in the PCollection objects in that tuple.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">merged = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (pcoll1, pcoll2, pcoll3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # A list of tuples can be "piped" directly into a Flatten transform.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | beam.Flatten())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>dataflow</category>
            <category>bigquery</category>
            <category>subpub</category>
            <category>steaming</category>
        </item>
        <item>
            <title><![CDATA[dataflow简单入门-使用apache_beam创建,运行作业]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/dataflow创建作业</link>
            <guid>/2020/4/11/dataflow创建作业</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[1. 在本地创建来测试运行]]></description>
            <content:encoded><![CDATA[<ol><li>在本地创建来测试运行</li><li>放到dataflow上运行</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="本地创建job">本地创建job<a class="hash-link" href="#本地创建job" title="Direct link to heading">​</a></h2><p>1 首先是安装我们需要打工具包,因为我是将来是要运行到GCP上的,所以我们安装的是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install apache_beam[gcp]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2 导入各种包</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import PipelineOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import GoogleCloudOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import StandardOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.io.textio import ReadFromText, WriteToText #用来读写文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>3 设置配置</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 输入输出路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_filename = "./input.txt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output_filename = "./output.txt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#指定执行选项,以告诉Pipeline运行位置和运行方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options = PipelineOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options.view_as(StandardOptions).runner = "direct" #表示本地运行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 写功能类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#DoFn就是把类,转换,callable的功能集合在一起,我们可以直接继承,方便后面管道使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#所有ParDo的操作都必须要跟DoFn类的函数,比如ParDo(DoFn())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Split(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self, element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Splits each row on commas and returns a dictionary representing the row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        我们这里做的事情就是类似mapper, 将所有元素变成字典</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        country,duration,user = element.split(",")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(len(element))# element就是每行的数据,跟hdfs一样,视力有问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                'country':country,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                'duration':duration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                'user':user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CollectTimings(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self,element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = [element('country'),element('duration')]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CollectUsers(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self,element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Returns a list of tuples containing country and user name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [element('country'),element('user')]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class WriteToCSV(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self,element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Prepares each row to be written in the csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = ["%s,%s,%s"%(element[0],element[1]['user'][0],element[1]['timings'][0])]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#创建管道对象, 创建变量接收Pcollection, 一定要加上(),防止歧义,如果变成 rows = P 然后 再管 | ReadFromText(input_filename), 很容易报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with beam.Pipeline(options=options) as p:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        P | ReadFromText(input_filename) | beam.ParDo(SPlit())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timings = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rows |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(CollectTimings()) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Grouping timings" &gt;&gt; beam.GroupByKey() | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Calculating average" &gt;&gt; beam.CombineValues(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beam.combiners.MeanCombineFn()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    users = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rows |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(CollectUsers()) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Grouping users" &gt;&gt; beam.GroupByKey() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Counting users" &gt;&gt; beam.CombineValues(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beam.combiners.CountCombineFn()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_be_joined = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'timings': timings,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'users': users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.CoGroupByKey() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(WriteToCSV()) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WriteToText(output_filename)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#这里的格式为pvalue | "label" &gt;&gt; transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">为什么要为什么要用"label" &gt;&gt;,其实如果任务不重复的时候,是可以不用的,但是比如这里耦合函数groupbykey出现已经在pipeline了,如果没有label就会报错,执行users时候就会报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GroupByKey是把key相同的拼为为一组,CombineValues是把值累积相加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CoGroupByKey是根据key拼接一起</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>好的,本地测试好后, 我们要放到dataflow上跑了</h1><p>1 我们需要改的就是 input,ouput 路径,记住storage bucket的权限</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input_filename = "gs://dataflow_s/input.txt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output_filename = "gs://dataflow_s/output.txt"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2 options</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dataflow_options = ['--project=query-11','--job_name=test-job','--temp_location=gs://dataflow_s/tmp','--region=us-central1']</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataflow_options.append('--staging_location=gs://dataflow_s/stage')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options = PipelineOptions(dataflow_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud_options = options.view_as(GoogleCloudOptions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options.view_as(StandardOptions).runner = "dataflow" # 指定后端跑在dataflow</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里有个坑,如果你的apache beam是2.15版本以上的话,是需要写region这个参数的
然后其他的都很本地一样,整体代码如下:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import apache_beam as beam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import PipelineOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import SetupOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import GoogleCloudOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.options.pipeline_options import StandardOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from apache_beam.io.textio import ReadFromText, WriteToText</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging.basicConfig(level=logging.INFO)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger = logging.getLogger(__name__)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_filename = "gs://dataflow_s/input.txt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output_filename = "gs://dataflow_s/output.txt"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataflow_options = ['--project=query-11','--job_name=test-job','--temp_location=gs://dataflow_s/tmp']</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dataflow_options.append('--staging_location=gs://dataflow_s/stage')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options = PipelineOptions(dataflow_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud_options = options.view_as(GoogleCloudOptions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># gcloud_options.job_name = "test-job"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options.view_as(StandardOptions).runner = "dataflow"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Split(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self, element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Splits each row on commas and returns a dictionary representing the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        country, duration, user = element.split(",")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'country': country,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'duration': float(duration),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'user': user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CollectTimings(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self, element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Returns a list of tuples containing country and duration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (element['country'], element['duration'])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CollectUsers(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self, element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Returns a list of tuples containing country and user name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (element['country'], element['user'])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class WriteToCSV(beam.DoFn):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process(self, element):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Prepares each row to be written in the csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        """</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "{},{},{}".format(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                element[0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                element[1]['users'][0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                element[1]['timings'][0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with beam.Pipeline(options=options) as p:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rows = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        p |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReadFromText(input_filename) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(Split())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timings = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rows |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(CollectTimings()) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Grouping timings" &gt;&gt; beam.GroupByKey() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Calculating average" &gt;&gt; beam.CombineValues(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beam.combiners.MeanCombineFn()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    users = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rows |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(CollectUsers()) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Grouping users" &gt;&gt; beam.GroupByKey() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Counting users" &gt;&gt; beam.CombineValues(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beam.combiners.CountCombineFn()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_be_joined = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'timings': timings,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            'users': users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.CoGroupByKey() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beam.ParDo(WriteToCSV()) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WriteToText(output_filename)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>然后把这段代码放到gcloud上</h1><p>使用命令启动,具体是安装虚拟环境,进入虚拟环境,安装apache beam包,运行python文件</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip3 install --upgrade virtualenv --user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m virtualenv env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source env/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip3 install --quiet apache-beam[gcp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python dataflow.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>然后我们就可以去job上看到运行情况</h1>]]></content:encoded>
            <category>dataflow</category>
            <category>bigquery</category>
            <category>subpub</category>
            <category>steaming</category>
        </item>
        <item>
            <title><![CDATA[dataflow简单入门-流数据输入到bigquery]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/dataflow流数据输入到bigquery</link>
            <guid>/2020/4/11/dataflow流数据输入到bigquery</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[概念: streaming 就是 动态的意思, streaming data就是动态数据, job status is streaming 就是这个作业是一直持续的]]></description>
            <content:encoded><![CDATA[<p>概念: streaming 就是 动态的意思, streaming data就是动态数据, job status is streaming 就是这个作业是一直持续的</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="大体流程是">大体流程是<a class="hash-link" href="#大体流程是" title="Direct link to heading">​</a></h2><p>create dataset,table in Bigquery &gt;&gt; create topic in SubPub </p><p>| &gt;&gt; create job and run &gt;&gt; public message in topic </p><p>| &gt;&gt; go to your job to check wrte SucessfulRecords </p><p>| &gt;&gt; go to your bigquery to check your data</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="具体流程是">具体流程是<a class="hash-link" href="#具体流程是" title="Direct link to heading">​</a></h2><ol><li>首先去project 创建dataset和table</li></ol><p><img loading="lazy" alt="png" src="/assets/images/1-ce237f6faba143a97d3305f495fd81ad.png" width="804" height="428" class="img_ev3q"></p><ol start="2"><li>然后我们去到Dataflow, create job from template</li></ol><p><img loading="lazy" alt="png" src="/assets/images/2-26e9c18031d0d10af1d466bec1939fcf.png" width="1138" height="743" class="img_ev3q"></p><ol start="3"><li>这里有几点我们要填:</li></ol><p>job name: 作业名字</p><p>cloud pub/sub input topic: 输入话题,dataflow输入数据到bigquery创建一个topic</p><p>所以,我们这里去到Pub/Sub,创建topic,把topic name 放到 cloud pub/sub input topic
<img loading="lazy" alt="png" src="/assets/images/3-487ba8b0626ca4305eba863c2ae5574c.png" width="984" height="546" class="img_ev3q"></p><p>Bigquery output: Bigquery接收数据的table表,这里我们去到我们第一步创建的页面,复制表格整体路径</p><p>Temporary location: 这里是创建数据临时放的地方,这个文件可以放在gs://my_bucket/tmp中, 注意,这个tmp文件夹一定要存在, 这个tmp文件夹可以给多个job存放</p><ol start="4"><li>然后run job</li><li>run job成功后,我们先去到我们的topic中,然后选择PUBLISH MESSAGE,</li></ol><p><img loading="lazy" alt="png" src="/assets/images/4-ac0d7056bd39ac9b35efe5a03adb8936.png" width="1444" height="672" class="img_ev3q"></p><p>然后我们在Message body上输入我们需要输入的数据,数据格式是json格式{"key":"value","k","v"},然后publish</p><p><img loading="lazy" alt="png" src="/assets/images/5-f3d91932d30bd7a79897cb271113d454.png" width="661" height="768" class="img_ev3q"></p><ol start="6"><li>然后我们回到job,查看job detail, 我们点击writesuccessfulRecords,可以看到右边Elements added 出现了你添加了多少条,比如我添加了两条,他就显示2条</li></ol><p><img loading="lazy" alt="png" src="/assets/images/6-f4187653e0c8d80f4ca14c14d49ff018.png" width="1171" height="563" class="img_ev3q"></p><ol start="7"><li>最后我们可以去bigquery查看</li></ol><p><img loading="lazy" alt="png" src="/assets/images/7-9e2f79782e6265e8e3f820dee46c974f.png" width="1159" height="613" class="img_ev3q"></p>]]></content:encoded>
            <category>dataflow</category>
            <category>bigquery</category>
            <category>subpub</category>
            <category>steaming</category>
        </item>
        <item>
            <title><![CDATA[5分钟在谷歌云上使用dataflow来运行job]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/dataflow用Apache Beam python运行 Apache Beam copy 2</link>
            <guid>/2020/4/11/dataflow用Apache Beam python运行 Apache Beam copy 2</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[png]]></description>
            <content:encoded><![CDATA[<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set project query-11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>创建虚拟环境,并且激活</h1><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip3 install </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">upgrade virtualenv </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">m virtualenv env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source env</span><span class="token operator" style="color:#393A34">/</span><span class="token builtin">bin</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">activate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>安装samples和apache Beam SDK</h1><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip3 install </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">quiet apache</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">beam</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">gcp</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>建立一个cloud storage bucket</h1><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gustil mb gs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">query</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>在dataflow开启pipeline</h1><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">m \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apache_beam</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">examples</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wordcount \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">project query</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">runner \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataflowRunner </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">temp_location \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">query</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">temp </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">query</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">11</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">results</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">job_name dataflow</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">intro</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>我们可以去到dataflow,点击flow</h1><p><img loading="lazy" alt="png" src="/assets/images/1-565ff0b7d90d0ee6818c31a8fee3d613.png" width="386" height="114" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/2-05b8d8cbdc05af0c897c45baffe19eb8.png" width="1107" height="272" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/3-99ad346fc5a69d76bebf3ed08e1febc9.png" width="1112" height="729" class="img_ev3q"></p>]]></content:encoded>
            <category>dataproc</category>
            <category>GCP</category>
            <category>Spark</category>
            <category>Hadoop</category>
        </item>
        <item>
            <title><![CDATA[5分钟在谷歌云上创建jupyterhub]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/jupyterhub_GCP</link>
            <guid>/2020/4/11/jupyterhub_GCP</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[这个是常规操作,所以就不解释了]]></description>
            <content:encoded><![CDATA[<p>这个是常规操作,所以就不解释了
<img loading="lazy" alt="png" src="/assets/images/left-menu-button-5e8462d4d6d09cc142e8b4a9f41dac6b.png" width="317" height="209" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/vm-instances-menu-1bc271695c072f9e97bcf01d78f71dd3.png" width="617" height="783" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/enable-billing-38441a672a9366d746b549207878285f.png" width="895" height="311" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/create-vm-first-07cd5406d0c02b7019fd4ed8e229393a.png" width="520" height="282" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="选择region">选择region,<a class="hash-link" href="#选择region" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cpu要超过1gb">cpu要超过1GB,<a class="hash-link" href="#cpu要超过1gb" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="boot-disk启动磁盘选择ubuntu-1804lts">Boot disk启动磁盘选择ubuntu 18.04LTS<a class="hash-link" href="#boot-disk启动磁盘选择ubuntu-1804lts" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="data:image/png;base64,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" width="528" height="112" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/boot-disk-button-fb8746ad1d428ca1cfe3c060fe665808.png" width="515" height="146" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/boot-disk-ubuntu-846db01a0f287f28096c9d48144d9cb8.png" width="476" height="573" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="在identity-and-api-access-选择no-service-account">在identity and API access 选择No service account<a class="hash-link" href="#在identity-and-api-access-选择no-service-account" title="Direct link to heading">​</a></h2><p>这样做可以防止你的jupyter hub users 进入其他云服务,提升安全
<img loading="lazy" alt="png" src="/assets/images/no-service-account-2511c823635d606568eccf0c62b92019.png" width="526" height="285" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="防火墙的选择允许http和https">防火墙的选择,允许http和https<a class="hash-link" href="#防火墙的选择允许http和https" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="data:image/png;base64,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" width="438" height="94" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="copy-以下链接到startup-script上来安装jupyterhub">copy 以下链接到startup script上来安装jupyterhub<a class="hash-link" href="#copy-以下链接到startup-script上来安装jupyterhub" title="Direct link to heading">​</a></h2><p>这里admin-user-name要替换成你的用户名,用来等下的登录,如"flybird"</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">raw</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">githubusercontent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">jupyterhub</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">the</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">littlest</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">jupyterhub</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">master</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">bootstrap</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> sudo python3 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">admin </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">admin</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">user</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建vm实例">创建vm实例<a class="hash-link" href="#创建vm实例" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="data:image/png;base64,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" width="314" height="88" class="img_ev3q">
<img loading="lazy" alt="png" src="data:image/png;base64,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" width="798" height="87" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="大概20分钟后jupyterhub就创建成功我们可以复制external-ip到浏览器查看">大概20分钟后,jupyterhub就创建成功,我们可以复制external ip到浏览器查看<a class="hash-link" href="#大概20分钟后jupyterhub就创建成功我们可以复制external-ip到浏览器查看" title="Direct link to heading">​</a></h2><p>!! 注意, 没创建成功成, 浏览器会提示diaed tcp, conection refused, 所以不用着急
<img loading="lazy" alt="png" src="/assets/images/first-login-0dc1ec8fc7901d97f8862e2a562a060a.png" width="490" height="521" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="用之前startup-script写的用户名登录">用之前startup script写的用户名登录<a class="hash-link" href="#用之前startup-script写的用户名登录" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-8e4115d198e7d59d2aec7e14a9145871.png" width="807" height="209" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="选择admin可以创建用户">选择admin,可以创建用户<a class="hash-link" href="#选择admin可以创建用户" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/2-6c5c3fe4f37b80c70904bf26ae5443af.png" width="1456" height="177" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/3-5371ca8fbd7df2762eb40b0c8d3d1bb8.png" width="1217" height="225" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/4-a9b194e89fb5539b23ce023c78321419.png" width="1222" height="327" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="开启server开启后用户就可以登录了">开启server,开启后,用户就可以登录了<a class="hash-link" href="#开启server开启后用户就可以登录了" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/5-b06d89543ba318180e4de3c759d34df7.png" width="1225" height="242" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="进入终端分别安装condapip安装包给所有用户">进入终端,分别安装conda/pip安装包给所有用户<a class="hash-link" href="#进入终端分别安装condapip安装包给所有用户" title="Direct link to heading">​</a></h2><p>管理员admin能够使用命令 sudo -E 对整个环境安装工具包</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">E conda install </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">c conda</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">forge gdal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/6-a111e80c2453abf4f9c076bcc23ebab3.png" width="788" height="326" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/7-2f02b9c0307f2cdc3040d5ee86fb3402.png" width="1121" height="393" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/8-9dbeb05a77f7129b34c1939fb6cd821a.png" width="792" height="424" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/9-5a8aec8ca00c74f3193ec5671d1b7499.png" width="941" height="291" class="img_ev3q"></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">E pip install there</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/10-57588494476116e618974c9c7029b08d.png" width="938" height="248" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试创建文件">测试创建文件<a class="hash-link" href="#测试创建文件" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/11-37da9689a88f52d18dcdc8dbfe6dc52f.png" width="970" height="280" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试新用户登录">测试新用户登录<a class="hash-link" href="#测试新用户登录" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/12-c3a1bf3fa5e5ecf90b0e0b75fb3293e9.png" width="1180" height="680" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/13-2122145118c825cc39b022f65df97bc3.png" width="1216" height="169" class="img_ev3q"></p><h1>成功啦!!!</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="好啦现在要你有了硬核了但是要有软东西啦package要安装对不对啊">好啦,现在要你有了硬核了,但是要有软东西啦,package要安装,对不对啊<a class="hash-link" href="#好啦现在要你有了硬核了但是要有软东西啦package要安装对不对啊" title="Direct link to heading">​</a></h2><p>比如安装 <a href="http://tljh.jupyter.org/en/latest/install/google.html" target="_blank" rel="noopener noreferrer">conda, pip 或者apt package</a>嘛</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="去到jupyter-terminal所有package都在jupyter-terminal安装哦">去到jupyter terminal,所有package都在jupyter terminal安装哦<a class="hash-link" href="#去到jupyter-terminal所有package都在jupyter-terminal安装哦" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo -E conda install -c conda-forge gdal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -E pip install there</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install jupyter_contrib_nbextensions --user #用做jupyter自动提示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jupyter contrib nbextension install --user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install --user jupyter_nbextensions_configurator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jupyter nbextensions_configurator enable --user</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://blog.csdn.net/mengfei2656/article/details/89287140" target="_blank" rel="noopener noreferrer">jupyter 代码提示自动补全参考链接</a>
这里要敲黑板啦,想安装更多pip , apt packages和权限进入不再jupyter Hub用户环境的设置等,请看<a href="http://tljh.jupyter.org/en/latest/howto/env/user-environment.html#howto-env-user-environment" target="_blank" rel="noopener noreferrer">官网文档</a></p><p>引用官网一段文字:
Accessing user environment outside JupyterHub
We add /opt/tljh/user/bin to the $PATH environment variable for all JupyterHub users, so everything installed in the user environment is available to them automatically. If you are using ssh to access your server instead, you can get access to the same environment with:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=/opt/tljh/user/bin:${PATH}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>git</category>
            <category>lfs</category>
            <category>github</category>
        </item>
        <item>
            <title><![CDATA[dataflow sql]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/使用Dataflow SQL界面运行Dataflow作业</link>
            <guid>/2020/4/11/使用Dataflow SQL界面运行Dataflow作业</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[总体流程]]></description>
            <content:encoded><![CDATA[<p><a href="https://www.youtube.com/watch?v=GBNBnobxsiI" target="_blank" rel="noopener noreferrer">总体流程</a></p><h1>选择项目</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set project query-11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>启用API</h1><p>启用 Cloud Dataflow, Compute Engine, Stackdriver Logging, Cloud Storage, Cloud Storage JSON, BigQuery, Cloud Pub/Sub, and Cloud Resource Manager API。</p><p>具体流程可查看<a href="https://cloud.google.com/dataflow/docs/guides/sql/dataflow-sql-ui-walkthrough" target="_blank" rel="noopener noreferrer">Dataflow SQL 界面</a></p><h1>创建Pub/Sub主题和发布脚步</h1><p>(1)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud pubsub topics create transactions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(2)
创建python文件, transactions_injector.py,内容为一下</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import datetime, json, os, random, time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the `project` variable to a Google Cloud project ID.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project = 'query-11'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FIRST_NAMES = ['Monet', 'Julia', 'Angelique', 'Stephane', 'Allan', 'Ulrike', 'Vella', 'Melia',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'Noel', 'Terrence', 'Leigh', 'Rubin', 'Tanja', 'Shirlene', 'Deidre', 'Dorthy', 'Leighann',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'Mamie', 'Gabriella', 'Tanika', 'Kennith', 'Merilyn', 'Tonda', 'Adolfo', 'Von', 'Agnus',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'Kieth', 'Lisette', 'Hui', 'Lilliana',]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CITIES = ['Washington', 'Springfield', 'Franklin', 'Greenville', 'Bristol', 'Fairview', 'Salem',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'Madison', 'Georgetown', 'Arlington', 'Ashland',]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STATES = ['MO','SC','IN','CA','IA','DE','ID','AK','NE','VA','PR','IL','ND','OK','VT','DC','CO','MS',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'CT','ME','MN','NV','HI','MT','PA','SD','WA','NJ','NC','WV','AL','AR','FL','NM','KY','GA','MA',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'KS','VI','MI','UT','AZ','WI','RI','NY','TN','OH','TX','AS','MD','OR','MP','LA','WY','GU','NH']</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRODUCTS = ['Product 2', 'Product 2 XL', 'Product 3', 'Product 3 XL', 'Product 4', 'Product 4 XL', 'Product 5',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">'Product 5 XL',]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while True:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    first_name, last_name = random.sample(FIRST_NAMES, 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'tr_time_str': datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'first_name': first_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'last_name': last_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'city': random.choice(CITIES),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'state':random.choice(STATES),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'product': random.choice(PRODUCTS),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'amount': float(random.randrange(50000, 70000)) / 100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message = json.dumps(data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command = "gcloud --project={} pubsub topics publish transactions --message='{}'".format(project, message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(command)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os.system(command)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time.sleep(random.randrange(1, 5))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="python脚本下的pubsub的主要命令有">python脚本下的PubSub的主要命令有:<a class="hash-link" href="#python脚本下的pubsub的主要命令有" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud pubsub topics create transactions 创建 topics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud --project=project_id pubsub topics publish transactions(topic名字) --message=(json格式的data,最后用json.dump(data))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command = "gcloud --project={} pubsub topics publish transactions --message='{}'".format(project, message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os.system(command)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>创建数据集和表</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq mk dataflow_sql_dataset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>创建一个us_state_salesregions.csv文件,把以下数据复制到csv文件</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">state_id,state_code,state_name,sales_region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1,MO,Missouri,Region_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2,SC,South Carolina,Region_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3,IN,Indiana,Region_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6,DE,Delaware,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">15,VT,Vermont,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16,DC,District of Columbia,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19,CT,Connecticut,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20,ME,Maine,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">35,PA,Pennsylvania,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">38,NJ,New Jersey,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">47,MA,Massachusetts,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">54,RI,Rhode Island,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55,NY,New York,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">60,MD,Maryland,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">66,NH,New Hampshire,Region_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4,CA,California,Region_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8,AK,Alaska,Region_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">37,WA,Washington,Region_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">61,OR,Oregon,Region_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33,HI,Hawaii,Region_4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">59,AS,American Samoa,Region_4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">65,GU,Guam,Region_4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5,IA,Iowa,Region_5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32,NV,Nevada,Region_5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11,PR,Puerto Rico,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17,CO,Colorado,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18,MS,Mississippi,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">41,AL,Alabama,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">42,AR,Arkansas,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">43,FL,Florida,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">44,NM,New Mexico,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">46,GA,Georgia,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">48,KS,Kansas,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">52,AZ,Arizona,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">56,TN,Tennessee,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">58,TX,Texas,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">63,LA,Louisiana,Region_6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7,ID,Idaho,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12,IL,Illinois,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13,ND,North Dakota,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">31,MN,Minnesota,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">34,MT,Montana,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">36,SD,South Dakota,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">50,MI,Michigan,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">51,UT,Utah,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64,WY,Wyoming,Region_7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9,NE,Nebraska,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10,VA,Virginia,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14,OK,Oklahoma,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">39,NC,North Carolina,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">40,WV,West Virginia,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">45,KY,Kentucky,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">53,WI,Wisconsin,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">57,OH,Ohio,Region_8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">49,VI,United States Virgin Islands,Region_9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">62,MP,Commonwealth of the Northern Mariana Islands,Region_9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建表</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bq load --autodetect --source_format=CSV dataflow_sql_dataset.us_state_salesregions us_state_salesregions.csv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查找 Pub/Sub 来源</h1><p>首先把dataset设置成Gloud dataflow engine</p><p>然后再点击添加数据下拉列表，然后选择 Cloud Dataflow 来源</p><p>在右侧打开的添加 Cloud Dataflow 来源面板中，选择 Pub/Sub 主题。在搜索框中，搜索 transactions。 选择相应主题，然后点击添加。</p><p>在Cloud dataflow sources的 cloud pub/sub topics下选择transactions &gt;&gt; 去到Schema &gt;&gt; edit schema,
然后输入一下schema格式</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "Pub/Sub event timestamp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "event_timestamp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "mode": "REQUIRED",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "TIMESTAMP"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "Transaction time string",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "tr_time_str",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "STRING"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "First name",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "first_name",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "STRING"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "Last name",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "last_name",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "STRING"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "City",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "city",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "STRING"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "State",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "state",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "STRING"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "Product",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "product",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "STRING"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "description": "Amount of transaction",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "name": "amount",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "type": "FLOAT64"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>运行python脚本,这样我们就开始不停发送数据</h1><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python transactions_injector.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>创建SQL查询</h1><p>创建SQL查询来运行Dataflow jobs
我们这里例子是添加一个处理PubSub发送的字段再添加一个字段</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT tr.*, sr.sales_region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM pubsub.topic.`project-id`.transactions as tr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  INNER JOIN bigquery.table.`project-id`.dataflow_sql_dataset.us_state_salesregions AS sr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ON tr.state = sr.state_code</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>我们设置好查询后就可以开始创建job了</h1><p>1 在Query editor下面,选择Create Dataflow job (这个按钮只有在设置好query后才能生效)</p><p>2 点击进去后,我们填写job name, Primary ouput(选择Bigquery), Project, Dataset id和填写table name (自己命名)</p><p>3 write disposition中 选择write if empty</p><p>4 点击create</p><h1>这样job就开启了</h1><p>大概5分钟job应该差不多开启了,我们可以去dataflow查看job的运行情况,同时我们也可以去bigquery查看我们的table是否创立成功和数据有没有更新</p>]]></content:encoded>
            <category>dataflow</category>
            <category>GCP</category>
            <category>apache beam</category>
            <category>sql</category>
        </item>
        <item>
            <title><![CDATA[mac安装spark+jupyter+annocade+pycharm配置]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/11/安装spark</link>
            <guid>/2020/4/11/安装spark</guid>
            <pubDate>Sat, 11 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Spark的安装大多比较麻烦，而Mac安装Spark非常简单，本文分三部分内容。]]></description>
            <content:encoded><![CDATA[<p>Spark的安装大多比较麻烦，而Mac安装Spark非常简单，本文分三部分内容。</p><ol><li>安装JDK</li><li>安装Spark</li><li>简单测试<!-- -->这里具体可以参考链接</li></ol><p><a href="https://blog.csdn.net/a595130080/article/details/53350076?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener noreferrer">安装JDK</a></p><p>我的u盘有 JDK + annocada + spark,所以直接pass下载安装步骤啦(如图显示),双击点击JDK,Anaconda3安装就可以了,spark-3.0.0-preview2-bin-hadoop2.7就是spark,直接跳到测试阶段</p><p><img loading="lazy" alt="png" src="/assets/images/1-c1328019dddcac2544bc356ea62d808c.png" width="721" height="210" class="img_ev3q"></p><p>打开终端,切换到spark的路径(spark-3.0.0-preview2-bin-hadoop2.7):
然后输入</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./sbin/start-master.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后再(http://localhost:8080),就可以看到效果:
<img loading="lazy" alt="png" src="/assets/images/2-99aeb5f6556f3c130dd02a3d9d31c11c.png" width="865" height="361" class="img_ev3q"></p><p>表示安装成功了</p><p>然后在一个新的终端,进入同样的spark路径,然后输入</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./bin/spark-class org.apache.spark.deploy.worker.Worker spark://IP:PORT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里的spark://IP:PORT修改成图片上的URL,如: ./bin/spark-class org.apache.spark.deploy.worker.Worker
spark://chenbindeMacBook-Pro.local:7077</p><p>这样我们就开启了一个新的worker</p><p>然后我们在终端command+c就可以关掉worker</p><p>最后是关掉主机,在终端输入</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./sbin/stop-master.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个是简单版的</p><h1>二 Anocada+jupyter+spark</h1><p>我们安装好spark,jdk后,我们还要安装Anocada,我的文件里面也有,直接双击安装就可以了</p><p>1 我们切换到主目录</p><p>2 #打开bash_profile</p><p>3 设置anaconda和spark路径, 注意!!!这里spark_path路径是spark的具体路径</p><p>4 使命令立刻生效</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open .bash_profile  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH="/Applications/anaconda3/bin:$PATH"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export SPARK_PATH="/Users/flybird/Desktop/spark/spark-3.0.0-preview2-bin-hadoop2.7"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$SPARK_PATH/bin:$PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source .bash_profile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装pyspark这一步很重要哦">安装pyspark,这一步很重要哦<a class="hash-link" href="#安装pyspark这一步很重要哦" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo pip install pyspark -i https://pypi.douban.com/simple/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="在jupyter-notebook里运行pyspark-配置pyspark-driver">在Jupyter Notebook里运行PySpark, 配置PySpark driver<a class="hash-link" href="#在jupyter-notebook里运行pyspark-配置pyspark-driver" title="Direct link to heading">​</a></h2><p>详细教程可以看<a href="https://blog.csdn.net/a1272899331/article/details/90081945?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase" target="_blank" rel="noopener noreferrer">这里url链接</a>
配置PySpark driver，当运行pyspark命令就直接自动打开一个Jupyter Notebook，此时shell端不会打开,具体配置步骤:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo vim ~/.bashrc 在这个文件添加配置PySpark driver的环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PYSPARK_DRIVER_PYTHON=jupyter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PYSPARK_DRIVER_PYTHON_OPTS='notebook'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.bashrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后重启terminal</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动jupyter-notebook3">启动jupyter notebook3<a class="hash-link" href="#启动jupyter-notebook3" title="Direct link to heading">​</a></h2><p>启动后,我们在jupyter notebook上创建python文件
然后输入以下命令
<img loading="lazy" alt="png" src="/assets/images/3-2bc6c2c1ef46b19859a4a7549b4f03f3.png" width="1182" height="511" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spark_path = os.environ.get('SPARK_PATH', None)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys.path.insert(0, os.path.join(spark_path, 'python/lib/py4j-0.10.8.1-src.zip'))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec(open(os.path.join(spark_path, 'python/pyspark/shell.py')).read())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/4-237e68606982115711932d9ff0981ad9.png" width="670" height="207" class="img_ev3q"></p><p>py4j-0.10.8.1-src.zip需要根据实际名称修改,如果是用我的包,就不用改,如果是用spark官网下载的,就需要对应的zip文件名字</p><p>输入命令后的效果如下, 然后输入sc,查看相应的输出:
<img loading="lazy" alt="png" src="/assets/images/7-140b66d97a38a2f21ac2c92bf66c78b0.png" width="894" height="512" class="img_ev3q"></p><p>可以用command来试试一下命令</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import pyspark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import random</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sc = pyspark.SparkContext(appName="Pi")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">num_samples = 100000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def inside(p):     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x, y = random.random(), random.random()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return x*x + y*y &lt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">count = sc.parallelize(range(0, num_samples)).filter(inside).count()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pi = 4 * count / num_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(pi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sc.stop()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果发现出现</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Unsupported class file major version 57</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>就是jdk版本问题,去到终端</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -version #查看版本 java version "13.0.2" 2020-01-14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /Library/Java/JavaVirtualMachines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rm -rf jdk-13.0.2.jdk #删除java version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装JDK（jdk-8u251），<a href="https://www.oracle.com/java/technologies/javase-jdk8-downloads.html" target="_blank" rel="noopener noreferrer">下载jdk-8u251-macosx-x64.dmg</a></p><p>然后再回到jupyter notebook,重新输入命令,查看是否成功
<img loading="lazy" alt="png" src="/assets/images/8-54a678d7ad9a73536c2df9ef43c6fd0c.png" width="1101" height="572" class="img_ev3q"></p><h1>Pycharm设置啦</h1><p>Pycharm这里具体可以<a href="https://www.jianshu.com/p/22426c490066" target="_blank" rel="noopener noreferrer">参考一下文章</a>
配置原因：在pyspark命令行 练习比较麻烦，不能自动补全，浪费时间。Jupyter notebook 是最理想的，但是还没配置成功。</p><p>1.打开pycharm，新建一个工程</p><p>2.点击 run --Edit Configuration..
<img loading="lazy" alt="png" src="/assets/images/9-02ec752cc7060fefa5129c4ccd159129.png" width="960" height="720" class="img_ev3q"></p><p>3.配置</p><p>3.1 新建 Python ，起个名</p><p>3.2 配置script，指向你要引用 spark 的那个文件</p><p>3.3 Enviroment variables：
<img loading="lazy" alt="png" src="/assets/images/10-ecb561ed7a0ca8701278232756f4ca9e.png" width="1070" height="673" class="img_ev3q">
可以直接在Enviroment variables上输入:
PYTHONUNBUFFERED=1;SPARK_HOME=/Users/flybird/Desktop/spark/spark-3.0.0-preview2-bin-hadoop2.7;PYTHONPATH=/Users/flybird/Desktop/spark/spark-3.0.0-preview2-bin-hadoop2.7/python;PYSPARK_PYTHON=/Users/flybird/opt/anaconda3/bin/python3</p><p>PYSPARK_PYTHON; 指向 你本机 的 python 路径, (可以去终端输入which python 来找到路径)</p><p>SPARK_HOME ：指向 spark 安装目录(就是spark-3.0.0-preview2-bin-hadoop2.7的绝对路径)</p><p>PYTHONPATH：指向 spark 安装目录的 Python 文件夹(就是spark-3.0.0-preview2-bin-hadoop2.7的python文件夹的绝对路径)</p><p>4 安装 py4j
sudo pip3 install py4j</p><p>5.看到网上很多教程，一般都只执行到第四步即可，但是我仍然无法导入 pyspark 包，还需要下面的步骤：</p><p>选择 File---&gt;setting---&gt;你的project---&gt;project structure
右上角Add content root添加：py4j-some-version.zip和pyspark.zip的路径（这两个文件都在Spark中的python文件夹下）
<img loading="lazy" alt="png" src="/assets/images/10-ecb561ed7a0ca8701278232756f4ca9e.png" width="1070" height="673" class="img_ev3q"></p><p>这里我们可以去到spark中的python文件夹(spark-3.0.0-preview2-bin-hadoop2.7/python),然后查找zip!,然后看到选择添加就可以了</p><p>6 测试程序
用之前的代码再次测试,一样可以了</p>]]></content:encoded>
            <category>spark</category>
            <category>jupyter</category>
            <category>pycharm</category>
            <category>java</category>
        </item>
        <item>
            <title><![CDATA[tf_serving部署+遇到的问题]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/05/tf_serving</link>
            <guid>/2020/4/05/tf_serving</guid>
            <pubDate>Sun, 05 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[参考过的博客]]></description>
            <content:encoded><![CDATA[<p><a href="https://blog.csdn.net/u011734144/article/details/82107610?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1" target="_blank" rel="noopener noreferrer">参考过的博客</a></p><p><a href="https://www.cnblogs.com/zhzhlong/p/9465571.html" target="_blank" rel="noopener noreferrer">Mac下docker保存路径</a></p><h1>tf_serving 部署</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-模型构建与训练">Step1: 模型构建与训练<a class="hash-link" href="#step1-模型构建与训练" title="Direct link to heading">​</a></h2><p>我们通过模型构建与训练后,我们可以得到模型(cnn_model.h5)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型结构打印">模型结构打印<a class="hash-link" href="#模型结构打印" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plot_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> show_shapes</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> show_layer_names</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/output_11_0-3258c1815a39b2691616ca8671e9baa5.png" width="1752" height="611" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-模型的导出与检查">Step2: 模型的导出与检查<a class="hash-link" href="#step2-模型的导出与检查" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型导出">模型导出<a class="hash-link" href="#模型导出" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tensorflow </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> shutil </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./cnn_model.h5'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  指定路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./Models/CNN/1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     shutil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rmtree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./Models/CNN/1'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./Models/CNN/1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 导出tensorflow模型以便部署</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">saved_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">export_path</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/5-27a6e3a676b3b887e3e1a34d75d54c13.png" width="568" height="254" class="img_ev3q"> </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型的部署前检查与测试">模型的部署前检查与测试<a class="hash-link" href="#模型的部署前检查与测试" title="Direct link to heading">​</a></h3><p>tensorflow官方提供了非常好的一些工具给大家，比如在实际部署服务之前，我想强调一下TensorFlow的SavedModel命令行工具，这对于快速检查我们模型的输入和输出规范很有用，我们用下面的命令检查一下我们的CNN模型：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ saved_model_cli show --dir ./Models/CNN/1 --all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们会看到以下输出信息:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MetaGraphDef with tag-set: </span><span class="token string" style="color:#e3116c">'serve'</span><span class="token plain"> contains the following SignatureDefs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signature_def</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'__saved_model_init_op'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  The given SavedModel SignatureDef contains the following input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  The given SavedModel SignatureDef contains the following output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'__saved_model_init_op'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> tensor_info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dtype: DT_INVALID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shape: unknown_rank</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: NoOp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Method name is: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signature_def</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'serving_default'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  The given SavedModel SignatureDef contains the following input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'input_1'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> tensor_info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dtype: DT_FLOAT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shape: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">-1, </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: serving_default_input_1:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  The given SavedModel SignatureDef contains the following output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'dense'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> tensor_info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dtype: DT_FLOAT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shape: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">-1, </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: StatefulPartitionedCall:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Method name is: tensorflow/serving/predict</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们还可以随机送一些符合输入维度要求的数据给模型，看看输出结果的形态。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ saved_model_cli run --dir ./Models/CNN/1 --tag_set serve --signature_def serving_default --input_exp </span><span class="token string" style="color:#e3116c">'input_1=np.random.rand(1,100)'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>大家将看到以下输出：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">serve --signature_def serving_default --input_exp </span><span class="token string" style="color:#e3116c">'input_1=np.random.rand(1,100)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2019</span><span class="token plain">-06-13 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:33:46.095550: I tensorflow/core/platform/cpu_feature_guard.cc:142</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: Logging before flag parsing goes to stderr.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W0613 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:33:46.095993 </span><span class="token number" style="color:#36acaa">140736529130432</span><span class="token plain"> deprecation.py:323</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> From /usr/local/lib/python3.6/site-packages/tensorflow/python/tools/saved_model_cli.py:339: load </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from tensorflow.python.saved_model.loader_impl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> is deprecated and will be removed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> a future version.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Instructions </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> updating:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> will only be available through the v1 compatibility library as tf.compat.v1.saved_model.loader.load or tf.compat.v1.saved_model.load. There will be a new </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> importing SavedModels </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> Tensorflow </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">W0613 </span><span class="token number" style="color:#36acaa">16</span><span class="token plain">:33:46.141968 </span><span class="token number" style="color:#36acaa">140736529130432</span><span class="token plain"> deprecation.py:323</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> From /usr/local/lib/python3.6/site-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from tensorflow.python.training.checkpoint_management</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> is deprecated and will be removed </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> a future version.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Instructions </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> updating:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Use standard </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> APIs to check </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> files with this prefix.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Result </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> output key dense:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.14112209</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.22561029</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.2605021</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0.22022876</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.15253687</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这表明我们随机输入长度为100的文本序列(词id)给模型，得到了长度为5的概率向量，分别表示5个类别的概率。到此为止，我们的模型一切正常。</p><h1>模型部署与服务构建介绍</h1><p>模型部署部分，强大的google生态下，已经有完整的部署方案，部署工具可以直接使用google的tensorflow-model-server。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tensorflow-model-server安装最简单就是用docker来用tf-serving">tensorflow-model-server安装(最简单就是用docker来用tf serving)<a class="hash-link" href="#tensorflow-model-server安装最简单就是用docker来用tf-serving" title="Direct link to heading">​</a></h3><p>我是使用docker来安装,方便简单，</p><p>如果是Ubuntu环境可以使用apt-get install安装，其他环境可以从源码编译，具体的内容大家可以参考：</p><ul><li><a href="https://www.tensorflow.org/tfx/serving/setup" target="_blank" rel="noopener noreferrer">tensorflow官网安装指南</a></li><li><a href="https://blog.51cto.com/aaronsa/2284396" target="_blank" rel="noopener noreferrer">Ubuntu安装指南</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="关于tensorflow-serving介绍">关于tensorflow serving介绍<a class="hash-link" href="#关于tensorflow-serving介绍" title="Direct link to heading">​</a></h3><p>大家习惯使用TensorFlow进行模型的训练、验证和预测，但模型完善之后的生产上线流程，就变得五花八门了。针对这种情况Google提供了TensorFlow Servering，可以将训练好的模型直接上线并提供服务。早在2017年的TensorFlow开发者Summit上就提出了TensorFlow Serving。
但那时候客户端和服务端的通信只支持gRPC。在实际的生产环境中比较广泛使用的C/S通信手段是基于RESTfull API的，幸运的是从TF1.8以后，TF Serving也正式支持RESTfull API通信方式了。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="服务框架">服务框架<a class="hash-link" href="#服务框架" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="img" src="/assets/images/tf1-c15708706545c1baf744d6f721417fce.png" width="483" height="586" class="img_ev3q"></p><p>TF Serving服务框架</p><p>基于TF Serving的持续集成框架还是挺简明的，基本分三个步骤：</p><ul><li>模型训练
这是大家最熟悉的部分，主要包括数据的收集和清洗、模型的训练、评测和优化；</li><li>模型上线
前一个步骤训练好的模型在TF Server中上线；</li><li>服务使用
客户端通过gRPC和RESTfull API两种方式同TF Servering端进行通信，并获取服务；</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tf-serving工作流程">TF Serving工作流程<a class="hash-link" href="#tf-serving工作流程" title="Direct link to heading">​</a></h4><p><img loading="lazy" alt="img" src="/assets/images/tf2-bf82217f715c0b5ac1172f9c7372cd3b.png" width="849" height="437" class="img_ev3q"></p><p>TF Serving工作流程</p><p>TF Serving的工作流程主要分为以下几个步骤：</p><ul><li>Source会针对需要进行加载的模型创建一个Loader，Loader中会包含要加载模型的全部信息；</li><li>Source通知Manager有新的模型需要进行加载；</li><li>Manager通过版本管理策略（Version Policy）来确定哪些模型需要被下架，哪些模型需要被加载；</li><li>Manger在确认需要加载的模型符合加载策略，便通知Loader来加载最新的模型；</li><li>客户端像服务端请求模型结果时，可以指定模型的版本，也可以使用最新模型的结果；</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="简单示例">简单示例<a class="hash-link" href="#简单示例" title="Direct link to heading">​</a></h4><p>TF Serving客户端和服务端的通信方式有两种（gRPC和RESTfull API）</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例一restfull-api形式">示例（一）：RESTfull API形式<a class="hash-link" href="#示例一restfull-api形式" title="Direct link to heading">​</a></h5><ul><li><strong>1. 准备TF Serving的Docker环境</strong></li></ul><p>目前TF Serving有Docker、APT（二级制安装）和源码编译三种方式，但考虑实际的生产环境项目部署和简单性，推荐使用Docker方式。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull tensorflow/serving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>2. 下载官方示例代码</strong></li></ul><p>示例代码中包含已训练好的模型和与服务端进行通信的客户端（RESTfull API形式不需要专门的客户端）</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /tmp/tfserving</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /tmp/tfserving</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/tensorflow/serving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>3. 运行TF Serving</strong></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -p </span><span class="token number" style="color:#36acaa">8501</span><span class="token plain">:8501 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --mount </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bind,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token assign-left variable" style="color:#36acaa">source</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/tfserving/serving/tensorflow_serving/servables/tensorflow/testdata/saved_model_half_plus_two_cpu,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/models/half_plus_two </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-e </span><span class="token assign-left variable" style="color:#36acaa">MODEL_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">half_plus_two -t tensorflow/serving </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里需要注意的是，较早的docker版本没有“--mount”选项，比如Ubuntu16.04默认安装的docker就没有（我的环境是Ubuntu 18.04）。</p><ul><li><strong>4.客户端验证</strong></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">'{"instances": [1.0, 2.0, 5.0]}'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -X POST http://localhost:8501/v1/models/half_plus_two:predict </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>返回结果，</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"predictions"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2.5</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">3.0</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">4.5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例二grpc形式">示例（二）：gRPC形式<a class="hash-link" href="#示例二grpc形式" title="Direct link to heading">​</a></h5><ul><li><strong>1. 准备TF Serving的Docker环境</strong></li></ul><p>目前TF Serving有Docker、APT（二级制安装）和源码编译三种方式，但考虑实际的生产环境项目部署和简单性，推荐使用Docker方式。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull tensorflow/serving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>2. 下载官方示例代码</strong></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /tmp/tfserving</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /tmp/tfserving</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/tensorflow/serving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>3. 模型编译</strong></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python tensorflow_serving/example/mnist_saved_model.py models/mnist</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>4. 运行TF Serving</strong></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -p </span><span class="token number" style="color:#36acaa">8500</span><span class="token plain">:8500 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--mount </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bind,source</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">pwd</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/models/mnist,target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/models/mnist </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-e </span><span class="token assign-left variable" style="color:#36acaa">MODEL_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mnist -t tensorflow/serving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里需要注意的是，较早的docker版本没有“--mount”选项，比如Ubuntu16.04默认安装的docker就没有（这里的环境是Ubuntu 18.04）。</p><ul><li><strong>5.客户端验证</strong></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python tensorflow_serving/example/mnist_client.py --num_tests</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> --server</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:8500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>返回结果，</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Inference error rate: </span><span class="token number" style="color:#36acaa">11.13</span><span class="token plain">%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里需要注意的是，直接运行mnist_client.py会出现找不到“tensorflow_serving”的问题，需要手动安装，</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> tensorflow-serving-api</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="资料参考">资料参考<a class="hash-link" href="#资料参考" title="Direct link to heading">​</a></h4><p>TF Serving官方文档：<a href="https://www.tensorflow.org/tfx/guide/serving" target="_blank" rel="noopener noreferrer">https://www.tensorflow.org/tfx/guide/serving</a>
个人的项目是使用RESTfull API形式,感觉简单很多,不需要gRpc形式那样创建客户端和模型编译</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-具体实操-安装docker版的tensorflowserving">Step3: 具体实操, 安装Docker版的tensorflow/serving<a class="hash-link" href="#step3-具体实操-安装docker版的tensorflowserving" title="Direct link to heading">​</a></h2><p>目前TF Serving有Docker、APT（二级制安装）和源码编译三种方式，我使用Docker方式。</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull tensorflow</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">serving</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4模型部署">Step4:模型部署<a class="hash-link" href="#step4模型部署" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取当前绝对路径">获取当前绝对路径<a class="hash-link" href="#获取当前绝对路径" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 获取当前绝对路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MODEL_DIR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getcwd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">"/Models/RNN"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#指定绝对路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"MODEL_DIR"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MODEL_DIR </span><span class="token comment" style="color:#999988;font-style:italic">#设置全局变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MODEL_DIR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  打印绝对路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/Volumes/Untitled/NLP项目/docker部署/flask_news_classifier/Models/RNN</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step5-用docker启动tf-serving">Step5: 用Docker启动tf serving<a class="hash-link" href="#step5-用docker启动tf-serving" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="source这里一定要写绝对路径">source这里一定要写绝对路径<a class="hash-link" href="#source这里一定要写绝对路径" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="target这里要写models自定义名字比如rnn_serving">target这里要写/models/自定义名字(比如rnn_serving)<a class="hash-link" href="#target这里要写models自定义名字比如rnn_serving" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="model_name-和target的自定义名字一样">MODEL_NAME 和target的自定义名字一样<a class="hash-link" href="#model_name-和target的自定义名字一样" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%%bash --bg </span><span class="token comment" style="color:#999988;font-style:italic">##后台终端运行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -p </span><span class="token number" style="color:#36acaa">8501</span><span class="token plain">:8501 --mount </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bind,source</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">${MODEL_DIR}</span><span class="token string" style="color:#e3116c">"</span><span class="token plain">,target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/models/rnn_serving -e </span><span class="token assign-left variable" style="color:#36acaa">MODEL_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rnn_serving -t tensorflow/serving </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">server.log </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 写日记</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tail</span><span class="token plain"> server.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装 requests包,用来接收请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -q requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step6-检测模型是否部署到docker上进入终端">Step6: 检测模型是否部署到docker上,进入终端<a class="hash-link" href="#step6-检测模型是否部署到docker上进入终端" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="首先输入一下命令查看运行的容器名字或者id">首先输入一下命令,查看运行的容器名字或者id<a class="hash-link" href="#首先输入一下命令查看运行的容器名字或者id" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/2-03be4e2cacc49090a04019cf90688f5c.png" width="1122" height="44" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="然后进入运行的容器查看容器的models">然后进入运行的容器,查看容器的models<a class="hash-link" href="#然后进入运行的容器查看容器的models" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it 容器名字或者容器id /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it wonderful_meitner /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-b8ae577d08d68745e69e134272ab25e7.png" width="830" height="91" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="我们看到我们里面有文件夹rnn_serving这就是我们之前step2tensorflow模型导出的文件">我们看到我们里面有文件夹rnn_serving,这就是我们之前step2tensorflow模型导出的文件<a class="hash-link" href="#我们看到我们里面有文件夹rnn_serving这就是我们之前step2tensorflow模型导出的文件" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/4-efc4a7c7b5a66c04abcf1febe8e3be36.png" width="321" height="129" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试数据预处理">测试数据预处理<a class="hash-link" href="#测试数据预处理" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">preprocessing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> sequence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">callbacks </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> EarlyStopping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ModelCheckpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> to_categorical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> jieba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 路径等配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./processed_data"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vocab_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./vocab/vocab.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vocab_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 神经网络配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">embedding_dims </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'数据预处理与加载数据...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果不存在词汇表，重建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vocab_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_vocab</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vocab_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vocab_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 获得 词汇/类别 与id映射字典</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">categories</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cat_to_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> read_category</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">words</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word_to_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> read_vocab</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vocab_file</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">数据预处理与加载数据...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="字典数据转换成json格式使用request请求">字典数据转换成json格式,使用request请求<a class="hash-link" href="#字典数据转换成json格式使用request请求" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"杨幂好漂亮,发生原子弹"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jieba</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lcut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text_seg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encode_sentences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">jieba</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lcut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word_to_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pad_sequences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text_seg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxlen</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"signature_name"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"serving_default"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token string" style="color:#e3116c">"instances"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> text_input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tolist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"content-type"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"application/json"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">json_response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'http://localhost:8501/v1/models/rnn_serving:predict'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">['杨幂', '好', '漂亮', ',', '发生', '原子弹']</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="呈现出测试数据的类别">呈现出测试数据的类别<a class="hash-link" href="#呈现出测试数据的类别" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># print(json_response.text.split(':')[1].strip()[2:-9])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># print(json_response.text.split(':')[1].strip()[2:-9].split(','))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proba </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json_response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">':'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">','</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proba </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> proba</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proba</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">news_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'0'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'car'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'1'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'entertainment'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'2'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'military'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'3'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'sports'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'4'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'technology'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'News Type:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">news_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">proba</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{'predictions': [[0.00735603366, 0.974295, 0.00240160106, 0.00155786274, 0.0143894823]]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0.00735603366, 0.974295, 0.00240160106, 0.00155786274, 0.0143894823]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">News Type: entertainment</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>成功部署自己的模型到tf_serving啦</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="最重要是step5step5step5">最重要是step5!!!step5!!!step5!!!<a class="hash-link" href="#最重要是step5step5step5" title="Direct link to heading">​</a></h2>]]></content:encoded>
            <category>docker</category>
            <category>tf_serving</category>
            <category>model</category>
        </item>
        <item>
            <title><![CDATA[使用webscrapper爬取信息]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/04/webscrapper</link>
            <guid>/2020/4/04/webscrapper</guid>
            <pubDate>Sat, 04 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[step 1: 比如在一个网站搜索纸尿裤, 我们在google chrome的更多工具中点击开发者工具]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-比如在一个网站搜索纸尿裤-我们在google-chrome的更多工具中点击开发者工具">step 1: 比如在一个网站搜索纸尿裤, 我们在google chrome的更多工具中点击开发者工具<a class="hash-link" href="#step-1-比如在一个网站搜索纸尿裤-我们在google-chrome的更多工具中点击开发者工具" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-d0d205580edd02c1067e10b489ba3f4c.png" width="982" height="738" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2">step 2:<a class="hash-link" href="#step-2" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-选择web-scrapper">1 .选择web scrapper<a class="hash-link" href="#1-选择web-scrapper" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-选择create-new-sitemap">2 .选择create new sitemap<a class="hash-link" href="#2-选择create-new-sitemap" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-选择select-然后在商品页面选择能够覆盖商品所有信息的位置然后点击done-selecting-选择mulitple">3 .选择select, 然后在商品页面选择能够覆盖商品所有信息的位置,然后点击done selecting, 选择mulitple<a class="hash-link" href="#3-选择select-然后在商品页面选择能够覆盖商品所有信息的位置然后点击done-selecting-选择mulitple" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3">step3:<a class="hash-link" href="#step3" title="Direct link to heading">​</a></h2><p>done selecting后,你发现selector第四个字段是link_54224078139(这个是特点商品的编号),我们去除它,使他泛化,变成div.search_prolist_info</p><p><img loading="lazy" alt="png" src="/assets/images/2-affa1c44da7d9722003f4ca5468fcbb1.png" width="1394" height="707" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-点击save-selector用element-preview查看效果是否所有页面都包含">step4: 点击save selector,用element preview查看效果是否所有页面都包含<a class="hash-link" href="#step4-点击save-selector用element-preview查看效果是否所有页面都包含" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/3-eae0060f7f268d5bcbed4f47f7a4b96d.png" width="1090" height="704" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step5-点击item然后创建新的selector">step5: 点击item,然后创建新的selector<a class="hash-link" href="#step5-点击item然后创建新的selector" title="Direct link to heading">​</a></h2><p>流程基本一样,但是不选择multiple,然后评论字段的regex写<!-- -->[0-9]<!-- -->+</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step6-保存selector">step6: 保存selector<a class="hash-link" href="#step6-保存selector" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如果要怕所有页可以去sitemap下选择edit-metadata来设置">如果要怕所有页,可以去Sitemap下选择edit metadata来设置<a class="hash-link" href="#如果要怕所有页可以去sitemap下选择edit-metadata来设置" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/4-74a9ec4b153f005f840cce4baf38ae9b.png" width="1373" height="713" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step7-回到root然后选择sitemap的下拉菜单的scrape">step7: 回到root,然后选择sitemap的下拉菜单的Scrape<a class="hash-link" href="#step7-回到root然后选择sitemap的下拉菜单的scrape" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/5-ec09b75403158587d6a579f697077fd0.png" width="610" height="241" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step8-点击start-scraping">step8: 点击start scraping<a class="hash-link" href="#step8-点击start-scraping" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/6-5094e3b2eefc817ef6d8d5018297c1c1.png" width="412" height="224" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step9-sitemap选择browse可以查看所有data">step9: Sitemap选择browse,可以查看所有data<a class="hash-link" href="#step9-sitemap选择browse可以查看所有data" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/7-ad6d48421ad927c0ff7e860026c47c4c.png" width="719" height="254" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="选择sitemap导出csv文件">选择Sitemap,导出csv文件<a class="hash-link" href="#选择sitemap导出csv文件" title="Direct link to heading">​</a></h2>]]></content:encoded>
            <category>web</category>
            <category>scrapper</category>
            <category>shopping</category>
        </item>
        <item>
            <title><![CDATA[用faker模拟数据+随机种子]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/02/faker</link>
            <guid>/2020/4/02/faker</guid>
            <pubDate>Thu, 02 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Pretty printing has been turned OFF]]></description>
            <content:encoded><![CDATA[<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">%</span><span class="token plain">config ZMQInteractiveShell</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ast_node_interactivity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'all'</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">pprint</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Pretty printing has been turned OFF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="导入工具包">导入工具包<a class="hash-link" href="#导入工具包" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> faker </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Faker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建实例设置本地化">创建实例,设置本地化<a class="hash-link" href="#创建实例设置本地化" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fake </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Faker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'zh_CN'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建模拟个人数据函数设定随机种子">创建模拟个人数据函数,设定随机种子<a class="hash-link" href="#创建模拟个人数据函数设定随机种子" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">length</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">company</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">company</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">job</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">birthday</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">date_of_birth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minimum_age</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maximum_age</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                telephone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">phone_number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                address</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fake</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="生成客户模拟数据列表-用dataframe呈现">生成客户模拟数据列表, 用dataframe呈现<a class="hash-link" href="#生成客户模拟数据列表-用dataframe呈现" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">generate_user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/1-f9dfc6ebc9d5e154c2acc015c8f03f54.png" width="788" height="176" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证随机种子设定是否成功">验证随机种子设定是否成功<a class="hash-link" href="#验证随机种子设定是否成功" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">generate_user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/2-814ad9c8d421afad3941c181b7933844.png" width="827" height="261" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="导出数据生成csv文件">导出数据,生成csv文件<a class="hash-link" href="#导出数据生成csv文件" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./fakedata.csv'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>查看博客资料</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="资料索引">资料索引<a class="hash-link" href="#资料索引" title="Direct link to heading">​</a></h2><ol><li><p><a href="https://blog.csdn.net/u011054333/article/details/84203878" target="_blank" rel="noopener noreferrer">用faker模拟数据</a></p></li><li><p><a href="https://faker.readthedocs.io/en/master/locales/zh_CN.html" target="_blank" rel="noopener noreferrer">faker官网</a></p></li><li><p><a href="https://faker.readthedocs.io/en/master/providers.html" target="_blank" rel="noopener noreferrer">标准provides</a></p></li><li><p><a href="https://faker.readthedocs.io/en/master/communityproviders.html" target="_blank" rel="noopener noreferrer">第三方provides</a></p></li></ol><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>faker</category>
            <category>汇丰</category>
            <category>random seed</category>
        </item>
        <item>
            <title><![CDATA[轻松上传超过100M的文件至GitHub]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/4/02/git_big_file copy</link>
            <guid>/2020/4/02/git_big_file copy</guid>
            <pubDate>Thu, 02 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[GitHub有一个限制，不能上传超过100M的文件。想要上传超过100M的文件，就需要借助Git LFS]]></description>
            <content:encoded><![CDATA[<p>GitHub有一个限制，不能上传超过100M的文件。想要上传超过100M的文件，就需要借助Git LFS</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-安装lfs执行命令">step1: 安装LFS,执行命令<a class="hash-link" href="#step1-安装lfs执行命令" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew install git</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lfs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-进入仓库目录执行命令">step2: 进入仓库目录,执行命令<a class="hash-link" href="#step2-进入仓库目录执行命令" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git lfs track </span><span class="token string" style="color:#e3116c">"file"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git add </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gitattributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">m </span><span class="token string" style="color:#e3116c">"submit file"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u origin master </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>file是要上传的文件,一般执行完step2后,会生成".gitattributes"文件，文件内记录了我们要上传文件的信息。只有先把".gitattributes"传上去，才可以上传大文件。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-上传大文件">step3: 上传大文件<a class="hash-link" href="#step3-上传大文件" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git add </span><span class="token builtin">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">m </span><span class="token string" style="color:#e3116c">"add file"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u origin master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实战demo如下">实战demo如下:<a class="hash-link" href="#实战demo如下" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="切换到仓库目录是git-status查看状态">切换到仓库目录,是git status查看状态<a class="hash-link" href="#切换到仓库目录是git-status查看状态" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/1-f928a2e3891997db65badb9c27bf835d.png" width="652" height="157" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="执行刚才的所有命令">执行刚才的所有命令<a class="hash-link" href="#执行刚才的所有命令" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/2-a852e048deabcfdf6397d68bdcada79f.png" width="1145" height="419" class="img_ev3q">
我们发现上传失败,是因为connection失败了</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="我们尝试设置全球变量">我们尝试设置全球变量<a class="hash-link" href="#我们尝试设置全球变量" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git config </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token string" style="color:#e3116c">"name"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-b426fb736d6939eed2922b9e9b7af91d.png" width="655" height="199" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="重新执行push命令最后上传成功啦">重新执行push命令,最后上传成功啦<a class="hash-link" href="#重新执行push命令最后上传成功啦" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git push </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u origin master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>git</category>
            <category>lfs</category>
            <category>github</category>
        </item>
        <item>
            <title><![CDATA[快速按照工具包]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/31/douban</link>
            <guid>/2020/3/31/douban</guid>
            <pubDate>Tue, 31 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[安装google-cloud-bigquery and google-cloud-bigquery-storage packages.]]></description>
            <content:encoded><![CDATA[<p>安装google-cloud-bigquery and google-cloud-bigquery-storage packages.
需要认证</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-安装包很多时候很慢比如执行一下命令">step1 安装包很多时候很慢比如执行一下命令<a class="hash-link" href="#step1-安装包很多时候很慢比如执行一下命令" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade google-cloud-bigquery[bqstorage,pandas] </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-在命令后面加上">step2 在命令后面加上<a class="hash-link" href="#step2-在命令后面加上" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade google-cloud-bigquery[bqstorage,pandas] -i https://pypi.douban.com/simple</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下载瞬间快很多</p>]]></content:encoded>
            <category>python</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[Install the BigQuery Python client library version 1.9.0 or higher and the BigQuery Storage API Python client library.]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/30/BigQuery Storage API</link>
            <guid>/2020/3/30/BigQuery Storage API</guid>
            <pubDate>Mon, 30 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[安装google-cloud-bigquery and google-cloud-bigquery-storage packages.]]></description>
            <content:encoded><![CDATA[<p>安装google-cloud-bigquery and google-cloud-bigquery-storage packages.
需要认证</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-一般方法是复制以下命令在mac-os终端执行">step1 一般方法是复制以下命令在mac os终端执行<a class="hash-link" href="#step1-一般方法是复制以下命令在mac-os终端执行" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade google-cloud-bigquery[bqstorage,pandas]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-我们反向step1操作往往不成功会出现2">step2 我们反向step1操作,往往不成功会出现2<a class="hash-link" href="#step2-我们反向step1操作往往不成功会出现2" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/2-f7d74e8bb3230f12b6388901df2a2bd7.png" width="734" height="95" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-我们在命令行后面加上--user">step3 我们在命令行后面加上--user<a class="hash-link" href="#step3-我们在命令行后面加上--user" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install --upgrade google-cloud-bigquery[bqstorage,pandas] --user</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/1-ed71c9d8850a1ddede7893000cb44b53.png" width="1282" height="702" class="img_ev3q"></p><p>通过操作就成功了</p>]]></content:encoded>
            <category>python</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[本地连接google cloud shell]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/29/ssh_gcs</link>
            <guid>/2020/3/29/ssh_gcs</guid>
            <pubDate>Sun, 29 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[google cloud shell 经常断线,所以我们可以尝试用本地ssh连接google cloud shell]]></description>
            <content:encoded><![CDATA[<p>google cloud shell 经常断线,所以我们可以尝试用本地ssh连接google cloud shell</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1">step1<a class="hash-link" href="#step1" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud alpha cloud-shell ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/1-dd05be08c0b9773a7db7f57b5ea9d7cc.png" width="677" height="701" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-按照系统要求按照密钥">step2 按照系统要求按照密钥<a class="hash-link" href="#step2-按照系统要求按照密钥" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/2-5552e2acf0aea1148ec51648caebb22c.png" width="1077" height="497" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-连接成功">step3 连接成功<a class="hash-link" href="#step3-连接成功" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/3-667b9a49ce24eebc7cc4e855f0d5acdc.png" width="930" height="87" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-如果连接失败可能的原因是gcloud的设置">step4 如果连接失败,可能的原因是gcloud的设置<a class="hash-link" href="#step4-如果连接失败可能的原因是gcloud的设置" title="Direct link to heading">​</a></h2><p>1 我们可以重新安装SDK
2 对gcloud 初始化, 重新设置project, account
3 重新走step1</p><p>具体:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./google-cloud-sdk/install.sh #重新安装SKD后,重新开启终端</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud init 初始化 SDK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">To continue, you must log in. Would you like to log in (Y/n)? Y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pick cloud project to use:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [1] [my-project-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [2] [my-project-2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Please enter your numeric choice:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Which compute zone would you like to use as project default?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [1] [asia-east1-a]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [2] [asia-east1-b]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [14] Do not use default zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Please enter your numeric choice:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud has now been configured!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    You can use [gcloud config] to change more gcloud settings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Your active configuration is: [default]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set accessibility/screen_reader true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>python</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[App Engine 使用快速入门]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/28/App Engine</link>
            <guid>/2020/3/28/App Engine</guid>
            <pubDate>Sat, 28 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[step1: 创建自己的独立项目]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-创建自己的独立项目">step1: 创建自己的独立项目<a class="hash-link" href="#step1-创建自己的独立项目" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-2453e0842f2ebed803840783db61e724.png" width="1365" height="772" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-使用app-engine">step2: 使用App Engine<a class="hash-link" href="#step2-使用app-engine" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/2-dce48c12bdf2634c18f85917ed459397.png" width="859" height="678" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-使用app-engine的两个重要命令">step3: 使用App Engine的两个重要命令<a class="hash-link" href="#step3-使用app-engine的两个重要命令" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud init 初始化SDK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud app deploy 部署到App Engine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-797c35f567523285080b4ad67bebe1c5.png" width="991" height="437" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-按照需要-开启api">step4: 按照需要, 开启API<a class="hash-link" href="#step4-按照需要-开启api" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/4-0d78dc9c385fbe3a2195b53c0189050f.png" width="1474" height="723" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step5本地终端操作登录账号设置默认项目">step5:本地终端操作登录账号,设置默认项目<a class="hash-link" href="#step5本地终端操作登录账号设置默认项目" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/5-9ee27fe41e68073bdeac49a0253aedcb.png" width="1632" height="198" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/6-24e4d213eb480f63809571ce659c7baf.png" width="412" height="203" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/7-933977b085c881b1b68870332df095a4.png" width="918" height="330" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step6-下载项目或者本地项目">step6: 下载项目/或者本地项目<a class="hash-link" href="#step6-下载项目或者本地项目" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/8-ed74264c2c4047b16a939c0dbc8bbd7a.png" width="1437" height="627" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step7-使用step3的命令部署-点击得到的链接">step7: 使用step3的命令部署, 点击得到的链接<a class="hash-link" href="#step7-使用step3的命令部署-点击得到的链接" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud app deploy 部署</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud app browse 查看效果</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/13-109c95584b99397086570ca1aa56e402.png" width="717" height="423" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/9-6b2d8f060ea8a17475c3fbc19d659933.png" width="1440" height="900" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="备注-部署到app-engine的几个重要文件">备注: 部署到app engine的几个重要文件<a class="hash-link" href="#备注-部署到app-engine的几个重要文件" title="Direct link to heading">​</a></h2><p>1 app.yaml</p><p>2 requirements.text</p><p>3 main.py</p><p><img loading="lazy" alt="png" src="data:image/png;base64,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" width="365" height="219" class="img_ev3q">
<img loading="lazy" alt="png" src="/assets/images/11-1c66589b4b088eb97de2e9f8e135d9c0.png" width="665" height="348" class="img_ev3q">
<img loading="lazy" alt="png" src="data:image/png;base64,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" width="334" height="185" class="img_ev3q"></p>]]></content:encoded>
            <category>python</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[mysql基本命令]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/28/mysql</link>
            <guid>/2020/3/28/mysql</guid>
            <pubDate>Sat, 28 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[数据库操作]]></description>
            <content:encoded><![CDATA[<p>数据库操作
进入数据库 </p><p>方式1 mysql -u用户名 -p 密码 --------直接输入密码，缺点，会暴露自己的密码哦😝</p><p>方式2 mysql -u用户名 -p 回车后输入密码</p><p><img loading="lazy" alt="png" src="/assets/images/1-c7b8bf82bcbf95026048b0695c43b970.png" width="619" height="264" class="img_ev3q">　　</p><p>　　　　
主要内容：查询
1、查询当前所有的数据库 show databases;</p><p><img loading="lazy" alt="png" src="/assets/images/2-94459adaa77f7ac3a2ca4b00b83eecc0.png" width="277" height="169" class="img_ev3q"></p><p>2、使用数据库 use 数据库名字;</p><p>3、查看当前数据库版本 select version();</p><p><img loading="lazy" alt="png" src="/assets/images/3-f929abe0a2085df1308322bbfbbee814.png" width="499" height="182" class="img_ev3q"></p><p>4、 创建数据库 create database 数据库名；
　create database 数据库名 charset = utf8；
<img loading="lazy" alt="png" src="/assets/images/4-be78aef83cef0eb316161ac2f97d4482.png" width="430" height="258" class="img_ev3q"></p><p>5、查看当前使用数据库 select database();</p><p><img loading="lazy" alt="png" src="data:image/png;base64,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ZtCgQVHJacdbb71lzj///Khw/RGNQASJDfHyepfFJHzw4ME2zYH+x8Bz7bXXmhtuuMEMHDjQVKhQ4UA3wakvnW1p3769ueiii5y6Er0588wzzYABA+LOlmh95cuXt/gfc8wxcdeRioSlS5c23bp1M6tXr44q7rfffjPff/+96dGjh2MrikqgPywClrlhbGHyeFTyeNIE4ZvIGvoff/xh2Ap72223FSju8MMPN927dzclS5YsEBdvQFhbvHFhbXHX583njmOA8KMLL7zQnHrqqX5RaQkrTH28K8lQGC5BcbfeeqvZt2+fGTVqVIEqEThVqlQxl156aYE42njyyScXCM+1gAjACmMDCr/darkbkPvvv98sXrzYfPXVV2b06NHm008/NXPnzjVlypSxe9GJE2arXbu2WbJkiVUZKaN+/fpmypQpZu3atWbatGmmRo0aTtGoXvPmzbN72V9//XUza9YsJy7ohna2bNnSzJkzx7Ru3TqhETysLXXq1DFjxowx69ats32sXr16UBOiwsPynXfeeebVV181a9asMTNnzjRgA9WrV88sWrTInH322ea+++6z96SLhwSzL774wjRv3jwqS8OGDc2ECRPsc3r77bcdjSdWfUH5pPBnnnnGrFq1ynz00UeGtEJh+QqDNe8IzxcG99LXX39t+DvttNO8UaZv375m9uzZVusrEJlDAXaHmnvkxMAWJJlh3D179pjhw4ebBg0amCFDhphSpUqZc8891zL9UUcdZa688koL39VXX222b99uvvvuO/ubefuGDRvMJZdcYl/ypk2b2nDy9+zZ0yxYsMCqYKiA5cqVi/kIfvrpJ8scvLyPP/64mTx5smWSmBnzEwS1hbxPPPGE+fnnn83NN99sDj30UNumeMoMy4f6iOSHITdu3Gj69etni2RwbNeuncVj/Pjx9v6xxx6LWd3RRx9tMZs/f75hwK1WrVpUnrvvvtsOvG3btjWo0nfeeWdc9QXlk8J///13g0oPUzFNEgrLVxisK1WqZOuSerxX2lG5cmVvsPnxxx+dD6EKROZQQB7SWpa/kOB+8243HkjnSZMmmQ4dOpiXX37Zjo6oyDDb+++/b1q0aGHefPNN06RJE8v8knfHjh1WesM406dPNxMnTrRRSBM20MAcv/76q2Ge9fDDD0u20OuuXbtM7969rXHl3XffNUOHDjVIyVgU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" width="247" height="116" class="img_ev3q"></p><p>6 查看创建数据库 show create database 数据库名称;</p><p><img loading="lazy" alt="png" src="/assets/images/6-de6a3a4dd9cbd09f8ca41c2e72f34d76.png" width="878" height="132" class="img_ev3q"></p><p>7、删除数据库 drop database 数据库名称;</p><p><img loading="lazy" alt="png" src="/assets/images/7-b09efd8312c5993185e5e880f8462a1a.png" width="298" height="218" class="img_ev3q"></p><p>数据表的操作</p><p>1、查看当前数据库所有表 show tables;
2、创建表 creat table 表名（字段 类型 约束<!-- -->[字段 类型 约束]<!-- -->);
3、查看表结构 desc 表名；
4、查看创建表的语句 show create table 表名；
5、查看表数据 select * from 表名；
6、添加表的字段 alter table 表名 add 字段名 类型;
7、修改表结构字段类型 alter table 表名 modify 字段 目标类型
8、修改表的字段重命名版 alter table 表名 chang 字段原名 字段新名 目标类型 约束;
9、删除表字段 alter table 表名 drop 字段;
10、删除表 drop table 表名;</p><p>表内数据操作</p><p>增：</p><p>1、添加数据 ---插入数据 insert into 表名 values(需要插入的内容)；
可以分条插入，可以一次插入多条，每一条都是完整()
2、添加数据 ----部分插入 insert into 表名(字段1，字段2...) values (值1，值2,...)
可以分条插入，可以一次插入多条，每一条都是完整()
改：
1、改表里某字段里的值 update 表名 set 字段(列) = 值 (有时候报错要加"") 默认改所有人本字段的内容
update 表名 set 字段 = 值 where 条件 改符合条件的字段内容
2、update 和 alter 的区别 alter 是修改表结构(添加字段，删字段，修改字段名字) update 修改表里的数据</p><p>查：</p><p>1、查看表数据 select <em> from 表名；
2、给定条件的查询 select </em> from 表名 where 条件;
3、查询指定字段 select 字段名1,字段名2 from 表名；
字段顺序影响显示顺序
select 字段1 as 别名1,字段2 as 别名2 from 表名;
select 表名.字段1,表名.字段2 from 表名;
selcect 别名.字段1,别名.字段 from 表名 as 别名;
4、可以使用as指定表or列名 select 字段1 as指定名1,字段2 as 指定名2 from 表名 as 指定表名;
5、消除重复行 select distinct 字段名 from 表名;
6、条件查询
6.1 比较运算符 select * from 表名 where 条件语句
　　&lt;
　　&gt;
　　=
　　&lt;=</p><blockquote><p>=
!= -----不等于
6.2 逻辑运算符 select <em> from 表名 where 条件1 and 条件2;
select </em> from 表名 where 条件1 or 条件2；
select <em> from 表名 where not 条件；------ 条件可以是一个或多个
6.3 模糊查询
6.3.1like select </em> from 表名 where 字段 like “” -----一般查询字符串
%替换任意多个字符
<em>替换一个字符</em>
6.3.2 rlike select <em> from 表名 where 字段 rlike "^ .</em> $" ^字 ---以该字开始,.<em> --- 多个字符 字$----以字结尾
6.4 范围查询 select </em> from 表名 where 字段 in () -------非连续范围
select <em> from 表名 where 字段 not in () -------非连续范围
select </em> from 表名 where 字段 between 值1 and 值2； ------连续范围
select <em> from 表名 where 字段 not between 值1 and 值2;
6.5 空判断 select </em> from 表名 where 字段 is null; -----null 可以是NULL也可以是NuLL
select <em> from 表名 where 字段 is not null;
7、排序 select </em> from 表名 where 字段 条件(关系) order by 字段 asc (升序) desc (降序) 多个排序字段，只需
要写一个order by 之间用, 隔开，优先按照写在前面的字段排序。
8、聚合函数 select <em> from 表名 条件
例：select count(</em>) as 男生人数 from students where gender = 1;
在select 之后 from之前使用函数 ，用括号括住字段或者*，count---计算数量 max----计算最大值
min--- 计算最小值 sum ---求和 avg--- 求平均值 round(算数值，保留小数位数)
例：select round(avg(height), 2) from students where gender =1;</p></blockquote><p>9、分组 group by</p><p>6、表关联
6.1 外链接 基本格式： select <em> from 表名1，表名2 where 表名1.字段1 = 表名2.字段2 ;
6.2 内关联 基本格式： select </em> from 表名1 inner join 表名2 on 表名1.字段1 = 表名2.字段2</p><p>删：</p><p>物理删除 -------不推荐</p><p>1、删除表 drop table 表名; -----表结构一起删除
2、 delete from 表名; -----删除表内容，不删除表结构,记录主键的位置
delete from 表名 where ;例子：delect from students where name = '张三'
3、删除表 truncate 表名 ------清空表，不删表结构，主键位置从新开始</p><p>逻辑删除</p><p>用一个字段来记录是否这条信息是否以及不再使用了
添加一个字段 ,默认值为0 表示没有删除 使用1 表示已删除 alter table 表名 add is_delete bit default 0,
改记录中字段is_delete 的值为1，表示逻辑删除 update 表名 set is_delete =1 where name = ""</p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[python脚本基础(1)-python中os的常用方法]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/28/python</link>
            <guid>/2020/3/28/python</guid>
            <pubDate>Sat, 28 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[1.os模块：os模块在python中包含普遍的操作系统功能，下面列出了一些在os模块中比较有用的部分。]]></description>
            <content:encoded><![CDATA[<p>1.os模块：os模块在python中包含普遍的操作系统功能，下面列出了一些在os模块中比较有用的部分。</p><p>os.sep可以取代操作系统特定的路径分隔符。windows下为 “<!-- -->\<!-- -->”</p><p>os.name字符串指示你正在使用的平台。比如对于Windows，它是'nt'，而对于Linux/Unix用户，它是'posix'。</p><p>os.getcwd()函数得到当前工作目录，即当前Python脚本工作的目录路径。</p><p>os.getenv()获取一个环境变量，如果没有返回none</p><p>os.putenv(key, value)设置一个环境变量值</p><p>os.listdir(path)返回指定目录下的所有文件和目录名。</p><p>os.remove(path)函数用来删除一个文件。</p><p>os.system(command)函数用来运行shell命令。</p><p>os.linesep字符串给出当前平台使用的行终止符。例如，Windows使用'\r\n'，Linux使用'\n'而Mac使用'\r'。</p><p>os.curdir:返回当前目录（'.')
os.chdir(dirname):改变工作目录到dirname</p><p>========================================================================================</p><p>os.path常用方法：</p><p>os.getcwd() 获取当前工作目录，即当前python脚本工作的目录路径</p><p>os.chdir("dirname")  改变当前脚本工作目录；相当于shell下cd</p><p>os.curdir  返回当前目录: ('.')</p><p>os.pardir  获取当前目录的父目录字符串名：('..')</p><p>os.makedirs('dirname1/dirname2')    可生成多层递归目录</p><p>os.removedirs('dirname1')    若目录为空，则删除，并递归到上一级目录，如若也为空，则删除，依此类推</p><p>os.mkdir('dirname')    生成单级目录；相当于shell中mkdir dirname</p><p>os.rmdir('dirname')    删除单级空目录，若目录不为空则无法删除，报错；相当于shell中rmdir dirname</p><p>os.listdir('dirname')    列出指定目录下的所有文件和子目录，包括隐藏文件，并以列表方式打印</p><p>os.remove()  删除一个文件</p><p>os.rename("oldname","newname")  重命名文件/目录</p><p>os.stat('path/filename')  获取文件/目录信息</p><p>os.sep    输出操作系统特定的路径分隔符，win下为"<!-- -->\<!-- -->",Linux下为"/"</p><p>os.linesep    输出当前平台使用的行终止符，win下为"\t\n",Linux下为"\n"</p><p>os.pathsep    输出用于分割文件路径的字符串 win下为;,Linux下为:</p><p>os.name    输出字符串指示当前使用平台。win-&gt;'nt'; Linux-&gt;'posix'</p><p>os.system("bash command")  运行shell命令，直接显示</p><p>os.environ  获取系统环境变量</p><p>os.path.abspath(path)  返回path规范化的绝对路径</p><p>os.path.split(path)  将path分割成目录和文件名二元组返回</p><p>os.path.dirname(path)  返回path的目录。其实就是os.path.split(path)的第一个元素</p><p>os.path.basename(path)  返回path最后的文件名。如何path以／或\结尾，那么就会返回空值。即os.path.split(path)的第二个元素</p><p>os.path.exists(path)  如果path存在，返回True；如果path不存在，返回False</p><p>os.path.isabs(path)  如果path是绝对路径，返回True</p><p>os.path.isfile(path)  如果path是一个存在的文件，返回True。否则返回False</p><p>os.path.isdir(path)  如果path是一个存在的目录，则返回True。否则返回False</p><p>os.path.join(path1[, path2<!-- -->[, ...]<!-- -->])  将多个路径组合后返回，第一个绝对路径之前的参数将被忽略</p><p>os.path.getatime(path)  返回path所指向的文件或者目录的最后存取时间</p><p>os.path.getmtime(path)  返回path所指向的文件或者目录的最后修改时间</p><p>os.path.getsize(path) 返回path的大小</p><p>os.path.normpath(os.path.join(os.path.abspath(<strong>file</strong>),'..','..','..'))表示返回当前文件的上上上层目录</p>]]></content:encoded>
            <category>python</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[从Dockerhub拉取镜像并且使用命令运行]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/27/dockerhub_2</link>
            <guid>/2020/3/27/dockerhub_2</guid>
            <pubDate>Fri, 27 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[step1: 登录自己的dockerhub,选择需要拉下的镜像]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-登录自己的dockerhub选择需要拉下的镜像">step1: 登录自己的dockerhub,选择需要拉下的镜像<a class="hash-link" href="#step1-登录自己的dockerhub选择需要拉下的镜像" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/6-2b85a1dbc8d840ac7f2c5cee7d272565.png" width="1004" height="429" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-点击镜像点击public-view获取拉取命令">step2: 点击镜像,点击public view获取拉取命令<a class="hash-link" href="#step2-点击镜像点击public-view获取拉取命令" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/7-f889200a8f1380e36b3e60c1f3d38cb5.png" width="1263" height="291" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-复制获取拉取命令">step3: 复制获取拉取命令<a class="hash-link" href="#step3-复制获取拉取命令" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/8-149fef6cce0ffba6e80f2dc0e017774e.png" width="1258" height="454" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-在终端输入拉取命令">step4: 在终端输入拉取命令<a class="hash-link" href="#step4-在终端输入拉取命令" title="Direct link to heading">​</a></h2><p>1) 拉取镜像</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull 镜像名字</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2)查看镜像</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker images</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/9-c34c038fa3cddf4d4144a0c4dacb2d73.png" width="1157" height="395" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-运行镜像">step4: 运行镜像<a class="hash-link" href="#step4-运行镜像" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p </span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5000</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">tcp flybirdgroup</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">classifier</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/10-b6972d655c89b06018359fc79271a716.png" width="1482" height="633" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step5浏览器运行">step5:浏览器运行<a class="hash-link" href="#step5浏览器运行" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">在浏览器输入</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/11-814d92304c1f4977b7cb34217ef35362.png" width="694" height="377" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step6完美运行">step6:完美运行<a class="hash-link" href="#step6完美运行" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/12-460de44236b5acd045485c8aabe58d6a.png" width="661" height="315" class="img_ev3q"></p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[push镜像到自己的dockerhub]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/26/dockerhub</link>
            <guid>/2020/3/26/dockerhub</guid>
            <pubDate>Thu, 26 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[step1: 登录自己的dockerhub,点击create Repository]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-登录自己的dockerhub点击create-repository">step1: 登录自己的dockerhub,点击create Repository<a class="hash-link" href="#step1-登录自己的dockerhub点击create-repository" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/1-0230abb3b0b465d8a7fbecc5c2931698.png" width="953" height="411" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-创建仓库repository">step2: 创建仓库repository<a class="hash-link" href="#step2-创建仓库repository" title="Direct link to heading">​</a></h2><p>复制要保存的仓库名字和推送命令
<img loading="lazy" alt="png" src="/assets/images/2-c6248065ae59da33e345adcb81f01b7d.png" width="1261" height="186" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-查看本地仓库的镜像">step3: 查看本地仓库的镜像<a class="hash-link" href="#step3-查看本地仓库的镜像" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker images</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/3-fc1527f9c75b3535fc589810bd04d838.png" width="820" height="183" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4-查看本地仓库的镜像">step4: 查看本地仓库的镜像<a class="hash-link" href="#step4-查看本地仓库的镜像" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker tag 本地镜像名字 dockerhub仓库镜像名字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag quickstart</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">image flybirdgroup</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">helloworld</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">lastest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/4-6a59fb0ef2c685d24fc4aeabf29521e6.png" width="759" height="187" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step5-推送镜像到远程仓库">step5: 推送镜像到远程仓库<a class="hash-link" href="#step5-推送镜像到远程仓库" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker push flybirdgroup</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">helloworld</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">lastest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/5-60256e6f4b5dee4cf97cffb3e06adc91.png" width="674" height="203" class="img_ev3q"></p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>docker</category>
        </item>
        <item>
            <title><![CDATA[Create Virtual Linux by Google 创建linux虚拟机]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/21/createlinux</link>
            <guid>/2020/3/21/createlinux</guid>
            <pubDate>Sat, 21 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Learn how to build linux system in Google Cloud Platform Docusaurus 2 alpha.]]></description>
            <content:encoded><![CDATA[<p>Learn how to build linux system in Google Cloud Platform <a href="https://v2.docusaurus.io/" target="_blank" rel="noopener noreferrer"><strong>Docusaurus 2 alpha</strong></a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step1-去compute-engine创建虚拟机实例">step1: 去compute Engine创建虚拟机实例<a class="hash-link" href="#step1-去compute-engine创建虚拟机实例" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/linuxs_object-988b7c8ac9d87a82ca1ddf80a73cf09d.png" width="1457" height="679" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step2-创建实例">step2: 创建实例<a class="hash-link" href="#step2-创建实例" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/create_object-89252565cee7075207e419331d91cb47.png" width="821" height="193" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step3-给虚拟机配置">step3: 给虚拟机配置<a class="hash-link" href="#step3-给虚拟机配置" title="Direct link to heading">​</a></h2><img loading="lazy" src="../img/google/create_object_1.png" align="left" class="img_ev3q"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step4">step4:<a class="hash-link" href="#step4" title="Direct link to heading">​</a></h2><p>名称,区域,机器配置,类型都是按需设置, 磁盘选择Linux 9,防火墙选择http流量</p><p><img loading="lazy" alt="png" src="/assets/images/create_object_2-a6fb0ac843f05dcbac2445af28cd551f.png" width="557" height="565" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-5">step 5:<a class="hash-link" href="#step-5" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-我们可以看到有外部ip我们要记住">1) 我们可以看到有外部ip,我们要记住<a class="hash-link" href="#1-我们可以看到有外部ip我们要记住" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-我们可以直接选择在浏览器窗口中打开来进入虚拟机">2) 我们可以直接选择在浏览器窗口中打开,来进入虚拟机<a class="hash-link" href="#2-我们可以直接选择在浏览器窗口中打开来进入虚拟机" title="Direct link to heading">​</a></h3><img loading="lazy" src="../img/google/create_object_3.png" align="left" class="img_ev3q"><p><img loading="lazy" alt="png" src="/assets/images/virtual_linux-8fde26d07c3ac4eed441623aca31c7f3.png" width="899" height="277" class="img_ev3q"></p><h1>使用终端连接到虚拟linux</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-添加本地密钥到元数据中">step 6: 添加本地密钥到元数据中<a class="hash-link" href="#step-6-添加本地密钥到元数据中" title="Direct link to heading">​</a></h2><p>首先去元数据, 然后选择SSH密钥,点击修改按钮,添加本地的SSH密钥到框中
<img loading="lazy" alt="png" src="/assets/images/ssh-bf2746dba76e9a77e8b4b14fd4cab745.png" width="910" height="397" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-7-使用本地终端连接">step 7: 使用本地终端连接<a class="hash-link" href="#step-7-使用本地终端连接" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="png" src="/assets/images/linxus1-5fefd62fe5ef90c8eef0fb40988734fd.png" width="639" height="260" class="img_ev3q"></p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
            <category>google cloud</category>
            <category>linux</category>
        </item>
        <item>
            <title><![CDATA[双向注意力LSTM神经网络]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/19/attention</link>
            <guid>/2020/3/19/attention</guid>
            <pubDate>Thu, 19 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[原理讲解]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="原理讲解">原理讲解<a class="hash-link" href="#原理讲解" title="Direct link to heading">​</a></h2><p>TextAttBiRNN是在双向LSTM文本分类模型的基础上改进的，主要是引入了注意力机制（Attention）。对于双向LSTM编码得到的表征向量，模型能够通过注意力机制，关注与决策最相关的信息。其中注意力机制最先在论文 <a href="https://arxiv.org/pdf/1409.0473.pdf" target="_blank" rel="noopener noreferrer">Neural Machine Translation by Jointly Learning to Align and Translate</a> 中被提出，而此处对于注意力机制的实现参照了论文 <a href="https://arxiv.org/pdf/1512.08756.pdf" target="_blank" rel="noopener noreferrer">Feed-Forward Networks with Attention Can Solve Some Long-Term Memory Problems</a>。</p><p>注意力机制参考</p><ul><li><a href="https://zhuanlan.zhihu.com/p/37601161" target="_blank" rel="noopener noreferrer">深度学习中的注意力模型</a></li><li><a href="https://zhuanlan.zhihu.com/p/53036028" target="_blank" rel="noopener noreferrer">深度学习注意力机制</a></li></ul><p>请注意,这里的注意力机制与bert中transformer的注意力机制不同,transformer会更加复杂,大家可以参考我关于<a href="https://github.com/weijiang2009/URun.ResearchPrototype/tree/dev/People/Xiaoxian/NLP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/Transformer%E7%AC%94%E8%AE%B0" target="_blank" rel="noopener noreferrer">transformer</a></p><p>In the paper <a href="https://arxiv.org/pdf/1512.08756.pdf" target="_blank" rel="noopener noreferrer">Feed-Forward Networks with Attention Can Solve Some Long-Term Memory Problems</a>, the <strong>feed forward attention</strong> is simplified as follows,
<img loading="lazy" alt="png" src="/assets/images/FeedForwardAttention-c7c691aa52a21ef9b61f9a885f985240.png" width="1146" height="800" class="img_ev3q"></p><p>Function a, a learnable function, is recognized as a feed forward network. In this formulation, attention can be seen as producing a fixed-length embedding c of the input sequence by computing an adaptive weighted average of the state sequence h.</p><p>c就是注意力,alpha就是权重,h就是隐含状态,alpha通过softmax计算,score就是通过h计算的,h就是当前状态输入的词语和上一隐含状态ht-1计算而来的</p><p><img loading="lazy" alt="png" src="data:image/png;base64,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" width="139" height="123" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="细看结构">细看结构<a class="hash-link" href="#细看结构" title="Direct link to heading">​</a></h2><p>TextAttBiRNN 的网络结构
<img loading="lazy" alt="png" src="/assets/images/text-attn-birnn-f1dc0d41478bbeb69aae3d3e89170226.png" width="832" height="516" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="输入层">输入层<a class="hash-link" href="#输入层" title="Direct link to heading">​</a></h3><p>输入层我们可以定义为句子输入长度，每个词经过一个embedding_dim=50的embedding矩阵，最终输出400×50的表示矩阵.假设一个句子有400个词语</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bi-lstm">Bi-LSTM<a class="hash-link" href="#bi-lstm" title="Direct link to heading">​</a></h3><p>Bi-LSTM层作为一种特征编码层，这层可以提取每个词语的上下文特征，然后将双向的特征进行拼接，然后依旧将每个词语的特征进行输出，因此输出为400×256的特征矩阵</p><p>Attention层
Attention层对这个网络中对每个词语进行了加权求和，这个权重是通过训练不断训练出来的，这层我们的输入x为400×256，我们初始化权重矩阵W为256×1维，然后对x与W进行点乘、归一化（公式的前两个），这样就可以得到400×1的矩阵a，这个矩阵代表的是每个词对应的权重，权重大的词代表注意力大的，这个词的贡献程度更大，最后对每个词语进行加权平均，aT与x进行点乘，得到1×256，这是最终加权平均后输出的总特征向量。</p><p>输出层
与我之前textCNN做中文新闻分类实验差不多，使用全连接层，softmax作为激活函数进行输出。</p><p>demo项目: <a href="https://github.com/flybirdgroup/sentiment_analysis" target="_blank" rel="noopener noreferrer">情感分析</a></p><h1>导入工具包</h1><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> jieba_fast </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> jieba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> backend </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> initializers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">regularizers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Embedding</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Dense</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Conv1D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GlobalMaxPooling1D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Concatenate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Dropout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Embedding</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Dropout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Bidirectional</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">LSTM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> load_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> elmoformanylangs </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Embedder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plot_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> to_categorical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">callbacks </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> EarlyStopping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ModelCheckpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pandarallel </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandarallel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pandarallel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">preprocessing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Tokenizer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>读取数据</h1><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./data/sentiment_analysis_data.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">' '</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/1-91054ddc8aa1c6bf4c7b6bb3693edfac.png" width="662" height="387" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="打乱样本">打乱样本<a class="hash-link" href="#打乱样本" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frac</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">drop</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>建模思路</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="技术路线">技术路线<a class="hash-link" href="#技术路线" title="Direct link to heading">​</a></h2><p>分两种种情况,好评,负评,中评
计算路线:
1 使用TextCNN对每个句子类似n-gram处理</p><p>2 使用RNN</p><p>3 可以尝试使用attention机制做情感判断,对词进行word2vec,或者elmo embedding,可添加bi-lstm获取上下文信息</p><p><a href="https://www.xn--gmqr38alogxt2a.net/blog/Attention" target="_blank" rel="noopener noreferrer">Attention原理请参考</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看是否有缺失值">查看是否有缺失值<a class="hash-link" href="#查看是否有缺失值" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="分析标签数据情况">分析标签数据情况<a class="hash-link" href="#分析标签数据情况" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">label_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'-1'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'负评'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'0'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'中评'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'1'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'正评'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'label'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'label'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> label_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/2-60216825d3aa4fa46ac03f1c6fb73b74.png" width="648" height="255" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看每个文本的长度">查看每个文本的长度<a class="hash-link" href="#查看每个文本的长度" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'txt_num'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'txt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'txt_num'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">'mean'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="得到句子长度">得到句子长度<a class="hash-link" href="#得到句子长度" title="Direct link to heading">​</a></h2><p>所以根据数据,得出我们会设置maxlen= 40左右</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="jieba分词">jieba分词<a class="hash-link" href="#jieba分词" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pandarallel </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandarallel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pandarallel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="获取停用词和设立分词函数">获取停用词和设立分词函数<a class="hash-link" href="#获取停用词和设立分词函数" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stopwords </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./data/stopwords.txt'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'\t'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">index_col</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">quoting</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">split_words</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> jieba</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lcut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stopwords</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' '</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'txt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'txt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parallel_apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">split_words</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="建立模型">建立模型<a class="hash-link" href="#建立模型" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="attention网络">Attention网络<a class="hash-link" href="#attention网络" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Attention</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Layer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step_dim</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 W_regularizer</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_regularizer</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 W_constraint</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_constraint</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 bias</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">supports_masking </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initializers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'glorot_uniform'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W_regularizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> regularizers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">W_regularizer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b_regularizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> regularizers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b_regularizer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W_constraint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> constraints</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">W_constraint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b_constraint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> constraints</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b_constraint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bias </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bias</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">step_dim </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> step_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features_dim </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Attention</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_weight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shape</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'{}_W'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 regularizer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W_regularizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 constraint</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W_constraint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features_dim </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bias</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_weight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shape</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'zero'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'{}_b'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     regularizer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b_regularizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     constraint</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b_constraint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">built </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compute_mask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token builtin">input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">input_mask</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#do not pass the mask to the next layers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">mask</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        features_dim </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        step_dim </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">step_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#K.reshape(x,(-1,features_dim))里面-1可以想象成一行,features_dim变成一行有features_dim维矩阵(1*dim维),K.reshape(self.W, (features_dim, 1)),变成矩阵(dim维*self.W)features_dim行和1维</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> features_dim</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features_dim</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step_dim</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 这里也可以用另外一种表示方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         e = K.reshape(K.dot(K.reshape(x,(1,-1)),K.reshape(self.W,(-1,1))),(-1,1))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 其实就是全连接的矩阵相乘 e = K.dot(x, self.W)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bias</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tanh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 激活函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 去指数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># apply mask after the exp. will be re-normalized next</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> mask </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># cast the mask to floatX to avoid float64 upcasting in theano</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            a </span><span class="token operator" style="color:#393A34">*=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mask</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">floatx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 转换成floatx类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># in some cases especially in the early stages of training the sum may be almost zero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># and this results in NaN's. A workaround is to add a very small positive number ε to the sum.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keepdims</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">epsilon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">floatx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># softmax函数,得到权重矩阵</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">expand_dims</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 变成(dim,1),这样可以与x进行加权就和得到context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#权重与hidden信息加权就和得到context,也就是我们的注意力</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compute_output_shape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> input_shape</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features_dim  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">"step_dim"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">step_dim</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token string" style="color:#e3116c">"W_regularizer"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W_regularizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b_regularizer"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b_regularizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token string" style="color:#e3116c">"W_constraint"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">W_constraint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"b_constraint"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b_constraint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token string" style="color:#e3116c">"bias"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bias</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        base_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Attention</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base_config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="网络结构">网络结构<a class="hash-link" href="#网络结构" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="elmo层">elmo层<a class="hash-link" href="#elmo层" title="Direct link to heading">​</a></h3><p>哈工大开发的动态词向量<a href="https://github.com/HIT-SCIR/ELMoForManyLangs" target="_blank" rel="noopener noreferrer">elmo</a></p><p>elmo原理可参考<a href="https://www.jianshu.com/p/2fff53696fac" target="_blank" rel="noopener noreferrer">链接</a></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Embedder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./zhs.model/'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建padding函数">创建padding函数<a class="hash-link" href="#创建padding函数" title="Direct link to heading">​</a></h3><p>超过句子长度就截取,不够就补空</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pad_sent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">max_len</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">max_len</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> x</span><span class="token operator" style="color:#393A34">+</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">max_len</span><span class="token operator" style="color:#393A34">-</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建批量生成器">创建批量生成器<a class="hash-link" href="#创建批量生成器" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">batch_generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n_batches_per_epoch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_batches_per_epoch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sents2elmo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pad_sent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> sent </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">batch_size</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">batch_size</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">batch_size</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">batch_size</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> x_batch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_batch</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">predict_generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#预测</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    n_batches_per_epoch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_batches_per_epoch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x_batch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sents2elmo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pad_sent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> sent </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">batch_size</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">batch_size</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> x_batch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="构建elmotextbirnn网络结构">构建ELMOTextBiRNN网络结构<a class="hash-link" href="#构建elmotextbirnn网络结构" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ELMOTextBiRNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">max_features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">embedding_dims</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">class_num</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">last_activation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'softmax'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxlen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">max_features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> max_features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">embedding_dims </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> embedding_dims</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">class_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> class_num</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_activation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> last_activation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     def get_model(self):</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         embedding = Input((self.maxlen, self.embedding_dims,)) # 输入预训练的词向量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         convs = [] </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         for kernel_size in [3,4,5]: #设定filter大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#             c = Conv1D(128,kernel_size,activation='relu')(embedding)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#             c = GlobalMaxPooling1D()(c)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#             convs.append(c)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         x = Concatenate()(convs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         output = Dense(self.class_num,activation=self.last_activation)(x)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         model = Model(inputs=embedding,outputs=output)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#         return model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        embedding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">embedding_dims</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Bidirectional</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LSTM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">return_sequences</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">embedding</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Attention</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">class_num</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">activation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_activation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">embedding</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> model        </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tokenizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Tokenizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tokenizer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit_on_texts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'txt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vocab </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tokenizer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">word_index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vocab</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="设置模型参数">设置模型参数<a class="hash-link" href="#设置模型参数" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">maxlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vocab</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">embedding_dims </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取模型">获取模型<a class="hash-link" href="#获取模型" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ELMOTextBiRNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">max_features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">embedding_dims</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plot_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">show_shapes</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/output_47_0-ff55d84af1667ad834bf6ae26949cc44.png" width="531" height="395" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="划分训练集测试集">划分训练集,测试集<a class="hash-link" href="#划分训练集测试集" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'txt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'label'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="建立词典词语id化标签独热编码">建立词典,词语id化,标签独热编码<a class="hash-link" href="#建立词典词语id化标签独热编码" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">encode_category_one_hot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> to_categorical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    categories </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat_to_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">categories</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">categories</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_train_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cat_to_id</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_test_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cat_to_id</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat_to_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_train_one_hot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_test_one_hot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_test_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> y_train_one_hot</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_test_one_hot</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">cat_to_id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">y_train_one_hot</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_test_one_hot</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">cat_to_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encode_category_one_hot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y_test</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sentences_list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sentences_list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_test</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="设立早停">设立早停<a class="hash-link" href="#设立早停" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">my_callbacks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ModelCheckpoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'.ELMO_birnn_model.h5'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EarlyStopping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">monitor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'accuracy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">patience</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'max'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ELMOTextBiRNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">max_features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'adam'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'categorical_crossentropy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">metrics</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'accuracy'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试模型">测试模型<a class="hash-link" href="#测试模型" title="Direct link to heading">​</a></h2><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'今天 天气 很 晴朗 处处 有 阳光 有 阳光'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'%s'</span><span class="token operator" style="color:#393A34">%</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat_to_id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  {'负评': 0, '正评': 1, '中评': 2}</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sentence</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>[<!-- -->['今天 天气 很 晴朗 处处 有 阳光 有 阳光']<!-- -->]</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict_generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predict_generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sentence</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">steps</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>array([<!-- -->[0.21561107, 0.600974  , 0.18341494]<!-- -->], dtype=float32)</p>]]></content:encoded>
            <category>CNN</category>
            <category>classifier</category>
            <category>textCNN</category>
        </item>
        <item>
            <title><![CDATA[word2vec详解]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/03/18/word2vec</link>
            <guid>/2020/03/18/word2vec</guid>
            <pubDate>Wed, 18 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[什么是Word2Vec和Embeddings？]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是word2vec和embeddings">什么是Word2Vec和Embeddings？<a class="hash-link" href="#什么是word2vec和embeddings" title="Direct link to heading">​</a></h2><p>我们可以简单认为Word2Vec就是把词语向量化，也就是每个我们对于一个语料库进行学习后，每个单词都有对应的坐标位置，这时候，通过每个单词的坐标位置，我们可以通过余弦定理推导出两个词语，短语或者句子的相似程度。这里可以参考我参与的云润大数据舆情系统的词云项目，<a href="https://github.com/weijiang2009/URun.ResearchPrototype/tree/dev/Projects/WordCloud/src/words_similarity_xiaoxian" target="_blank" rel="noopener noreferrer">关键词匹配</a>
<img loading="lazy" alt="jpeg" src="/assets/images/word2vec-a67f2af29ccb46f1f9f9a273eb778477.jpeg" width="640" height="640" class="img_ev3q"></p><p>那么它是如何帮助我们做自然语言处理呢？Word2Vec其实就是通过学习文本来用词向量的方式表征词的语义信息，即通过一个嵌入空间使得语义上相似的单词在该空间内距离很近。
Embedding其实就是一个映射，将单词从原先所属的空间映射到新的多维空间中，也就是把原先词所在空间嵌入到一个新的空间中去。</p><p>我们从直观角度上来理解一下，cat这个单词和kitten属于语义上很相近的词，而dog和kitten则不是那么相近，iphone这个单词和kitten的语义就差的更远了。通过对词汇表中单词进行这种数值表示方式的学习（也就是将单词转换为词向量），能够让我们基于这样的数值进行向量化的操作从而得到一些有趣的结论。比如说，如果我们对词向量kitten、cat以及dog执行这样的操作：kitten - cat + dog，那么最终得到的嵌入向量（embedded vector）将与puppy这个词向量十分相近。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="模型">模型<a class="hash-link" href="#模型" title="Direct link to heading">​</a></h2><p>Word2Vec模型中，主要有Skip-Gram和CBOW两种模型，从直观上理解，Skip-Gram是给定input word来预测上下文。而CBOW是给定上下文，来预测input word。本篇文章仅讲解Skip-Gram模型。</p><p>这里可以有几篇大神的文章可以参看:
<img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b306c8b3b1.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（结构篇）" class="img_ev3q"></p><p>Skip-Gram模型的基础形式非常简单，为了更清楚地解释模型，我们先从最一般的基础模型来看Word2Vec（下文中所有的Word2Vec都是指Skip-Gram模型）。</p><p>Word2Vec模型实际上分为了两个部分，<strong>第一部分为建立模型，第二部分是通过模型获取嵌入词向量</strong>。Word2Vec的整个建模过程实际上与自编码器（auto-encoder）的思想很相似，即先基于训练数据构建一个神经网络，当这个模型训练好以后，我们并不会用这个训练好的模型处理新的任务，我们真正需要的是这个模型通过训练数据所学得的参数，例如隐层的权重矩阵——后面我们将会看到这些权重在Word2Vec中实际上就是我们试图去学习的“word vectors”。基于训练数据建模的过程，我们给它一个名字叫“Fake Task”，意味着建模并不是我们最终的目的。</p><blockquote><p>上面提到的这种方法实际上会在无监督特征学习（unsupervised feature learning）中见到，最常见的就是自编码器（auto-encoder）：通过在隐层将输入进行编码压缩，继而在输出层将数据解码恢复初始状态，训练完成后，我们会将输出层“砍掉”，仅保留隐层。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-fake-task">The Fake Task<a class="hash-link" href="#the-fake-task" title="Direct link to heading">​</a></h2><p>我们在上面提到，训练模型的真正目的是获得模型基于训练数据学得的隐层权重。为了得到这些权重，我们首先要构建一个完整的神经网络作为我们的“Fake Task”，后面再返回来看通过“Fake Task”我们如何间接地得到这些词向量。</p><p>接下来我们来看看如何训练我们的神经网络。假如我们有一个句子<strong>“The dog barked at the mailman”</strong>。</p><ul><li>首先我们选句子中间的一个词作为我们的输入词，例如我们选取“dog”作为input word；</li><li>有了input word以后，我们再定义一个叫做skip_window的参数，它代表着我们从当前input word的一侧（左边或右边）选取词的数量。如果我们设置skip_window=2，那么我们最终获得窗口中的词（包括input word在内）就是<strong>['The', 'dog'，'barked', 'at']</strong>。skip_window=2代表着选取左input word左侧2个词和右侧2个词进入我们的窗口，所以整个窗口大小span=2x2=4。另一个参数叫num_skips，它代表着我们从整个窗口中选取多少个不同的词作为我们的output word，当skip_window=2，num_skips=2时，我们将会得到两组 <strong>(input word, output word)</strong> 形式的训练数据，即 <strong>('dog', 'barked')</strong>，<strong>('dog', 'the')</strong>。</li><li>神经网络基于这些训练数据将会输出一个概率分布，这个概率代表着我们的词典中的每个词是output word的可能性。这句话有点绕，我们来看个栗子。第二步中我们在设置skip_window和num_skips=2的情况下获得了两组训练数据。假如我们先拿一组数据 <strong>('dog', 'barked')</strong> 来训练神经网络，那么模型通过学习这个训练样本，会告诉我们词汇表中每个单词是“barked”的概率大小。</li></ul><p>模型的输出概率代表着到我们词典中每个词有多大可能性跟input word同时出现。举个栗子，如果我们向神经网络模型中输入一个单词“Soviet“，那么最终模型的输出概率中，像“Union”， ”Russia“这种相关词的概率将远高于像”watermelon“，”kangaroo“非相关词的概率。因为”Union“，”Russia“在文本中更大可能在”Soviet“的窗口中出现。我们将通过给神经网络输入文本中成对的单词来训练它完成上面所说的概率计算。下面的图中给出了一些我们的训练样本的例子。我们选定句子<strong>“The quick brown fox jumps over lazy dog”</strong>，设定我们的窗口大小为2（window_size=2），也就是说我们仅选输入词前后各两个词和输入词进行组合。下图中，蓝色代表input word，方框内代表位于窗口内的单词。</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b319eb5f1f.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（结构篇）" class="img_ev3q"></p><p>我们的模型将会从每对单词出现的次数中习得统计结果。例如，我们的神经网络可能会得到更多类似（“Soviet“，”Union“）这样的训练样本对，而对于（”Soviet“，”Sasquatch“）这样的组合却看到的很少。因此，当我们的模型完成训练后，给定一个单词”Soviet“作为输入，输出的结果中”Union“或者”Russia“要比”Sasquatch“被赋予更高的概率。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="模型细节">模型细节<a class="hash-link" href="#模型细节" title="Direct link to heading">​</a></h2><p>我们如何来表示这些单词呢？首先，我们都知道神经网络只能接受数值输入，我们不可能把一个单词字符串作为输入，因此我们得想个办法来表示这些单词。最常用的办法就是基于训练文档来构建我们自己的词汇表（vocabulary）再对单词进行one-hot编码。</p><p>假设从我们的训练文档中抽取出10000个唯一不重复的单词组成词汇表。我们对这10000个单词进行one-hot编码，得到的每个单词都是一个10000维的向量，向量每个维度的值只有0或者1，假如单词ants在词汇表中的出现位置为第3个，那么ants的向量就是一个第三维度取值为1，其他维都为0的10000维的向量（ants=<!-- -->[0, 0, 1, 0, ..., 0]<!-- -->）。</p><p>还是上面的例子，“The dog barked at the mailman”，那么我们基于这个句子，可以构建一个大小为5的词汇表（忽略大小写和标点符号）：("the", "dog", "barked", "at", "mailman")，我们对这个词汇表的单词进行编号0-4。那么”dog“就可以被表示为一个5维向量<!-- -->[0, 1, 0, 0, 0]<!-- -->。</p><p>模型的输入如果为一个10000维的向量，那么输出也是一个10000维度（词汇表的大小）的向量，它包含了10000个概率，每一个概率代表着当前词是输入样本中output word的概率大小。</p><p>下图是我们神经网络的结构：</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b31d0920ef.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（结构篇）" class="img_ev3q"></p><p>隐层没有使用任何激活函数，但是输出层使用了sotfmax。</p><p>我们基于成对的单词来对神经网络进行训练，训练样本是 ( input word, output word ) 这样的单词对，input word和output word都是one-hot编码的向量。最终模型的输出是一个概率分布。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="隐层">隐层<a class="hash-link" href="#隐层" title="Direct link to heading">​</a></h2><p>说完单词的编码和训练样本的选取，我们来看下我们的隐层。如果我们现在想用300个特征来表示一个单词（即每个词可以被表示为300维的向量）。那么隐层的权重矩阵应该为10000行，300列（隐层有300个结点）。</p><p>Google在最新发布的基于Google news数据集训练的模型中使用的就是300个特征的词向量。词向量的维度是一个可以调节的超参数（在Python的gensim包中封装的Word2Vec接口默认的词向量大小为100， window_size为5）。</p><p>看下面的图片，左右两张图分别从不同角度代表了输入层-隐层的权重矩阵。左图中每一列代表一个10000维的词向量和隐层单个神经元连接的权重向量。从右边的图来看，每一行实际上代表了每个单词的词向量。</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b320f8ed60.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（结构篇）" class="img_ev3q"></p><p>所以我们最终的目标就是学习这个隐层的权重矩阵。</p><p>我们现在回来接着通过模型的定义来训练我们的这个模型。</p><p>上面我们提到，input word和output word都会被我们进行one-hot编码。仔细想一下，我们的输入被one-hot编码以后大多数维度上都是0（实际上仅有一个位置为1），所以这个向量相当稀疏，那么会造成什么结果呢。如果我们将一个1 x 10000的向量和10000 x 300的矩阵相乘，它会消耗相当大的计算资源，为了高效计算，它仅仅会选择矩阵中对应的向量中维度值为1的索引行（这句话很绕），看图就明白。</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b322ae0c72.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（结构篇）" class="img_ev3q"></p><p>我们来看一下上图中的矩阵运算，左边分别是1 x 5和5 x 3的矩阵，结果应该是1 x 3的矩阵，按照矩阵乘法的规则，结果的第一行第一列元素为0 x 17 + 0 x 23 + 0 x 4 + 1 x 10 + 0 x 11 = 10，同理可得其余两个元素为12，19。如果10000个维度的矩阵采用这样的计算方式是十分低效的。</p><p>为了有效地进行计算，这种稀疏状态下不会进行矩阵乘法计算，可以看到矩阵的计算的结果实际上是矩阵对应的向量中值为1的索引，上面的例子中，左边向量中取值为1的对应维度为3（下标从0开始），那么计算结果就是矩阵的第3行（下标从0开始）—— <!-- -->[10, 12, 19]<!-- -->，这样模型中的隐层权重矩阵便成了一个”查找表“（lookup table），进行矩阵计算时，直接去查输入向量中取值为1的维度下对应的那些权重值。隐层的输出就是每个输入单词的“嵌入词向量”。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="输出层">输出层<a class="hash-link" href="#输出层" title="Direct link to heading">​</a></h2><p>经过神经网络隐层的计算，ants这个词会从一个1 x 10000的向量变成1 x 300的向量，再被输入到输出层。输出层是一个softmax回归分类器，它的每个结点将会输出一个0-1之间的值（概率），这些所有输出层神经元结点的概率之和为1。</p><p>下面是一个例子，训练样本为 (input word: “ants”， output word: “car”) 的计算示意图。</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b3267c64f4.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（结构篇）" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="直觉上的理解">直觉上的理解<a class="hash-link" href="#直觉上的理解" title="Direct link to heading">​</a></h2><p>下面我们将通过直觉来进行一些思考。</p><p>如果两个不同的单词有着非常相似的“上下文”（也就是窗口单词很相似，比如“Kitty climbed the tree”和“Cat climbed the tree”），那么通过我们的模型训练，这两个单词的嵌入向量将非常相似。</p><p>那么两个单词拥有相似的“上下文”到底是什么含义呢？比如对于同义词“intelligent”和“smart”，我们觉得这两个单词应该拥有相同的“上下文”。而例如”engine“和”transmission“这样相关的词语，可能也拥有着相似的上下文。</p><p>实际上，这种方法实际上也可以帮助你进行词干化（stemming），例如，神经网络对”ant“和”ants”两个单词会习得相似的词向量。</p><blockquote><p>词干化（stemming）就是去除词缀得到词根的过程。</p></blockquote><p>在第一部分讲解完成后，我们会发现Word2Vec模型是一个超级大的神经网络（权重矩阵规模非常大）。</p><p>举个栗子，我们拥有10000个单词的词汇表，我们如果想嵌入300维的词向量，那么我们的<strong>输入-隐层权重矩阵</strong>和<strong>隐层-输出层的权重矩阵</strong>都会有 10000 x 300 = 300万个权重，在如此庞大的神经网络中进行梯度下降是相当慢的。更糟糕的是，你需要大量的训练数据来调整这些权重并且避免过拟合。百万数量级的权重矩阵和亿万数量级的训练样本意味着训练这个模型将会是个灾难（太凶残了）。</p><p>Word2Vec 的作者在它的第二篇论文中强调了这些问题，下面是作者在第二篇论文中的三个创新：</p><blockquote><p>1.将常见的单词组合（word pairs）或者词组作为单个“words”来处理。</p><p>2.对高频次单词进行抽样来减少训练样本的个数。</p><p>3.对优化目标采用“negative sampling”方法，这样每个训练样本的训练只会更新一小部分的模型权重，从而降低计算负担。</p></blockquote><p>事实证明，对常用词抽样并且对优化目标采用“negative sampling”不仅降低了训练过程中的计算负担，还提高了训练的词向量的质量。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="word-pairs-and-phases">Word pairs and "phases"<a class="hash-link" href="#word-pairs-and-phases" title="Direct link to heading">​</a></h2><p>论文的作者指出，一些单词组合（或者词组）的含义和拆开以后具有完全不同的意义。比如“Boston Globe”是一种报刊的名字，而单独的“Boston”和“Globe”这样单个的单词却表达不出这样的含义。因此，在文章中只要出现“Boston Globe”，我们就应该把它作为一个单独的词来生成其词向量，而不是将其拆开。同样的例子还有“New York”，“United Stated”等。</p><p>在Google发布的模型中，它本身的训练样本中有来自Google News数据集中的1000亿的单词，但是除了单个单词以外，单词组合（或词组）又有3百万之多。</p><p>如果你对模型的词汇表感兴趣，可以点击：</p><p><a href="http://t.cn/RoVde3h" target="_blank" rel="noopener noreferrer">http://t.cn/RoVde3h</a></p><p>你还可以直接浏览这个词汇表：</p><p><a href="http://t.cn/RoVdsZr" target="_blank" rel="noopener noreferrer">http://t.cn/RoVdsZr</a></p><p>如果想了解这个模型如何进行文档中的词组抽取，可以看论文中“Learning Phrases”这一章，对应的代码在 word2phrase.c ，相关链接如下。</p><blockquote><p>论文链接：</p><p><a href="http://t.cn/RMct1c7" target="_blank" rel="noopener noreferrer">http://t.cn/RMct1c7</a></p></blockquote><blockquote><p>代码链接：</p><p><a href="http://t.cn/RMct1c7" target="_blank" rel="noopener noreferrer">http://t.cn/R5auFLz</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="对高频词抽样">对高频词抽样<a class="hash-link" href="#对高频词抽样" title="Direct link to heading">​</a></h2><p>在第一部分的讲解中，我们展示了训练样本是如何从原始文档中生成出来的，这里我再重复一次。我们的原始文本为“The quick brown fox jumps over the laze dog”，如果我使用大小为2的窗口，那么我们可以得到图中展示的那些训练样本。</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b387f8455d.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（训练篇）" class="img_ev3q"></p><p>但是对于“the”这种常用高频单词，这样的处理方式会存在下面两个问题：</p><blockquote><ol><li>当我们得到成对的单词训练样本时，("fox", "the") 这样的训练样本并不会给我们提供关于“fox”更多的语义信息，因为“the”在每个单词的上下文中几乎都会出现。</li><li>由于在文本中“the”这样的常用词出现概率很大，因此我们将会有大量的（”the“，...）这样的训练样本，而这些样本数量远远超过了我们学习“the”这个词向量所需的训练样本数。</li></ol></blockquote><p>Word2Vec通过“抽样”模式来解决这种高频词问题。它的基本思想如下：对于我们在训练原始文本中遇到的每一个单词，它们都有一定概率被我们从文本中删掉，而这个被删除的概率与单词的频率有关。
如果我们设置窗口大小（即），并且从我们的文本中删除所有的“the”，那么会有下面的结果：</p><ul><li><p>由于我们删除了文本中所有的“the”，那么在我们的训练样本中，“the”这个词永远也不会出现在我们的上下文窗口中。</p></li><li><p>当“the”作为input word时，我们的训练样本数至少会减少10个。</p></li></ul><blockquote><p>这句话应该这么理解，假如我们的文本中仅出现了一个“the”，那么当这个“the”作为input word时，我们设置span=10，此时会得到10个训练样本 ("the", ...) ，如果删掉这个“the”，我们就会减少10个训练样本。实际中我们的文本中不止一个“the”，因此当“the”作为input word的时候，至少会减少10个训练样本。</p></blockquote><p>上面提到的这两个影响结果实际上就帮助我们解决了高频词带来的问题。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="抽样率">抽样率<a class="hash-link" href="#抽样率" title="Direct link to heading">​</a></h2><p>word2vec的C语言代码实现了一个计算在词汇表中保留某个词概率的公式。</p><p>ωi 是一个单词，Z(ωi) 是 ωi 这个单词在所有语料中出现的频次。举个栗子，如果单词“peanut”在10亿规模大小的语料中出现了1000次，那么 Z(peanut) = 1000/1000000000 = 1e - 6。</p><p>在代码中还有一个参数叫“sample”，这个参数代表一个阈值，默认值为0.001<strong>（在gensim包中的Word2Vec类说明中，这个参数默认为0.001，文档中对这个参数的解释为“ threshold for configuring which higher-frequency words are randomly downsampled”）</strong>。这个值越小意味着这个单词被保留下来的概率越小（即有越大的概率被我们删除）。</p><p>P(ωi) 代表着保留某个单词的概率：</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b3a020bdea.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（训练篇）" class="img_ev3q"></p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b3a191fdcd.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（训练篇）" class="img_ev3q"></p><p>图中x轴代表着 Z(ωi) ，即单词 ωi 在语料中出现频率，y轴代表某个单词被保留的概率。对于一个庞大的语料来说，单个单词的出现频率不会很大，即使是常用词，也不可能特别大。</p><p>从这个图中，我们可以看到，随着单词出现频率的增高，它被采样保留的概率越来越小，我们还可以看到一些有趣的结论：</p><ul><li><p>当 Z(ωi) &lt;= 0.0026 时，P(ωi) = 1.0 。当单词在语料中出现的频率小于 0.0026 时，它是 100% 被保留的，这意味着只有那些在语料中出现频率超过 0.26% 的单词才会被采样。</p></li><li><p>当时 Z(ωi) = 0.00746 时，P(ωi) = 0.5，意味着这一部分的单词有 50% 的概率被保留。</p></li><li><p>当 Z(ωi) = 1.0 时，P(ωi) = 0.033，意味着这部分单词以 3.3% 的概率被保留。</p></li></ul><blockquote><p>如果你去看那篇论文的话，你会发现作者在论文中对函数公式的定义和在C语言代码的实现上有一些差别，但我认为C语言代码的公式实现是更权威的一个版本。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="负采样negative-sampling">负采样（negative sampling）<a class="hash-link" href="#负采样negative-sampling" title="Direct link to heading">​</a></h2><p>训练一个神经网络意味着要输入训练样本并且不断调整神经元的权重，从而不断提高对目标的准确预测。每当神经网络经过一个训练样本的训练，它的权重就会进行一次调整。
正如我们上面所讨论的，vocabulary的大小决定了我们的Skip-Gram神经网络将会拥有大规模的权重矩阵，所有的这些权重需要通过我们数以亿计的训练样本来进行调整，这是非常消耗计算资源的，并且实际中训练起来会非常慢。
<strong>负采样（negative sampling）</strong>解决了这个问题，它是用来提高训练速度并且改善所得到词向量的质量的一种方法。不同于原本每个训练样本更新所有的权重，负采样每次让一个训练样本仅仅更新一小部分的权重，这样就会降低梯度下降过程中的计算量。
当我们用训练样本 ( input word: "fox"，output word: "quick") 来训练我们的神经网络时，“ fox”和“quick”都是经过one-hot编码的。如果我们的vocabulary大小为10000时，在输出层，我们期望对应“quick”单词的那个神经元结点输出1，其余9999个都应该输出0。在这里，这9999个我们期望输出为0的神经元结点所对应的单词我们称为“negative” word。
当使用负采样时，我们将随机选择一小部分的negative words（比如选5个negative words）来更新对应的权重。我们也会对我们的“positive” word进行权重更新（在我们上面的例子中，这个单词指的是”quick“）。</p><blockquote><p>在论文中，作者指出指出对于小规模数据集，选择5-20个negative words会比较好，对于大规模数据集可以仅选择2-5个negative words。</p></blockquote><p>回忆一下我们的隐层-输出层拥有300 x 10000的权重矩阵。如果使用了负采样的方法我们仅仅去更新我们的positive word-“quick”的和我们选择的其他5个negative words的结点对应的权重，共计6个输出神经元，相当于每次只更新 300 x 6 = 1800 个权重。对于3百万的权重来说，相当于只计算了0.06%的权重，这样计算效率就大幅度提高。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何选择negative-words">如何选择negative words<a class="hash-link" href="#如何选择negative-words" title="Direct link to heading">​</a></h2><p>我们使用“一元模型分布（unigram distribution）”来选择“negative words”。
要注意的一点是，一个单词被选作negative sample的概率跟它出现的频次有关，出现频次越高的单词越容易被选作negative words。
在word2vec的C语言实现中，你可以看到对于这个概率的实现公式。每个单词被选为“negative words”的概率计算公式与其出现的频次有关。
代码中的公式实现如下：</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b3b5516125.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（训练篇）" class="img_ev3q"></p><p>每个单词被赋予一个权重，即 f(ωi)， 它代表着单词出现的频次。</p><p>公式中开3/4的根号完全是基于经验的，论文中提到这个公式的效果要比其它公式更加出色。你可以在google的搜索栏中输入“plot y = x^(3/4) and y = x”，然后看到这两幅图（如下图），仔细观察x在<!-- -->[0,1]<!-- -->区间内时y的取值，x^(3/4) 有一小段弧形，取值在 y = x 函数之上。</p><p><img loading="lazy" src="https://static.leiphone.com/uploads/new/article/740_740/201706/594b3bb3458fc.png?imageMogr2/format/jpg/quality/90" alt="一文详解 Word2vec 之 Skip-Gram 模型（训练篇）" class="img_ev3q"></p><p>负采样的C语言实现非常的有趣。unigram table有一个包含了一亿个元素的数组，这个数组是由词汇表中每个单词的索引号填充的，并且这个数组中有重复，也就是说有些单词会出现多次。那么每个单词的索引在这个数组中出现的次数该如何决定呢，有公式，也就是说计算出的<strong>负采样概率<!-- -->*<!-- -->1亿=单词在表中出现的次数</strong>。</p><p>有了这张表以后，每次去我们进行负采样时，只需要在0-1亿范围内生成一个随机数，然后选择表中索引号为这个随机数的那个单词作为我们的negative word即可。一个单词的负采样概率越大，那么它在这个表中出现的次数就越多，它被选中的概率就越大。</p><p>到目前为止，Word2Vec中的Skip-Gram模型就讲完了，对于里面具体的数学公式推导细节这里并没有深入。这篇文章只是对于实现细节上的一些思想进行了阐述。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[使用Google Cloud SDK来配置Google App Engine]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/18/google_cloud</link>
            <guid>/2020/3/18/google_cloud</guid>
            <pubDate>Wed, 18 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Learn how to build deep learning in Google Cloud Platform Docusaurus 2 alpha.]]></description>
            <content:encoded><![CDATA[<p>Learn how to build deep learning in Google Cloud Platform <a href="https://v2.docusaurus.io/" target="_blank" rel="noopener noreferrer"><strong>Docusaurus 2 alpha</strong></a>.</p><p>使用Google Cloud SDK来配置Google App Engine</p><p>Google App Engine 是一个脱离了基础架构束缚的全面托管型平台，功能十分强大，当今最成功的一些公司都纷纷在 App Engine 上运行他们的应用。</p><p>　　之前我曾经介绍过使用Google App Engine SDK来更新Google App Engine的工程，目前Google App Engine有了一个新的SDK：Google Cloud SDK，使用这个SDK能更快更高效地进行维护和更新。下面我就介绍一下Google Cloud SDK的简单使用方法。</p><p>　　先从这个地址来下载安装SDK环境，包括下载并安装 Python 2.7， 下载并安装 Google Cloud SDK。</p><p>　　使用 gcloud init --skip-diagnostics 来初始化并登陆Google账户，选择一个工程。支持socks5代理，用户可以在初始化的时候把代理设置上。</p><p><img loading="lazy" alt="png" src="/assets/images/1-3e38d606fcbe929fef47542a28daac87.png" width="562" height="272" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/2-e5123cf1433d3e007d86f6c9d7946803.png" width="1123" height="763" class="img_ev3q"></p>]]></content:encoded>
            <category>google cloud</category>
            <category>SDK</category>
            <category>socket</category>
            <category>google cloud init</category>
        </item>
        <item>
            <title><![CDATA[textCNN卷积神经网络分类]]></title>
            <link>https://your-docusaurus-test-site.com/blog/2020/3/18/textCNN</link>
            <guid>/2020/3/18/textCNN</guid>
            <pubDate>Wed, 18 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[云润人工智能部门《NLP零基础快速上手教程》课程资料 by 算法工程师:招晓贤]]></description>
            <content:encoded><![CDATA[<p><strong><a href="https://my-website-six.now.sh/" target="_blank" rel="noopener noreferrer">云润人工智能部门</a>《NLP零基础快速上手教程》课程资料 by <a href="https://github.com/flybirdgroup" target="_blank" rel="noopener noreferrer">算法工程师:招晓贤</a></strong></p><h1>菜鸟也能玩转NLP-卷积神经网络文本分类</h1><p><strong><a href="https://my-website-six.now.sh/" target="_blank" rel="noopener noreferrer">云润人工智能部门</a>《NLP零基础快速上手教程》课程资料 by <a href="https://github.com/flybirdgroup" target="_blank" rel="noopener noreferrer">算法工程师:招晓贤</a></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="原理讲解">原理讲解<a class="hash-link" href="#原理讲解" title="Direct link to heading">​</a></h2><p>TextCNN出处：论文<a href="http://www.aclweb.org/anthology/D14-1181" target="_blank" rel="noopener noreferrer">Convolutional Neural Networks for Sentence Classification</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="论文核心点">论文核心点<a class="hash-link" href="#论文核心点" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="png" src="/assets/images/TextCNN-dc16f80beee073004385de7247dc114e.png" width="1331" height="659" class="img_ev3q"></p><ol><li>Represent sentence with <strong>static and non-static channels</strong>.</li><li><strong>Convolve</strong> with multiple filter widths and feature maps.</li><li>Use <strong>max-over-time pooling</strong>.</li><li>Use <strong>fully connected layer</strong> with <strong>dropout</strong> and <strong>softmax</strong> ouput.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="textcnn基础知识">TextCNN基础知识<a class="hash-link" href="#textcnn基础知识" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="词向量">词向量<a class="hash-link" href="#词向量" title="Direct link to heading">​</a></h4><ol><li>随机初始化</li><li>预训练词向量进行初始化,在训练过程中固定(CNN-static),注意与图像CNN的不同</li><li>预训练词向量进行初始化,在训练过程中微调(CNN-non-static)</li><li>多通道(CNN-multichannel):将固定的预训练词向量和微调的词向量分别作为一个通道(channel),卷积操作同时在两个通道上进行,可以类比图像RGB三通道</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="详细说明">详细说明<a class="hash-link" href="#详细说明" title="Direct link to heading">​</a></h4><ol><li>上图的图片为例,句子长度为n=9,词向量维度k为6,filter有两种窗口大小,每种有2个,所以filter有4个.</li><li>红色框的为h=2,卷积后的向量维度为n-h+1=9-2+1=8</li><li>黄色框h=3,卷积后的向量维度是n-h+1=9-3+1=7 (论文原图少画了一个维度)</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="项目实现">项目实现<a class="hash-link" href="#项目实现" title="Direct link to heading">​</a></h3><p>TextCNN 的网络结构：</p><p><img loading="lazy" alt="png" src="/assets/images/TextCNN_network_structure-085ef985a3b38e4dc58bb9315d50aa96.png" width="529" height="337" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="模型构建与训练">模型构建与训练<a class="hash-link" href="#模型构建与训练" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1定义网络结构">1.定义网络结构<a class="hash-link" href="#1定义网络结构" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Embedding</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Dense</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Conv1D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GlobalMaxPooling1D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Concatenate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Dropout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#重要参数解释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#maxlen:句子最大长度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#max_features:词典最大数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># embeding_dims:词向量维度数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#class_num: 分类数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#last_activation:激活函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TextCNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> embedding_dims</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 class_num</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 last_activation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'softmax'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxlen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">max_features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> max_features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">embedding_dims </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> embedding_dims</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">class_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> class_num</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_activation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> last_activation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">input</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        embedding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Embedding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">max_features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">embedding_dims</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_length</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        convs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> kernel_size </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Conv1D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">embedding</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GlobalMaxPooling1D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            convs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Concatenate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">convs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">class_num</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_activation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputs</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outputs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> model</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2数据处理与训练">2.数据处理与训练<a class="hash-link" href="#2数据处理与训练" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">preprocessing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> sequence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">callbacks </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> EarlyStopping</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ModelCheckpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> to_categorical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 路径等配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./processed_data"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vocab_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./vocab/vocab.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vocab_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 神经网络配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">embedding_dims </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'数据预处理与加载数据...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果不存在词汇表，重建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vocab_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build_vocab</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vocab_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vocab_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 获得 词汇/类别 与id映射字典</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">categories</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cat_to_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> read_category</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">words</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word_to_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> read_vocab</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vocab_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 全部数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> read_files</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">del</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 乱序</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shuffle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 切分训练集和测试集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 对文本的词id和类别id进行编码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encode_sentences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> train_data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word_to_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">encode_cate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> train_data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cat_to_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encode_sentences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> test_data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word_to_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">encode_cate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> test_data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cat_to_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'对序列做padding，保证是 samples*timestep 的维度'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pad_sequences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxlen</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pad_sequences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxlen</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'x_train shape:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'x_test shape:'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'构建模型...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TextCNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> embedding_dims</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'adam'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'categorical_crossentropy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'accuracy'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'训练...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 设定callbacks回调函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my_callbacks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ModelCheckpoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./cnn_model.h5'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verbose</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EarlyStopping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">monitor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'val_accuracy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> patience</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'max'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># fit拟合数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">history </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          epochs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">epochs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          callbacks</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">my_callbacks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          validation_data</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#print('对测试集预测...')</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#result = model.predict(x_test)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3训练中间信息输出">3.训练中间信息输出<a class="hash-link" href="#3训练中间信息输出" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">switch_backend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'agg'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">matplotlib inline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'loss'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'r'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">linewidth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'val_loss'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">linewidth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Training loss'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Validation Loss'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Epochs '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Loss'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Loss Curves :CNN'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">savefig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'loss_cnn.png'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/output_8_0-885ea0fd5e5f9ec216abb698d585b943.png" width="391" height="285" class="img_ev3q"></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig2</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'acc'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'r'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">linewidth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'val_acc'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">linewidth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Training Accuracy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Validation Accuracy'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Epochs '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Accuracy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Accuracy Curves : CNN'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">fontsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">savefig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'accuracy_cnn.png'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/output_9_0-dd1d493ffd272d0e6a5c5d8dec3a727c.png" width="397" height="285" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4模型结构打印">4.模型结构打印<a class="hash-link" href="#4模型结构打印" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tensorflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plot_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> show_shapes</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> show_layer_names</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/CNN_structure-3258c1815a39b2691616ca8671e9baa5.png" width="1752" height="611" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5模型导出">5.模型导出<a class="hash-link" href="#5模型导出" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tensorflow </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> shutil </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./cnn_model.h5'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6预测模型">6.预测模型<a class="hash-link" href="#6预测模型" title="Direct link to heading">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> jieba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"杨幂好漂亮,发生原子弹"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jieba</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lcut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text_seg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> encode_sentences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">jieba</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lcut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word_to_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pad_sequences</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text_seg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxlen</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">maxlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text_input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7前后端结合docker部署">7.前后端结合+docker部署<a class="hash-link" href="#7前后端结合docker部署" title="Direct link to heading">​</a></h3><p>项目demo：docker部署链接:<a href="https://hub.docker.com/repository/docker/flybirdgroup/classifier" target="_blank" rel="noopener noreferrer">中文新闻多分类demo</a></p><p><code>docker启动命令</code></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p </span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">5000</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">tcp flybirdgroup</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">classifier</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="png" src="/assets/images/docker1-18f4f4afb58cdb0d482a11640eac72e0.png" width="665" height="338" class="img_ev3q"></p><p><img loading="lazy" alt="png" src="/assets/images/docker2-b5246956da74ccbdc780bd9b90fc7c2a.png" width="1219" height="257" class="img_ev3q"></p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[Long Blog Post]]></title>
            <link>https://your-docusaurus-test-site.com/blog/long-blog-post</link>
            <guid>long-blog-post</guid>
            <pubDate>Wed, 29 May 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[This is the summary of a very long blog post,]]></description>
            <content:encoded><![CDATA[<p>This is the summary of a very long blog post,</p><p>Use a <code>&lt;!--</code> <code>truncate</code> <code>--&gt;</code> comment to limit blog post size in the list view.</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content:encoded>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[Long Blog Post]]></title>
            <link>https://your-docusaurus-test-site.com/blog/long-blog-post</link>
            <guid>long-blog-post</guid>
            <pubDate>Wed, 29 May 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[This is the summary of a very long blog post,]]></description>
            <content:encoded><![CDATA[<p>This is the summary of a very long blog post,</p><p>Use a <code>&lt;!--</code> <code>truncate</code> <code>--&gt;</code> comment to limit blog post size in the list view.</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content:encoded>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[First Blog Post]]></title>
            <link>https://your-docusaurus-test-site.com/blog/first-blog-post</link>
            <guid>first-blog-post</guid>
            <pubDate>Tue, 28 May 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet]]></description>
            <content:encoded><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content:encoded>
            <category>hola</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[First Blog Post]]></title>
            <link>https://your-docusaurus-test-site.com/blog/first-blog-post</link>
            <guid>first-blog-post</guid>
            <pubDate>Tue, 28 May 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet]]></description>
            <content:encoded><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content:encoded>
            <category>hola</category>
            <category>docusaurus</category>
        </item>
    </channel>
</rss>